var ve=Object.defineProperty;var he=(u,s,d)=>s in u?ve(u,s,{enumerable:!0,configurable:!0,writable:!0,value:d}):u[s]=d;var X=(u,s,d)=>(he(u,typeof s!="symbol"?s+"":s,d),d);import{B as Y}from"./index-90b0ce28.js";/* empty css              */import{u as ye}from"./modal-5831ef41.js";import{_ as ge}from"./index-316a232c.js";import{_ as be}from"./InputDropdown.vuevuetypescriptsetuptruelang-42ddf6af.js";/* empty css              */import"./index-f73f074f.js";/* empty css              *//* empty css              *//* empty css              */import{a as ke}from"./dayjs.min-527378d9.js";import{H as we,u as O}from"./HttpClient-1b2eaec7.js";import{o as j,t as De,a as I}from"./index-b46cc542.js";import{_ as Z}from"./AgGrid.vuevuetypescriptsetuptruelang-ab623fe9.js";import{_ as xe}from"./AgGridActionCell.vuevuetypescriptsetuptruelang-5d8fda9d.js";import{d as E,r as v,O as R,w as ee,a as te,e as T,a7 as H,ac as m,f as J,g as l,a9 as N,c as n,u as g,aa as L,X as qe,ak as Ce}from"./plugin-vueexport-helper-50c92bea.js";import{_ as $e}from"./index-adc802a8.js";import{I as Ne}from"./Input-0690b7a8.js";import{_ as Fe,F as Me}from"./Form-bf91ef97.js";import{D as Te}from"./dayjs-c4d578da.js";import{_ as Oe}from"./TextArea-dc2b2442.js";import{M as Re}from"./Modal-7e7fe8a9.js";import{T as Se,_ as Pe}from"./TabPane-e550f0d2.js";import"./DownOutlined-038c92c2.js";import"./_flatRest-fbf250a7.js";import"./isSymbol-86c3dd79.js";import"./debounce-11220fe5.js";import"./useRefs-c0f8034e.js";import"./useMemo-b955d761.js";import"./pickAttrs-efa5632c.js";class S{static list(){return this.HttpClient.axiosInstance.get("/warehouse_stock_adjustments")}static create(s){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"Penyesuaian Stok berhasil ditambah"}).axiosInstance.post("/warehouse_stock_adjustments",s)}static show(s){return this.HttpClient.axiosInstance.get(`/warehouse_stock_adjustments/${s}`)}static update(s,d){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"Pengeluaran Gudang berhasil diupdate"}).axiosInstance.put(`/warehouse_stock_adjustments/${s}`,d)}static formOptions(s){return this.HttpClient.axiosInstance.get("/warehouse_stock_adjustments/form_options",{params:{worklist_id:s}})}}X(S,"HttpClient",new we);const Be={class:"card card-custom card-dense"},je={class:"card-header"},Ie={class:"card-title w-100 d-flex justify-content-between"},Ee=m("h4",{class:"card-label"},"Form Penyesuaian Stok",-1),He={class:"card-body"},Ke={class:"row"},Ae={class:"col-lg-6"},Ue={class:"col-lg-12"},Ve={class:"col-lg-6 mt-3"},Qe=m("i",{class:"fe fe-save me-2"},null,-1),ze=E({__name:"Form",props:{formData:null,editMode:{type:Boolean}},emits:["cancelEdit","onSuccess"],setup(u,{emit:s}){const d=u,b=[{field:"product_code",headerName:"Kode Produk"},{field:"product_name",headerName:"Nama Produk"},{field:"qty",headerName:"Qty",filter:"agNumberColumnFilter",type:"numericColumn",valueFormatter:t=>De(t.value)},{headerName:"Aksi",filter:!1,floatingFilter:!1,sortable:!1,resizable:!1,suppressMovable:!0,pinned:"right",width:75,flex:0,cellRenderer:xe,cellRendererParams:t=>({onDelete:()=>{i.value=i.value.filter(e=>e.id!==t.data.id),typeof t.data.id=="number"?(x.value.push({id:t.data.id,_destroy:1}),D.value=D.value.filter(e=>e.id!==t.data.id)):c.value=c.value.filter(e=>e._id!==t.data.id)}})}],k=[{field:"code",headerName:"Kode Produk"},{field:"name",headerName:"Nama Produk"}],F=v(),h=v(""),w=v(!1),p=v(),i=v([]),c=v([]),x=v([]),D=v([]),q=v(),y=R({}),ae={issue_date:[{required:!0,message:"Tgl transaksi wajib diisi",trigger:"change"}]},M=v(),a=R({}),oe={product_id:[{required:!0,message:"Produk wajib dipilih",trigger:"change"}],qty:[{required:!0,message:"Qty wajib diisi",trigger:"change"}]},{run:Le,loading:se,response:K}=O(),{run:ne,loading:A,response:U}=O(),{run:ie,loading:Ye,response:V}=O(),{visible:P,open:Q,close:de}=ye();async function le(){var t,e;try{d.editMode||(t=K.value)!=null&&t.success&&z(),(e=K.value)!=null&&e.success&&s("onSuccess")}catch{}}function z(){var t;if(d.editMode){for(const e in y)y[e]=void 0;s("cancelEdit")}else(t=q.value)==null||t.resetFields();i.value=[],c.value=[],x.value=[],D.value=[]}function G(){var t,e;if(w.value){if(typeof((t=p.value)==null?void 0:t.id)=="string"){const o=c.value.find(f=>{var C;return f._id===((C=p.value)==null?void 0:C.id)}),_=i.value.find(f=>{var C;return f.id===((C=p.value)==null?void 0:C.id)});o&&(o.product_id=a.product_id,o.qty=a.qty),_&&(_.product_id=a.product_id,_.qty=a.qty,_.product_code=a.product_code,_.product_name=a.product_name,i.value=[...i.value])}else{const o=i.value.find(_=>{var f;return _.id===((f=p.value)==null?void 0:f.id)});if(o){o.product_id=a.product_id,o.product_code=a.product_code,o.product_name=a.product_name,o.qty=a.qty;const _=D.value.find(f=>f.id===o.id);_?(_.id=o.id,_.product_id=o.product_id,_.qty=o.qty):D.value.push({id:o.id,product_id:o.product_id,qty:o.qty}),i.value=[...i.value]}}de()}else{const o={id:`new-${i.value.length+1}`,qty:a.qty,product_id:a.product_id,product_code:a.product_code,product_name:a.product_name};i.value=[...i.value,o],c.value.push({_id:o.id,product_id:a.product_id,qty:a.qty}),(e=M.value)==null||e.resetFields(),h.value=""}}async function re(){var t;try{await ie(S.formOptions()),(t=V.value)!=null&&t.success&&(F.value=V.value.data)}catch{}}async function ue(){var t,e;try{await ne(S.show((t=d.formData)==null?void 0:t.id)),(e=U.value)!=null&&e.success&&(i.value=U.value.data.items.map(o=>({id:o.id,product_code:o.product.code,product_id:o.product.id,product_name:o.product.name,qty:parseInt(o.qty,10)})))}catch{}}function ce(t){var e;w.value=!0,p.value=t,a.product_id=t.product_id,a.product_code=t.product_code,a.product_name=t.product_name,a.qty=t.qty,h.value=`${t.product_code} - ${t.product_name}`,(e=M.value)==null||e.clearValidate(),Q()}return ee(()=>d.formData,()=>{var t;d.formData&&((t=q.value)==null||t.clearValidate(),i.value=[],c.value=[],x.value=[],D.value=[],y.issue_date=d.formData.issue_date,y.note=d.formData.note,setTimeout(()=>{ue()},0))}),te(()=>{re()}),(t,e)=>{const o=$e,_=Ne,f=Fe,C=Te,me=Oe,B=Y,W=Me,pe=be,_e=ge,fe=Re;return T(),H("div",Be,[m("div",je,[m("div",Ie,[Ee,u.editMode?(T(),J(o,{key:0,color:"orange"},{default:l(()=>[N("Mode Edit")]),_:1})):(T(),J(o,{key:1,color:"cyan"},{default:l(()=>[N("Mode Input")]),_:1}))])]),m("div",He,[n(W,{ref_key:"formRef",ref:q,model:y,rules:ae,"label-col":{style:{width:"220px"}},colon:!1,"label-align":"left",onFinish:e[3]||(e[3]=r=>g(j)(q.value,le))},{default:l(()=>[m("div",Ke,[m("div",Ae,[n(f,{label:"No. Tran"},{default:l(()=>{var r;return[n(_,{value:u.editMode?(r=u.formData)==null?void 0:r.transaction_number:"",disabled:""},null,8,["value"])]}),_:1}),n(f,{label:"Tgl Transaksi",name:"receive_date",ref:"receive_date"},{default:l(()=>[n(C,{value:y.issue_date?g(ke)(y.issue_date):void 0,onChange:e[0]||(e[0]=(r,$)=>y.issue_date=$)},null,8,["value"])]),_:1},512),n(f,{label:"Catatan",ref:"note",name:"note"},{default:l(()=>[n(me,{value:y.note,"onUpdate:value":e[1]||(e[1]=r=>y.note=r)},null,8,["value"])]),_:1},512)]),m("div",Ue,[n(B,{class:"mb-3",type:"primary",onClick:e[2]||(e[2]=()=>{w.value=!1,a.product_code=void 0,a.product_id=void 0,a.product_name=void 0,a.qty=void 0,h.value="",g(Q)()})},{default:l(()=>[N(" Tambah ")]),_:1}),n(Z,{style:{height:"300px"},"row-data":i.value,"column-defs":b,loading:g(A),onRowClick:ce},null,8,["row-data","column-defs","loading"])]),m("div",Ve,[n(B,{type:"primary","html-type":"submit",loading:g(se)},{default:l(()=>[Qe,m("span",null,L(u.editMode?"Edit":"Simpan"),1)]),_:1},8,["loading"]),n(B,{class:"mx-3",onClick:z},{default:l(()=>[N(L(u.editMode?"Batal Edit":"Bersihkan"),1)]),_:1})])])]),_:1},8,["model"])]),n(fe,{visible:g(P),"onUpdate:visible":e[7]||(e[7]=r=>qe(P)?P.value=r:null),title:w.value?"Update Detail":"Tambah Detail","cancel-text":"Tutup",onOk:e[8]||(e[8]=r=>g(j)(M.value,G))},{default:l(()=>[n(W,{ref_key:"formRefAddDet",ref:M,model:a,rules:oe,"label-col":{style:{width:"80px"}},colon:!1,"label-align":"left",onFinish:e[6]||(e[6]=r=>g(j)(M.value,G))},{default:l(()=>[n(f,{label:"Produk",name:"product_id",ref:"product_id"},{default:l(()=>{var r;return[n(pe,{"column-defs":k,"grid-data":((r=F.value)==null?void 0:r.products)??[],loading:g(A),value:void 0,"value-display":h.value,onChange:e[4]||(e[4]=$=>{a.product_id=$.id,a.product_code=$.code,a.product_name=$.name,h.value=`${$.code} - ${$.name}`})},null,8,["grid-data","loading","value-display"])]}),_:1},512),n(f,{label:"Qty",name:"qty",ref:"qty"},{default:l(()=>[n(_e,{value:a.qty,"onUpdate:value":e[5]||(e[5]=r=>a.qty=r),min:0,formatter:r=>`${r}`.replace(/\B(?=(\d{3})+(?!\d))/g,"."),parser:r=>r.replace(/\$\s?|(\.*)/g,"")},null,8,["value","formatter","parser"])]),_:1},512)]),_:1},8,["model"])]),_:1},8,["visible","title"])])}}}),Ge=E({__name:"DataTable",props:{idx:null},emits:["rowClick"],setup(u,{emit:s}){const d=u,b=R({value:[{field:"transaction_number",headerName:"No. Tran",pinned:"left",flex:0,width:130},{field:"issue_date",headerName:"Tgl Tran",...I},{field:"note",headerName:"Catatan",minWidth:150},{field:"created_at",headerName:"Diinput Tgl",...I},{field:"updated_at",headerName:"Diupdate Tgl",...I},{field:"created_by_user_username",headerName:"Diinput Oleh",flex:0,width:120},{field:"updated_by_user_username",headerName:"Diupdate Oleh",flex:0,width:120}]}),k=R({value:null}),{run:F,response:h,loading:w}=O();async function p(){var c;try{await F(S.list()),(c=h.value)!=null&&c.success&&(k.value=h.value.data)}catch{}}function i(c){s("rowClick",c)}return te(()=>{p()}),ee(()=>d.idx,()=>{p()}),(c,x)=>(T(),H("div",null,[n(Z,{"row-data":k.value,"column-defs":b.value,loading:g(w),onRowClick:i},null,8,["row-data","column-defs","loading"])]))}}),We=m("span",null,[m("i",{class:"fe fe-edit-2 me-2"}),N(" Input ")],-1),Xe=m("span",null,[m("i",{class:"fe fe-search me-2"}),N(" Browse ")],-1),Je=m("i",{class:"fe fe-refresh-cw me-2"},null,-1),Mt=E({__name:"index",setup(u){const s=v("1"),d=v(),b=v(!1),k=v(1);function F(p){s.value="1",d.value={...p},b.value=!0}function h(){b.value=!1}function w(p){k.value+=1,p!==void 0&&(b.value=p)}return(p,i)=>{const c=Pe,x=Y,D=Se;return T(),H("div",null,[n(D,{class:"input-browse-tab",activeKey:s.value,"onUpdate:activeKey":i[1]||(i[1]=q=>s.value=q),animated:""},Ce({default:l(()=>[n(c,{key:"1"},{tab:l(()=>[We]),default:l(()=>[n(ze,{"form-data":d.value,"edit-mode":b.value,onCancelEdit:h,onOnSuccess:w},null,8,["form-data","edit-mode"])]),_:1}),n(c,{key:"2"},{tab:l(()=>[Xe]),default:l(()=>[n(Ge,{idx:k.value,onRowClick:F},null,8,["idx"])]),_:1})]),_:2},[s.value==="2"?{name:"rightExtra",fn:l(()=>[n(x,{size:"small",class:"mt-3",onClick:i[0]||(i[0]=q=>k.value+=1)},{default:l(()=>[Je,N(" Refresh Data ")]),_:1})]),key:"0"}:void 0]),1032,["activeKey"])])}}});export{Mt as default};
