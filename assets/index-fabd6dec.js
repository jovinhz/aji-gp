var te=Object.defineProperty;var ne=(r,n,a)=>n in r?te(r,n,{enumerable:!0,configurable:!0,writable:!0,value:a}):r[n]=a;var R=(r,n,a)=>(ne(r,typeof n!="symbol"?n+"":n,a),a);import{B as q}from"./index-0bb8ea7a.js";import{_ as oe}from"./AgGrid.vuevuetypescriptsetuptruelang-7e3c6181.js";import{o as se,a as j}from"./index-a69e05bf.js";import"./index-db653870.js";/* empty css              */import{H as ie,u as O}from"./HttpClient-a8d470b1.js";import{_ as V}from"./InputDropdown.vuevuetypescriptsetuptruelang-94aa0dee.js";import{d as F,r as _,Q as E,w as G,e as A,g as D,a7 as B,ac as u,j as H,k as s,a9 as y,b as t,u as k,aa as P,ae as re,ak as le}from"./plugin-vueexport-helper-23a171d5.js";import{M as ue}from"./Modal-5e5e8906.js";import{_ as de}from"./index-2b5a45ec.js";import{I as me,_ as ce,F as _e}from"./Input-6750102f.js";import{T as pe,_ as fe}from"./TabPane-6246fdd8.js";import"./pickAttrs-349b6a5f.js";class C{static list(){return this.HttpClient.axiosInstance.get("/customer_contact_persons")}static create(n){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"Customer Kontak berhasil ditambah"}).axiosInstance.post("/customer_contact_persons",n)}static update(n,a){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"Customer Kontak berhasil diupdate"}).axiosInstance.put(`/customer_contact_persons/${n}`,a)}static formOptions(n){return this.HttpClient.axiosInstance.get("/customer_contact_persons/form_options",{params:{customer_id:n}})}}R(C,"HttpClient",new ie);const he={class:"card card-custom card-dense"},ve={class:"card-header"},ge={class:"card-title w-100 d-flex justify-content-between"},ye=u("h4",{class:"card-label"},"Form Master Kontak",-1),be={class:"card-body"},we={class:"row"},ke={class:"col-lg-6"},De=u("i",{class:"fe fe-save me-2"},null,-1),Ce=F({__name:"Form",props:{formData:null,editMode:{type:Boolean}},emits:["cancelEdit","onSuccess"],setup(r,{emit:n}){const a=r,p=[{field:"code",headerName:"Kode Customer",flex:0,width:140},{field:"name",headerName:"Nama Customer"},{field:"customer_group.code",headerName:"Kode Grup",flex:0,width:120},{field:"customer_group.name",headerName:"Nama Grup"},{field:"address",headerName:"Alamat"}],f=[{field:"code",headerName:"Kode Unit"},{field:"name",headerName:"Nama Unit"}],h=_(""),c=_(""),b=_(),d=_(),m=_(),e=E({}),x={customer_id:[{required:!0,message:"Customer wajib dipilih",trigger:"change"}],customer_unit_id:[{required:!0,message:"Customer unit wajib dipilih",trigger:"change"}],name:[{required:!0,message:"Nama kontak wajib diisi",trigger:"change"}],email:[{type:"email",message:"Email tidak valid",trigger:"change"}]},{run:$,loading:M,response:U}=O(),{run:z,loading:Q,response:S}=O(),{run:J,loading:L,response:I}=O(),{run:Me,loading:W,response:Ke}=O();async function X(){var l,o,N;try{a.editMode?await $(C.update((l=a.formData)==null?void 0:l.id,{customer_id:e.customer_id,customer_unit_id:e.customer_unit_id,name:e.name,email:e.email,note:e.note,primary_phone_number:e.primary_phone_number,secondary_phone_number:e.secondary_phone_number})):(await $(C.create({customer_id:e.customer_id,customer_unit_id:e.customer_unit_id,name:e.name,email:e.email,note:e.note,primary_phone_number:e.primary_phone_number,secondary_phone_number:e.secondary_phone_number})),(o=U.value)!=null&&o.success&&T()),(N=U.value)!=null&&N.success&&n("onSuccess")}catch{}}async function Y(){}function T(){var l;if(a.editMode){for(const o in e)e[o]=void 0;n("cancelEdit")}else(l=m.value)==null||l.resetFields();h.value="",c.value=""}function Z(){ue.confirm({title:"Konfirmasi Hapus Kontak",content:"Apakah kamu sudah yakin ingin menghapus data [Edit Here]",cancelText:"Batal",onOk:Y})}async function ee(){var l;try{await J(C.formOptions(e.customer_id)),(l=I.value)!=null&&l.success&&(d.value=I.value.data)}catch{}}return G(()=>a.formData,()=>{var l;a.formData&&((l=m.value)==null||l.clearValidate(),e.customer_id=a.formData.customer.id,e.customer_unit_id=a.formData.customer_unit.id,e.email=a.formData.email,e.name=a.formData.name,e.note=a.formData.note,e.primary_phone_number=a.formData.primary_phone_number,e.secondary_phone_number=a.formData.secondary_phone_number,h.value=`${a.formData.customer.code} - ${a.formData.customer.name}`,c.value=`${a.formData.customer_unit.code} - ${a.formData.customer_unit.name}`)}),A(async()=>{var l;try{await z(C.formOptions()),(l=S.value)!=null&&l.success&&(b.value=S.value.data)}catch{}}),(l,o)=>{const N=de,w=me,g=ce,K=q,ae=_e;return D(),B("div",he,[u("div",ve,[u("div",ge,[ye,r.editMode?(D(),H(N,{key:0,color:"orange"},{default:s(()=>[y("Mode Edit")]),_:1})):(D(),H(N,{key:1,color:"cyan"},{default:s(()=>[y("Mode Input")]),_:1}))])]),u("div",be,[t(ae,{ref_key:"formRef",ref:m,model:e,rules:x,"label-col":{style:{width:"220px"}},colon:!1,"label-align":"left",onFinish:o[7]||(o[7]=i=>k(se)(m.value,X))},{default:s(()=>[u("div",we,[u("div",ke,[t(g,{label:"Nama Kontak",name:"name",ref:"name"},{default:s(()=>[t(w,{value:e.name,"onUpdate:value":o[0]||(o[0]=i=>e.name=i)},null,8,["value"])]),_:1},512),t(g,{label:"Customer",name:"customer_id",ref:"customer_id"},{default:s(()=>{var i;return[t(V,{"column-defs":p,"grid-data":((i=b.value)==null?void 0:i.customers)??[],loading:k(Q),value:void 0,"value-display":h.value,onChange:o[1]||(o[1]=v=>{v.id!==e.customer_id&&(e.customer_unit_id=void 0,c.value=""),e.customer_id=v.id,h.value=`${v.code} - ${v.name}`,ee()})},null,8,["grid-data","loading","value-display"])]}),_:1},512),t(g,{label:"Unit",name:"customer_unit_id",ref:"customer_unit_id"},{default:s(()=>{var i;return[t(V,{"column-defs":f,"grid-data":((i=d.value)==null?void 0:i.customer_units)??[],loading:k(L),value:void 0,"value-display":c.value,disabled:!e.customer_id,onChange:o[2]||(o[2]=v=>{e.customer_unit_id=v.id,c.value=`${v.code} - ${v.name}`})},null,8,["grid-data","loading","value-display","disabled"])]}),_:1},512),t(g,{label:"HP 1",name:"primary_phone_number",ref:"primary_phone_number"},{default:s(()=>[t(w,{value:e.primary_phone_number,"onUpdate:value":o[3]||(o[3]=i=>e.primary_phone_number=i)},null,8,["value"])]),_:1},512),t(g,{label:"HP 2",name:"secondary_phone_number",ref:"secondary_phone_number"},{default:s(()=>[t(w,{value:e.secondary_phone_number,"onUpdate:value":o[4]||(o[4]=i=>e.secondary_phone_number=i)},null,8,["value"])]),_:1},512),t(g,{label:"Email",name:"email",ref:"email"},{default:s(()=>[t(w,{value:e.email,"onUpdate:value":o[5]||(o[5]=i=>e.email=i)},null,8,["value"])]),_:1},512),t(g,{label:"Keterangan",name:"note",ref:"note"},{default:s(()=>[t(w,{value:e.note,"onUpdate:value":o[6]||(o[6]=i=>e.note=i)},null,8,["value"])]),_:1},512),t(K,{type:"primary","html-type":"submit",loading:k(M)},{default:s(()=>[De,u("span",null,P(r.editMode?"Edit":"Simpan"),1)]),_:1},8,["loading"]),t(K,{class:"mx-3",onClick:T},{default:s(()=>[y(P(r.editMode?"Batal Edit":"Bersihkan"),1)]),_:1}),r.editMode?(D(),H(K,{key:0,danger:"",type:"primary",onClick:Z,loading:k(W)},{default:s(()=>[y(" Hapus ")]),_:1},8,["loading"])):re("",!0)])])]),_:1},8,["model"])])])}}}),xe=F({__name:"DataTable",props:{idx:null},emits:["rowClick"],setup(r,{emit:n}){const a=r,p=E({value:[{field:"name",headerName:"Nama",pinned:"left"},{field:"customer.name",headerName:"Customer",flex:0,width:180},{field:"customer_unit.name",headerName:"Customer Unit",flex:0,width:130},{field:"primary_phone_number",headerName:"HP 1",flex:0,width:100},{field:"secondary_phone_number",headerName:"HP 2",flex:0,width:100},{field:"email",headerName:"Email",flex:0,width:120},{field:"note",headerName:"Keterangan",flex:0,width:120},{field:"created_at",headerName:"Diinput Tgl",...j},{field:"updated_at",headerName:"Diupdate Tgl",...j},{field:"created_by_user_username",headerName:"Diinput Oleh",flex:0,width:120},{field:"updated_by_user_username",headerName:"Diupdate Oleh",flex:0,width:120}]}),f=E({value:null}),{run:h,response:c,loading:b}=O();async function d(){var e;try{await h(C.list()),(e=c.value)!=null&&e.success&&(f.value=c.value.data)}catch{}}function m(e){n("rowClick",e)}return A(()=>{d()}),G(()=>a.idx,()=>{d()}),(e,x)=>(D(),B("div",null,[t(oe,{"row-data":f.value,"column-defs":p.value,loading:k(b),onRowClick:m},null,8,["row-data","column-defs","loading"])]))}}),Ne=u("span",null,[u("i",{class:"fe fe-edit-2 me-2"}),y(" Input ")],-1),Oe=u("span",null,[u("i",{class:"fe fe-search me-2"}),y(" Browse ")],-1),$e=u("i",{class:"fe fe-refresh-cw me-2"},null,-1),Ae=F({__name:"index",setup(r){const n=_("1"),a=_(),p=_(!1),f=_(1);function h(d){n.value="1",a.value={...d},p.value=!0}function c(){p.value=!1}function b(d){f.value+=1,d!==void 0&&(p.value=d)}return(d,m)=>{const e=fe,x=q,$=pe;return D(),B("div",null,[t($,{class:"input-browse-tab",activeKey:n.value,"onUpdate:activeKey":m[1]||(m[1]=M=>n.value=M),animated:""},le({default:s(()=>[t(e,{key:"1"},{tab:s(()=>[Ne]),default:s(()=>[t(Ce,{"form-data":a.value,"edit-mode":p.value,onCancelEdit:c,onOnSuccess:b},null,8,["form-data","edit-mode"])]),_:1}),t(e,{key:"2"},{tab:s(()=>[Oe]),default:s(()=>[t(xe,{idx:f.value,onRowClick:h},null,8,["idx"])]),_:1})]),_:2},[n.value==="2"?{name:"rightExtra",fn:s(()=>[t(x,{size:"small",class:"mt-3",onClick:m[0]||(m[0]=M=>f.value+=1)},{default:s(()=>[$e,y(" Refresh Data ")]),_:1})]),key:"0"}:void 0]),1032,["activeKey"])])}}});export{Ae as default};
