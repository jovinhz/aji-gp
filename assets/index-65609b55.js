var oe=Object.defineProperty;var se=(l,t,a)=>t in l?oe(l,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):l[t]=a;var R=(l,t,a)=>(se(l,typeof t!="symbol"?t+"":t,a),a);import{B as q}from"./index-153eefc2.js";import{_ as ie}from"./AgGrid.vuevuetypescriptsetuptruelang-ab13ecb9.js";import{o as re,a as V}from"./index-8f77c718.js";import"./index-516ff1a6.js";/* empty css              */import{H as le,u as O}from"./HttpClient-7fc79ba3.js";import{_ as j}from"./InputDropdown.vuevuetypescriptsetuptruelang-59e1ec1d.js";import{d as S,r as _,O as E,w as G,a as A,e as x,a7 as B,ac as u,f as H,g as i,a9 as y,c as o,u as C,aa as P,ae as ue,ak as de}from"./plugin-vueexport-helper-0ef99882.js";import{M as me}from"./Modal-79dc3d32.js";import{_ as ce}from"./index-0437c30a.js";import{I as _e,_ as pe,F as fe}from"./Input-bda0940e.js";import{T as he,_ as ve}from"./TabPane-9c8435b0.js";import"./pickAttrs-596f35c3.js";class b{static list(){return this.HttpClient.axiosInstance.get("/customer_contact_persons")}static create(t){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"Customer Kontak berhasil ditambah"}).axiosInstance.post("/customer_contact_persons",t)}static update(t,a){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"Customer Kontak berhasil diupdate"}).axiosInstance.put(`/customer_contact_persons/${t}`,a)}static formOptions(t){return this.HttpClient.axiosInstance.get("/customer_contact_persons/form_options",{params:{customer_id:t}})}static delete(t){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"Customer Kontak berhasil dihapus"}).axiosInstance.delete(`/customer_contact_persons/${t}`)}}R(b,"HttpClient",new le);const ge={class:"card card-custom card-dense"},be={class:"card-header"},ye={class:"card-title w-100 d-flex justify-content-between"},we=u("h4",{class:"card-label"},"Form Master Kontak",-1),ke={class:"card-body"},De={class:"row"},Ce={class:"col-lg-6"},xe=u("i",{class:"fe fe-save me-2"},null,-1),Ne=S({__name:"Form",props:{formData:null,editMode:{type:Boolean}},emits:["cancelEdit","onSuccess"],setup(l,{emit:t}){const a=l,p=[{field:"code",headerName:"Kode Customer",flex:0,width:140},{field:"name",headerName:"Nama Customer"},{field:"customer_group.code",headerName:"Kode Grup",flex:0,width:120},{field:"customer_group.name",headerName:"Nama Grup"},{field:"address",headerName:"Alamat"}],f=[{field:"code",headerName:"Kode Unit"},{field:"name",headerName:"Nama Unit"}],h=_(""),c=_(""),w=_(),d=_(),m=_(),e=E({}),N={customer_id:[{required:!0,message:"Customer wajib dipilih",trigger:"change"}],customer_unit_id:[{required:!0,message:"Customer unit wajib dipilih",trigger:"change"}],name:[{required:!0,message:"Nama kontak wajib diisi",trigger:"change"}],email:[{type:"email",message:"Email tidak valid",trigger:"change"}]},{run:$,loading:M,response:U}=O(),{run:z,loading:J,response:I}=O(),{run:L,loading:Q,response:T}=O(),{run:W,loading:X,response:Y}=O();async function Z(){var s,n,k;try{a.editMode?await $(b.update((s=a.formData)==null?void 0:s.id,{customer_id:e.customer_id,customer_unit_id:e.customer_unit_id,name:e.name,email:e.email,note:e.note,primary_phone_number:e.primary_phone_number,secondary_phone_number:e.secondary_phone_number})):(await $(b.create({customer_id:e.customer_id,customer_unit_id:e.customer_unit_id,name:e.name,email:e.email,note:e.note,primary_phone_number:e.primary_phone_number,secondary_phone_number:e.secondary_phone_number})),(n=U.value)!=null&&n.success&&K()),(k=U.value)!=null&&k.success&&t("onSuccess")}catch{}}async function ee(){var s,n;try{await W(b.delete((s=a.formData)==null?void 0:s.id)),(n=Y.value)!=null&&n.success&&(K(),t("onSuccess"))}catch{}}function K(){var s;if(a.editMode){for(const n in e)e[n]=void 0;t("cancelEdit")}else(s=m.value)==null||s.resetFields();h.value="",c.value=""}function ae(){var s;me.confirm({title:"Konfirmasi Hapus Kontak",content:`Apakah kamu sudah yakin ingin menghapus data ${(s=a.formData)==null?void 0:s.name} ?`,cancelText:"Batal",onOk:ee})}async function te(){var s;try{await L(b.formOptions(e.customer_id)),(s=T.value)!=null&&s.success&&(d.value=T.value.data)}catch{}}return G(()=>a.formData,()=>{var s;a.formData&&((s=m.value)==null||s.clearValidate(),e.customer_id=a.formData.customer.id,e.customer_unit_id=a.formData.customer_unit.id,e.email=a.formData.email,e.name=a.formData.name,e.note=a.formData.note,e.primary_phone_number=a.formData.primary_phone_number,e.secondary_phone_number=a.formData.secondary_phone_number,h.value=`${a.formData.customer.code} - ${a.formData.customer.name}`,c.value=`${a.formData.customer_unit.code} - ${a.formData.customer_unit.name}`)}),A(async()=>{var s;try{await z(b.formOptions()),(s=I.value)!=null&&s.success&&(w.value=I.value.data)}catch{}}),(s,n)=>{const k=ce,D=_e,g=pe,F=q,ne=fe;return x(),B("div",ge,[u("div",be,[u("div",ye,[we,l.editMode?(x(),H(k,{key:0,color:"orange"},{default:i(()=>[y("Mode Edit")]),_:1})):(x(),H(k,{key:1,color:"cyan"},{default:i(()=>[y("Mode Input")]),_:1}))])]),u("div",ke,[o(ne,{ref_key:"formRef",ref:m,model:e,rules:N,"label-col":{style:{width:"220px"}},colon:!1,"label-align":"left",onFinish:n[7]||(n[7]=r=>C(re)(m.value,Z))},{default:i(()=>[u("div",De,[u("div",Ce,[o(g,{label:"Nama Kontak",name:"name",ref:"name"},{default:i(()=>[o(D,{value:e.name,"onUpdate:value":n[0]||(n[0]=r=>e.name=r)},null,8,["value"])]),_:1},512),o(g,{label:"Customer",name:"customer_id",ref:"customer_id"},{default:i(()=>{var r;return[o(j,{"column-defs":p,"grid-data":((r=w.value)==null?void 0:r.customers)??[],loading:C(J),value:void 0,"value-display":h.value,onChange:n[1]||(n[1]=v=>{v.id!==e.customer_id&&(e.customer_unit_id=void 0,c.value=""),e.customer_id=v.id,h.value=`${v.code} - ${v.name}`,te()})},null,8,["grid-data","loading","value-display"])]}),_:1},512),o(g,{label:"Unit",name:"customer_unit_id",ref:"customer_unit_id"},{default:i(()=>{var r;return[o(j,{"column-defs":f,"grid-data":((r=d.value)==null?void 0:r.customer_units)??[],loading:C(Q),value:void 0,"value-display":c.value,disabled:!e.customer_id,onChange:n[2]||(n[2]=v=>{e.customer_unit_id=v.id,c.value=`${v.code} - ${v.name}`})},null,8,["grid-data","loading","value-display","disabled"])]}),_:1},512),o(g,{label:"HP 1",name:"primary_phone_number",ref:"primary_phone_number"},{default:i(()=>[o(D,{value:e.primary_phone_number,"onUpdate:value":n[3]||(n[3]=r=>e.primary_phone_number=r)},null,8,["value"])]),_:1},512),o(g,{label:"HP 2",name:"secondary_phone_number",ref:"secondary_phone_number"},{default:i(()=>[o(D,{value:e.secondary_phone_number,"onUpdate:value":n[4]||(n[4]=r=>e.secondary_phone_number=r)},null,8,["value"])]),_:1},512),o(g,{label:"Email",name:"email",ref:"email"},{default:i(()=>[o(D,{value:e.email,"onUpdate:value":n[5]||(n[5]=r=>e.email=r)},null,8,["value"])]),_:1},512),o(g,{label:"Keterangan",name:"note",ref:"note"},{default:i(()=>[o(D,{value:e.note,"onUpdate:value":n[6]||(n[6]=r=>e.note=r)},null,8,["value"])]),_:1},512),o(F,{type:"primary","html-type":"submit",loading:C(M)},{default:i(()=>[xe,u("span",null,P(l.editMode?"Edit":"Simpan"),1)]),_:1},8,["loading"]),o(F,{class:"mx-3",onClick:K},{default:i(()=>[y(P(l.editMode?"Batal Edit":"Bersihkan"),1)]),_:1}),l.editMode?(x(),H(F,{key:0,danger:"",type:"primary",onClick:ae,loading:C(X)},{default:i(()=>[y(" Hapus ")]),_:1},8,["loading"])):ue("",!0)])])]),_:1},8,["model"])])])}}}),Oe=S({__name:"DataTable",props:{idx:null},emits:["rowClick"],setup(l,{emit:t}){const a=l,p=E({value:[{field:"name",headerName:"Nama",pinned:"left"},{field:"customer.name",headerName:"Customer",flex:0,width:180},{field:"customer_unit.name",headerName:"Customer Unit",flex:0,width:130},{field:"primary_phone_number",headerName:"HP 1",flex:0,width:100},{field:"secondary_phone_number",headerName:"HP 2",flex:0,width:100},{field:"email",headerName:"Email",flex:0,width:120},{field:"note",headerName:"Keterangan",flex:0,width:120},{field:"created_at",headerName:"Diinput Tgl",...V},{field:"updated_at",headerName:"Diupdate Tgl",...V},{field:"created_by_user_username",headerName:"Diinput Oleh",flex:0,width:120},{field:"updated_by_user_username",headerName:"Diupdate Oleh",flex:0,width:120}]}),f=E({value:null}),{run:h,response:c,loading:w}=O();async function d(){var e;try{await h(b.list()),(e=c.value)!=null&&e.success&&(f.value=c.value.data)}catch{}}function m(e){t("rowClick",e)}return A(()=>{d()}),G(()=>a.idx,()=>{d()}),(e,N)=>(x(),B("div",null,[o(ie,{"row-data":f.value,"column-defs":p.value,loading:C(w),onRowClick:m},null,8,["row-data","column-defs","loading"])]))}}),$e=u("span",null,[u("i",{class:"fe fe-edit-2 me-2"}),y(" Input ")],-1),Me=u("span",null,[u("i",{class:"fe fe-search me-2"}),y(" Browse ")],-1),Ke=u("i",{class:"fe fe-refresh-cw me-2"},null,-1),Ae=S({__name:"index",setup(l){const t=_("1"),a=_(),p=_(!1),f=_(1);function h(d){t.value="1",a.value={...d},p.value=!0}function c(){p.value=!1}function w(d){f.value+=1,d!==void 0&&(p.value=d)}return(d,m)=>{const e=ve,N=q,$=he;return x(),B("div",null,[o($,{class:"input-browse-tab",activeKey:t.value,"onUpdate:activeKey":m[1]||(m[1]=M=>t.value=M),animated:""},de({default:i(()=>[o(e,{key:"1"},{tab:i(()=>[$e]),default:i(()=>[o(Ne,{"form-data":a.value,"edit-mode":p.value,onCancelEdit:c,onOnSuccess:w},null,8,["form-data","edit-mode"])]),_:1}),o(e,{key:"2"},{tab:i(()=>[Me]),default:i(()=>[o(Oe,{idx:f.value,onRowClick:h},null,8,["idx"])]),_:1})]),_:2},[t.value==="2"?{name:"rightExtra",fn:i(()=>[o(N,{size:"small",class:"mt-3",onClick:m[0]||(m[0]=M=>f.value+=1)},{default:i(()=>[Ke,y(" Refresh Data ")]),_:1})]),key:"0"}:void 0]),1032,["activeKey"])])}}});export{Ae as default};
