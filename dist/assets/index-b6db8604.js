var ve=Object.defineProperty;var he=(r,s,d)=>s in r?ve(r,s,{enumerable:!0,configurable:!0,writable:!0,value:d}):r[s]=d;var X=(r,s,d)=>(he(r,typeof s!="symbol"?s+"":s,d),d);import{B as Y}from"./index-153eefc2.js";import{_ as Z}from"./AgGrid.vuevuetypescriptsetuptruelang-ab13ecb9.js";import{u as ye}from"./modal-e8545dd0.js";import{_ as ge}from"./index-1212a0e4.js";import{_ as be}from"./InputDropdown.vuevuetypescriptsetuptruelang-d8e7c5f6.js";import{o as j,t as ke,a as I}from"./index-88aa8355.js";import"./index-7c3bc22f.js";/* empty css              *//* empty css              */import{a as we,I as De,_ as xe,F as qe}from"./Input-df745255.js";import{H as Ce,u as O}from"./HttpClient-9b37a6d8.js";import{_ as $e}from"./AgGridActionCell.vuevuetypescriptsetuptruelang-e542f767.js";import{d as E,r as v,O as R,w as ee,a as te,e as T,a7 as H,ac as _,f as J,g as l,a9 as N,c as n,u as g,aa as L,X as Ne,ak as Fe}from"./plugin-vueexport-helper-0ef99882.js";import{_ as Me}from"./index-a1c3b359.js";import{D as Te}from"./dayjs-fd1479da.js";import{_ as Oe}from"./TextArea-dca2e1fe.js";import{M as Re}from"./Modal-dae6d828.js";import{T as Se,_ as Pe}from"./TabPane-a6349958.js";import"./DownOutlined-80526c88.js";import"./useMemo-49158cc8.js";import"./pickAttrs-596f35c3.js";class S{static list(){return this.HttpClient.axiosInstance.get("/warehouse_stock_adjustments")}static create(s){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"Penyesuaian Stok berhasil ditambah"}).axiosInstance.post("/warehouse_stock_adjustments",s)}static show(s){return this.HttpClient.axiosInstance.get(`/warehouse_stock_adjustments/${s}`)}static update(s,d){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"Pengeluaran Gudang berhasil diupdate"}).axiosInstance.put(`/warehouse_stock_adjustments/${s}`,d)}static formOptions(s){return this.HttpClient.axiosInstance.get("/warehouse_stock_adjustments/form_options",{params:{worklist_id:s}})}}X(S,"HttpClient",new Ce);const Be={class:"card card-custom card-dense"},je={class:"card-header"},Ie={class:"card-title w-100 d-flex justify-content-between"},Ee=_("h4",{class:"card-label"},"Form Penyesuaian Stok",-1),He={class:"card-body"},Ke={class:"row"},Ae={class:"col-lg-6"},Ue={class:"col-lg-12"},Ve={class:"col-lg-6 mt-3"},Qe=_("i",{class:"fe fe-save me-2"},null,-1),ze=E({__name:"Form",props:{formData:null,editMode:{type:Boolean}},emits:["cancelEdit","onSuccess"],setup(r,{emit:s}){const d=r,b=[{field:"product_code",headerName:"Kode Produk"},{field:"product_name",headerName:"Nama Produk"},{field:"qty",headerName:"Qty",filter:"agNumberColumnFilter",type:"numericColumn",valueFormatter:t=>ke(t.value)},{headerName:"Aksi",filter:!1,floatingFilter:!1,sortable:!1,resizable:!1,suppressMovable:!0,pinned:"right",width:75,flex:0,cellRenderer:$e,cellRendererParams:t=>({onDelete:()=>{i.value=i.value.filter(e=>e.id!==t.data.id),typeof t.data.id=="number"?(x.value.push({id:t.data.id,_destroy:1}),D.value=D.value.filter(e=>e.id!==t.data.id)):c.value=c.value.filter(e=>e._id!==t.data.id)}})}],k=[{field:"code",headerName:"Kode Produk"},{field:"name",headerName:"Nama Produk"}],F=v(),h=v(""),w=v(!1),m=v(),i=v([]),c=v([]),x=v([]),D=v([]),q=v(),y=R({}),ae={issue_date:[{required:!0,message:"Tgl transaksi wajib diisi",trigger:"change"}]},M=v(),a=R({}),oe={product_id:[{required:!0,message:"Produk wajib dipilih",trigger:"change"}],qty:[{required:!0,message:"Qty wajib diisi",trigger:"change"}]},{run:Le,loading:se,response:K}=O(),{run:ne,loading:A,response:U}=O(),{run:ie,loading:Ye,response:V}=O(),{visible:P,open:Q,close:de}=ye();async function le(){var t,e;try{d.editMode||(t=K.value)!=null&&t.success&&z(),(e=K.value)!=null&&e.success&&s("onSuccess")}catch{}}function z(){var t;if(d.editMode){for(const e in y)y[e]=void 0;s("cancelEdit")}else(t=q.value)==null||t.resetFields();i.value=[],c.value=[],x.value=[],D.value=[]}function G(){var t,e;if(w.value){if(typeof((t=m.value)==null?void 0:t.id)=="string"){const o=c.value.find(f=>{var C;return f._id===((C=m.value)==null?void 0:C.id)}),p=i.value.find(f=>{var C;return f.id===((C=m.value)==null?void 0:C.id)});o&&(o.product_id=a.product_id,o.qty=a.qty),p&&(p.product_id=a.product_id,p.qty=a.qty,p.product_code=a.product_code,p.product_name=a.product_name,i.value=[...i.value])}else{const o=i.value.find(p=>{var f;return p.id===((f=m.value)==null?void 0:f.id)});if(o){o.product_id=a.product_id,o.product_code=a.product_code,o.product_name=a.product_name,o.qty=a.qty;const p=D.value.find(f=>f.id===o.id);p?(p.id=o.id,p.product_id=o.product_id,p.qty=o.qty):D.value.push({id:o.id,product_id:o.product_id,qty:o.qty}),i.value=[...i.value]}}de()}else{const o={id:`new-${i.value.length+1}`,qty:a.qty,product_id:a.product_id,product_code:a.product_code,product_name:a.product_name};i.value=[...i.value,o],c.value.push({_id:o.id,product_id:a.product_id,qty:a.qty}),(e=M.value)==null||e.resetFields(),h.value=""}}async function ue(){var t;try{await ie(S.formOptions()),(t=V.value)!=null&&t.success&&(F.value=V.value.data)}catch{}}async function re(){var t,e;try{await ne(S.show((t=d.formData)==null?void 0:t.id)),(e=U.value)!=null&&e.success&&(i.value=U.value.data.items.map(o=>({id:o.id,product_code:o.product.code,product_id:o.product.id,product_name:o.product.name,qty:parseInt(o.qty,10)})))}catch{}}function ce(t){var e;w.value=!0,m.value=t,a.product_id=t.product_id,a.product_code=t.product_code,a.product_name=t.product_name,a.qty=t.qty,h.value=`${t.product_code} - ${t.product_name}`,(e=M.value)==null||e.clearValidate(),Q()}return ee(()=>d.formData,()=>{var t;d.formData&&((t=q.value)==null||t.clearValidate(),i.value=[],c.value=[],x.value=[],D.value=[],y.issue_date=d.formData.issue_date,y.note=d.formData.note,setTimeout(()=>{re()},0))}),te(()=>{ue()}),(t,e)=>{const o=Me,p=De,f=xe,C=Te,_e=Oe,B=Y,W=qe,me=be,pe=ge,fe=Re;return T(),H("div",Be,[_("div",je,[_("div",Ie,[Ee,r.editMode?(T(),J(o,{key:0,color:"orange"},{default:l(()=>[N("Mode Edit")]),_:1})):(T(),J(o,{key:1,color:"cyan"},{default:l(()=>[N("Mode Input")]),_:1}))])]),_("div",He,[n(W,{ref_key:"formRef",ref:q,model:y,rules:ae,"label-col":{style:{width:"220px"}},colon:!1,"label-align":"left",onFinish:e[3]||(e[3]=u=>g(j)(q.value,le))},{default:l(()=>[_("div",Ke,[_("div",Ae,[n(f,{label:"No. Tran"},{default:l(()=>{var u;return[n(p,{value:r.editMode?(u=r.formData)==null?void 0:u.transaction_number:"",disabled:""},null,8,["value"])]}),_:1}),n(f,{label:"Tgl Transaksi",name:"receive_date",ref:"receive_date"},{default:l(()=>[n(C,{value:y.issue_date?g(we)(y.issue_date):void 0,onChange:e[0]||(e[0]=(u,$)=>y.issue_date=$)},null,8,["value"])]),_:1},512),n(f,{label:"Catatan",ref:"note",name:"note"},{default:l(()=>[n(_e,{value:y.note,"onUpdate:value":e[1]||(e[1]=u=>y.note=u)},null,8,["value"])]),_:1},512)]),_("div",Ue,[n(B,{class:"mb-3",type:"primary",onClick:e[2]||(e[2]=()=>{w.value=!1,a.product_code=void 0,a.product_id=void 0,a.product_name=void 0,a.qty=void 0,h.value="",g(Q)()})},{default:l(()=>[N(" Tambah ")]),_:1}),n(Z,{style:{height:"300px"},"row-data":i.value,"column-defs":b,loading:g(A),onRowClick:ce},null,8,["row-data","column-defs","loading"])]),_("div",Ve,[n(B,{type:"primary","html-type":"submit",loading:g(se)},{default:l(()=>[Qe,_("span",null,L(r.editMode?"Edit":"Simpan"),1)]),_:1},8,["loading"]),n(B,{class:"mx-3",onClick:z},{default:l(()=>[N(L(r.editMode?"Batal Edit":"Bersihkan"),1)]),_:1})])])]),_:1},8,["model"])]),n(fe,{visible:g(P),"onUpdate:visible":e[7]||(e[7]=u=>Ne(P)?P.value=u:null),title:w.value?"Update Detail":"Tambah Detail","cancel-text":"Tutup",onOk:e[8]||(e[8]=u=>g(j)(M.value,G))},{default:l(()=>[n(W,{ref_key:"formRefAddDet",ref:M,model:a,rules:oe,"label-col":{style:{width:"80px"}},colon:!1,"label-align":"left",onFinish:e[6]||(e[6]=u=>g(j)(M.value,G))},{default:l(()=>[n(f,{label:"Produk",name:"product_id",ref:"product_id"},{default:l(()=>{var u;return[n(me,{"column-defs":k,"grid-data":((u=F.value)==null?void 0:u.products)??[],loading:g(A),value:void 0,"value-display":h.value,onChange:e[4]||(e[4]=$=>{a.product_id=$.id,a.product_code=$.code,a.product_name=$.name,h.value=`${$.code} - ${$.name}`})},null,8,["grid-data","loading","value-display"])]}),_:1},512),n(f,{label:"Qty",name:"qty",ref:"qty"},{default:l(()=>[n(pe,{value:a.qty,"onUpdate:value":e[5]||(e[5]=u=>a.qty=u),min:0,formatter:u=>`${u}`.replace(/\B(?=(\d{3})+(?!\d))/g,"."),parser:u=>u.replace(/\$\s?|(\.*)/g,"")},null,8,["value","formatter","parser"])]),_:1},512)]),_:1},8,["model"])]),_:1},8,["visible","title"])])}}}),Ge=E({__name:"DataTable",props:{idx:null},emits:["rowClick"],setup(r,{emit:s}){const d=r,b=R({value:[{field:"transaction_number",headerName:"No. Tran",pinned:"left",flex:0,width:130},{field:"issue_date",headerName:"Tgl Tran",...I},{field:"note",headerName:"Catatan",minWidth:150},{field:"created_at",headerName:"Diinput Tgl",...I},{field:"updated_at",headerName:"Diupdate Tgl",...I},{field:"created_by_user_username",headerName:"Diinput Oleh",flex:0,width:120},{field:"updated_by_user_username",headerName:"Diupdate Oleh",flex:0,width:120}]}),k=R({value:null}),{run:F,response:h,loading:w}=O();async function m(){var c;try{await F(S.list()),(c=h.value)!=null&&c.success&&(k.value=h.value.data)}catch{}}function i(c){s("rowClick",c)}return te(()=>{m()}),ee(()=>d.idx,()=>{m()}),(c,x)=>(T(),H("div",null,[n(Z,{"row-data":k.value,"column-defs":b.value,loading:g(w),onRowClick:i},null,8,["row-data","column-defs","loading"])]))}}),We=_("span",null,[_("i",{class:"fe fe-edit-2 me-2"}),N(" Input ")],-1),Xe=_("span",null,[_("i",{class:"fe fe-search me-2"}),N(" Browse ")],-1),Je=_("i",{class:"fe fe-refresh-cw me-2"},null,-1),kt=E({__name:"index",setup(r){const s=v("1"),d=v(),b=v(!1),k=v(1);function F(m){s.value="1",d.value={...m},b.value=!0}function h(){b.value=!1}function w(m){k.value+=1,m!==void 0&&(b.value=m)}return(m,i)=>{const c=Pe,x=Y,D=Se;return T(),H("div",null,[n(D,{class:"input-browse-tab",activeKey:s.value,"onUpdate:activeKey":i[1]||(i[1]=q=>s.value=q),animated:""},Fe({default:l(()=>[n(c,{key:"1"},{tab:l(()=>[We]),default:l(()=>[n(ze,{"form-data":d.value,"edit-mode":b.value,onCancelEdit:h,onOnSuccess:w},null,8,["form-data","edit-mode"])]),_:1}),n(c,{key:"2"},{tab:l(()=>[Xe]),default:l(()=>[n(Ge,{idx:k.value,onRowClick:F},null,8,["idx"])]),_:1})]),_:2},[s.value==="2"?{name:"rightExtra",fn:l(()=>[n(x,{size:"small",class:"mt-3",onClick:i[0]||(i[0]=q=>k.value+=1)},{default:l(()=>[Je,N(" Refresh Data ")]),_:1})]),key:"0"}:void 0]),1032,["activeKey"])])}}});export{kt as default};
