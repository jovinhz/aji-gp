var Se=Object.defineProperty;var $e=(d,l,s)=>l in d?Se(d,l,{enumerable:!0,configurable:!0,writable:!0,value:s}):d[l]=s;var Q=(d,l,s)=>($e(d,typeof l!="symbol"?l+"":l,s),s);import{B as ne}from"./index-00a8ffd2.js";/* empty css              *//* empty css              */import{_ as je}from"./index-e9d8f074.js";/* empty css              *//* empty css              */import{u as Y}from"./modal-e4c7fed2.js";/* empty css              */import"./index-97222043.js";import{S as Ue,_ as Re}from"./index-0523e8d4.js";import{a as Be}from"./dayjs.min-2389bdff.js";import{H as He,u as x}from"./HttpClient-64290c27.js";import{o as Z,a as $}from"./index-f9e6a35e.js";import{_ as ie}from"./AgGrid.vue_vue_type_script_setup_true_lang-d3dbb188.js";import{W as S}from"./WorkerService-46e23d80.js";import{d as I,r as b,O as j,w as le,a as re,e as f,a7 as N,ac as m,f as M,g as a,a9 as _,c as t,u as c,F as ee,ab as te,aa as U,ae,X as oe,ak as Ee}from"./_plugin-vue_export-helper-50c92bea.js";import{M as se}from"./Modal-5bd2bcee.js";import{_ as Ie}from"./index-f9be8515.js";import{I as Ke}from"./Input-97482d20.js";import{_ as Pe,F as Ve}from"./Form-2caee2e0.js";import{D as qe}from"./dayjs-3e6b4e4c.js";import{_ as Ge}from"./TextArea-afcadf10.js";import{T as Le,_ as We}from"./TabPane-053c7c75.js";import"./DownOutlined-dca0ecad.js";import"./pickAttrs-44b65975.js";import"./useMemo-6199d1b3.js";import"./useRefs-9f478e5b.js";import"./CheckOutlined-e3d2d87e.js";import"./SearchOutlined-123fd7b0.js";import"./_flatRest-6ef3b5aa.js";import"./isSymbol-5a6ec0b4.js";import"./debounce-52dc8683.js";class R{static list(l){return this.HttpClient.axiosInstance.get(`/workers/${l}/worker_debt_histories`)}static create(l,s){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"Transaksi berhasil ditambah"}).axiosInstance.post(`/workers/${l}/worker_debt_histories`,s)}static update(l,s){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"Transaksi berhasil diupdate"}).axiosInstance.put(`/workers/${l}`,s)}static formOptions(){return this.HttpClient.axiosInstance.get("/workers/current/worker_debt_histories/form_options")}}Q(R,"HttpClient",new He);const ze={class:"card card-custom card-dense"},Ae={class:"card-header"},Xe={class:"card-title w-100 d-flex justify-content-between"},Je=m("h4",{class:"card-label"},"Form Pekerja",-1),Qe={class:"card-body"},Ye={class:"row"},Ze={class:"col-lg-6"},et={key:0,class:"d-flex align-items-baseline flex-column flex-md-row mb-5"},tt=m("i",{class:"fe fe-save me-2"},null,-1),at=I({__name:"Form",props:{formData:null,editMode:{type:Boolean}},emits:["cancelEdit","onSuccess"],setup(d,{emit:l}){const s=d,g=[{field:"debt_date",headerName:"Tgl Transaksi",...$},{field:"type_caption",headerName:"Tipe Transaksi"},{field:"formatted_value",headerName:"Nominal",type:"numericColumn",filter:"agNumberColumnFilter",filterValueGetter:i=>parseFloat(i.data.value)},{field:"description",headerName:"Deskripsi"},{field:"created_at",headerName:"Diinput Tgl",...$},{field:"updated_at",headerName:"Diupdate Tgl",...$},{field:"created_by_user_username",headerName:"Diinput Oleh",flex:0,width:120},{field:"updated_by_user_username",headerName:"Diupdate Oleh",flex:0,width:120}],v=b(""),C=b(),D=b(),k=b(),o=j({status_id:1}),h={code:[{required:!0,message:"Kode pekerja wajib diisi",trigger:"change"}],name:[{required:!0,message:"Nama pekerja wajib diisi",trigger:"change"}]},u=b(),r=j({}),B={debt_date:[{required:!0,message:"Tanggal transaksi wajib diisi",trigger:"change"}],value:[{required:!0,message:"Nominal wajib diisi",trigger:"change"}],type_id:[{required:!0,message:"Tipe transaksi wajib dipilih",trigger:"change"}]},{run:T,loading:de,response:K}=x(),{run:ue,loading:ce,response:P}=x(),{run:me,loading:pe,response:V}=x(),{run:fe,loading:lt,response:q}=x(),{run:_e,loading:ve,response:be}=x(),{visible:H,open:ge,close:rt}=Y(),{visible:E,open:ke,close:he}=Y(),G=j({value:null}),{run:dt,loading:ye,response:ut}=x();async function De(){var i,e,p;try{s.editMode?await T(S.update((i=s.formData)==null?void 0:i.id,{name:o.name,status_id:o.status_id})):(await T(S.create({code:o.code.toUpperCase(),name:o.name,status_id:o.status_id})),(e=K.value)!=null&&e.success&&L()),(p=K.value)!=null&&p.success&&l("onSuccess")}catch{}}async function we(){var i,e;try{await _e(R.create((i=s.formData)==null?void 0:i.id,{debt_date:r.debt_date,type_id:r.type_id,value:r.value,description:r.description})),(e=be.value)!=null&&e.success&&(W(),Ce(),he(),(async()=>{var w;const p=await S.show((w=s.formData)==null?void 0:w.id);p.success&&(v.value=p.data.formatted_total_debt)})())}catch{}}async function xe(){}function L(){var i;if(s.editMode){for(const e in o)o[e]=void 0;o.status_id=1,l("cancelEdit")}else(i=k.value)==null||i.resetFields()}function Ce(){var i;for(const e in o)r[e]=void 0;(i=u.value)==null||i.resetFields()}function Ne(){se.confirm({title:"Konfirmasi Hapus Pekerja",content:"Apakah kamu sudah yakin ingin menghapus data [Edit Here]",cancelText:"Batal",onOk:xe})}async function W(){var i,e;try{await me(R.list((i=s.formData)==null?void 0:i.id)),(e=V.value)!=null&&e.success&&(G.value=V.value.data)}catch{}}function Te(i,e){r.debt_date=e}return le(()=>s.formData,()=>{var i;s.formData&&((i=k.value)==null||i.clearValidate(),o.code=s.formData.code,o.name=s.formData.name,o.status_id=s.formData.status_id,v.value=s.formData.formatted_total_debt)}),re(async()=>{var i,e;try{await ue(S.formOptions()),(i=P.value)!=null&&i.success&&(C.value=P.value.data),await fe(R.formOptions()),(e=q.value)!=null&&e.success&&(D.value=q.value.data)}catch{}}),(i,e)=>{const p=Ie,w=Ke,y=Pe,z=Ue,A=Re,O=ne,X=Ve,J=se,Oe=qe,Fe=je,Me=Ge;return f(),N("div",ze,[m("div",Ae,[m("div",Xe,[Je,d.editMode?(f(),M(p,{key:0,color:"orange"},{default:a(()=>[_("Mode Edit")]),_:1})):(f(),M(p,{key:1,color:"cyan"},{default:a(()=>[_("Mode Input")]),_:1}))])]),m("div",Qe,[t(X,{ref_key:"formRef",ref:k,model:o,rules:h,"label-col":{style:{width:"220px"}},colon:!1,"label-align":"left",onFinish:e[4]||(e[4]=n=>c(Z)(k.value,De))},{default:a(()=>[m("div",Ye,[m("div",Ze,[t(y,{label:"Kode Pekerja",name:"code",ref:"code"},{default:a(()=>[t(w,{value:o.code,"onUpdate:value":e[0]||(e[0]=n=>o.code=n),valueModifiers:{trim:!0},style:{"text-transform":"uppercase"},disabled:d.editMode},null,8,["value","disabled"])]),_:1},512),t(y,{label:"Nama Pekerja",name:"name",ref:"name"},{default:a(()=>[t(w,{value:o.name,"onUpdate:value":e[1]||(e[1]=n=>o.name=n)},null,8,["value"])]),_:1},512),t(y,{label:"Status",name:"status_id",ref:"status_id"},{default:a(()=>[t(A,{value:o.status_id,"onUpdate:value":e[2]||(e[2]=n=>o.status_id=n),loading:c(ce)},{default:a(()=>{var n;return[(f(!0),N(ee,null,te((n=C.value)==null?void 0:n.statuses,F=>(f(),M(z,{value:F.id},{default:a(()=>[_(U(F.title),1)]),_:2},1032,["value"]))),256))]}),_:1},8,["value","loading"])]),_:1},512),d.editMode?(f(),N("div",et,[t(y,{label:"Total Utang",class:"mb-0"},{default:a(()=>[t(w,{disabled:"",value:v.value},null,8,["value"])]),_:1}),t(O,{class:"mt-3 ms-md-3 mt-md-0",onClick:e[3]||(e[3]=()=>{W(),c(ge)()})},{default:a(()=>[_(" Lihat Riwayat ")]),_:1})])):ae("",!0),t(O,{type:"primary","html-type":"submit",loading:c(de)},{default:a(()=>[tt,m("span",null,U(d.editMode?"Edit":"Simpan"),1)]),_:1},8,["loading"]),t(O,{class:"mx-3",onClick:L},{default:a(()=>[_(U(d.editMode?"Batal Edit":"Bersihkan"),1)]),_:1}),d.editMode?(f(),M(O,{key:1,danger:"",type:"primary",onClick:Ne,loading:c(ye)},{default:a(()=>[_(" Hapus ")]),_:1},8,["loading"])):ae("",!0)])])]),_:1},8,["model"])]),t(J,{visible:c(H),"onUpdate:visible":e[5]||(e[5]=n=>oe(H)?H.value=n:null),title:"Riwayat Utang",width:"70vw","cancel-text":"Tutup","ok-button-props":{style:{display:"none"}}},{default:a(()=>[t(O,{type:"primary",class:"mb-3",onClick:c(ke)},{default:a(()=>[_("Input Transaksi")]),_:1},8,["onClick"]),t(ie,{"row-data":G.value,"column-defs":g,loading:c(pe),"ok-button-props":{disabled:!0}},null,8,["row-data","loading"])]),_:1},8,["visible"]),t(J,{visible:c(E),"onUpdate:visible":e[9]||(e[9]=n=>oe(E)?E.value=n:null),title:"Input Transaksi Utang",onOk:e[10]||(e[10]=n=>c(Z)(u.value,we)),"confirm-loading":c(ve)},{default:a(()=>[t(X,{ref_key:"formRefDebt",ref:u,model:r,rules:B,"label-col":{style:{width:"120px"}},colon:!1,"label-align":"left"},{default:a(()=>[t(y,{label:"Tgl Transaksi",name:"debt_date",ref:"debt_date"},{default:a(()=>[t(Oe,{value:r.debt_date?c(Be)(r.debt_date):void 0,onChange:Te},null,8,["value"])]),_:1},512),t(y,{label:"Tipe Transaksi",name:"type_id",ref:"type_id"},{default:a(()=>[t(A,{value:r.type_id,"onUpdate:value":e[6]||(e[6]=n=>r.type_id=n)},{default:a(()=>{var n;return[(f(!0),N(ee,null,te((n=D.value)==null?void 0:n.types,F=>(f(),M(z,{value:F.id},{default:a(()=>[_(U(F.title),1)]),_:2},1032,["value"]))),256))]}),_:1},8,["value"])]),_:1},512),t(y,{label:"Nominal",name:"value",ref:"value"},{default:a(()=>[t(Fe,{value:r.value,"onUpdate:value":e[7]||(e[7]=n=>r.value=n),min:0,formatter:n=>`${n}`.replace(/\B(?=(\d{3})+(?!\d))/g,"."),parser:n=>n.replace(/\$\s?|(\.*)/g,"")},null,8,["value","formatter","parser"])]),_:1},512),t(y,{label:"Deskripsi",name:"description",ref:"description"},{default:a(()=>[t(Me,{value:r.description,"onUpdate:value":e[8]||(e[8]=n=>r.description=n)},null,8,["value"])]),_:1},512)]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])])}}}),ot=I({__name:"DataTable",props:{idx:null},emits:["rowClick"],setup(d,{emit:l}){const s=d,g=j({value:[{field:"code",headerName:"Kode Pekerja",pinned:"left",flex:.3},{field:"name",headerName:"Nama Pekerja",flex:.3,pinned:"left"},{field:"status_caption",headerName:"Status",width:100,flex:0},{field:"formatted_total_debt",headerName:"Total Utang",type:"numericColumn",filter:"agNumberColumnFilter",filterValueGetter:u=>parseFloat(u.data.total_debt)},{field:"created_at",headerName:"Diinput Tgl",...$},{field:"updated_at",headerName:"Diupdate Tgl",...$},{field:"created_by_user_username",headerName:"Diinput Oleh",flex:0,width:120},{field:"updated_by_user_username",headerName:"Diupdate Oleh",flex:0,width:120}]}),v=j({value:null}),{run:C,response:D,loading:k}=x();async function o(){var u;try{await C(S.list()),(u=D.value)!=null&&u.success&&(v.value=D.value.data)}catch{}}function h(u){l("rowClick",u)}return re(()=>{o()}),le(()=>s.idx,()=>{o()}),(u,r)=>(f(),N("div",null,[t(ie,{"row-data":v.value,"column-defs":g.value,loading:c(k),onRowClick:h},null,8,["row-data","column-defs","loading"])]))}}),st=m("span",null,[m("i",{class:"fe fe-edit-2 me-2"}),_(" Input ")],-1),nt=m("span",null,[m("i",{class:"fe fe-search me-2"}),_(" Browse ")],-1),it=m("i",{class:"fe fe-refresh-cw me-2"},null,-1),Gt=I({__name:"index",setup(d){const l=b("1"),s=b(),g=b(!1),v=b(1);function C(o){l.value="1",s.value={...o},g.value=!0}function D(){g.value=!1}function k(o){v.value+=1,o!==void 0&&(g.value=o)}return(o,h)=>{const u=We,r=ne,B=Le;return f(),N("div",null,[t(B,{class:"input-browse-tab",activeKey:l.value,"onUpdate:activeKey":h[1]||(h[1]=T=>l.value=T),animated:""},Ee({default:a(()=>[t(u,{key:"1"},{tab:a(()=>[st]),default:a(()=>[t(at,{"form-data":s.value,"edit-mode":g.value,onCancelEdit:D,onOnSuccess:k},null,8,["form-data","edit-mode"])]),_:1}),t(u,{key:"2"},{tab:a(()=>[nt]),default:a(()=>[t(ot,{idx:v.value,onRowClick:C},null,8,["idx"])]),_:1})]),_:2},[l.value==="2"?{name:"rightExtra",fn:a(()=>[t(r,{size:"small",class:"mt-3",onClick:h[0]||(h[0]=T=>v.value+=1)},{default:a(()=>[it,_(" Refresh Data ")]),_:1})]),key:"0"}:void 0]),1032,["activeKey"])])}}});export{Gt as default};
