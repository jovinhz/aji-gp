var De=Object.defineProperty;var xe=(d,s,i)=>s in d?De(d,s,{enumerable:!0,configurable:!0,writable:!0,value:i}):d[s]=i;var Q=(d,s,i)=>(xe(d,typeof s!="symbol"?s+"":s,i),i);import{B as ee}from"./index-90b0ce28.js";/* empty css              */import{u as Y}from"./modal-5831ef41.js";/* empty css              *//* empty css              */import"./index-3c58d5d9.js";import{S as Ce,_ as Ne}from"./index-e46842eb.js";/* empty css              *//* empty css              */import{a as Pe}from"./dayjs.min-78ae9b26.js";import{_ as Se}from"./InputDropdown.vuevuetypescriptsetuptruelang-fe3480c6.js";import{_ as te}from"./AgGrid.vuevuetypescriptsetuptruelang-ab623fe9.js";import{_ as $e}from"./AgGridActionCell.vuevuetypescriptsetuptruelang-5d8fda9d.js";import{H as Me,u as $}from"./HttpClient-042fc245.js";import{o as H,a as U}from"./index-4821d3fa.js";import{d as A,r as f,O,w as ae,a as ie,e as D,a7 as R,ac as u,f as K,g as n,a9 as b,c as a,u as p,F as Fe,ab as je,aa as q,ae as Ie,X as Z,ak as Ke}from"./plugin-vueexport-helper-50c92bea.js";import{_ as Oe}from"./index-4c8ffcc7.js";import{I as Re}from"./Input-171d1ec7.js";import{_ as Te,F as Be}from"./Form-d1b3d589.js";import{D as He}from"./dayjs-2f47e06b.js";import{_ as Ue}from"./TextArea-bf7cacd1.js";import{M as qe}from"./Modal-01017087.js";import{T as Ae,_ as Ee}from"./TabPane-0e361ed2.js";import"./pickAttrs-efa5632c.js";import"./useMemo-b955d761.js";import"./useRefs-c0f8034e.js";import"./DownOutlined-038c92c2.js";import"./CheckOutlined-48efc1ed.js";import"./SearchOutlined-7906676b.js";import"./_flatRest-ec52f6ad.js";import"./isSymbol-9d3d42e9.js";import"./debounce-59d4e949.js";class P{static list(s,i){return this.HttpClient.axiosInstance.get("/work_orders",{params:{start_date:s,end_date:i}})}static show(s){return this.HttpClient.axiosInstance.get(`/work_orders/${s}`)}static create(s){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"SPK berhasil dibuat"}).axiosInstance.post("/work_orders",s)}static update(s,i){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"SPK berhasil diupdate"}).axiosInstance.put(`/work_orders/${s}`,i)}static print(s){return this.HttpClient.axiosInstance.get(`/work_orders/${s}/print`)}static formOptions(){return this.HttpClient.axiosInstance.get("/work_orders/form_options")}}Q(P,"HttpClient",new Me);const Je={class:"card card-custom card-dense"},Ve={class:"card-header"},ze={class:"card-title w-100 d-flex justify-content-between"},Ge=u("h4",{class:"card-label"},"Form SPK",-1),Le={class:"card-body"},We={class:"row"},Xe={class:"col-lg-6"},Qe={class:"col-lg-12"},Ye={class:"col-lg-6 mt-3"},Ze=u("i",{class:"fe fe-save me-2"},null,-1),et=u("span",null,"Cetak",-1),tt=["data"],at=A({__name:"Form",props:{formData:null,editMode:{type:Boolean}},emits:["cancelEdit","onSuccess"],setup(d,{emit:s}){const i=d,g=[{field:"worklist_number",headerName:"No Projek"},{field:"title",headerName:"Judul Projek"}],w=[{field:"item",headerName:"Item",wrapText:!0,autoHeight:!0},{headerName:"Aksi",filter:!1,floatingFilter:!1,sortable:!1,resizable:!1,suppressMovable:!0,pinned:"right",width:75,flex:0,cellRenderer:$e,cellRendererParams:r=>({onDelete:()=>{o.value=o.value.filter(e=>e.id!==r.data.id),typeof r.data.id=="number"?_.value.push({id:r.data.id,_destroy:1}):m.value=m.value.filter(e=>e._id!==r.data.id)}})}],h=f(""),x=f(""),C=f(),o=f([]),m=f([]),_=f([]),k=f(),t=O({}),M={worklist_id:[{required:!0,message:"Projek wajib dipilih",trigger:"change"}],status_id:[{required:!0,message:"Status wajib dipilih",trigger:"change"}],letter_date:[{required:!0,message:"Tanggal wajib diisi",trigger:"change"}],title:[{required:!0,message:"Judul wajib diisi",trigger:"change"}],recipient_name:[{required:!0,message:"Nama penerima wajib diisi",trigger:"change"}],recipient_identity_number:[{required:!0,message:"NIK penerima wajib diisi",trigger:"change"}],recipient_address:[{required:!0,message:"Alamat penerima wajib diisi",trigger:"change"}],recipient_position:[{required:!0,message:"Alamat penerima wajib diisi",trigger:"change"}]},F=f(),j=O({}),ne={item:[{required:!0,message:"Item wajib diisi",trigger:"change"}]},{run:E,loading:le,response:I}=$(),{run:se,loading:re,response:J}=$(),{run:oe,loading:de,response:V}=$(),{run:ue,loading:ce,response:z}=$(),{visible:T,open:me,close:rt}=Y(),{visible:B,open:_e,close:pe}=Y();async function fe(){var r,e,N,v;try{i.editMode?(await E(P.update((r=i.formData)==null?void 0:r.id,{worklist_id:t.worklist_id,letter_date:t.letter_date,recipient_address:t.recipient_address,recipient_identity_number:t.recipient_identity_number,recipient_name:t.recipient_name,recipient_position:t.recipient_position,status_id:t.status_id,title:t.title,items_attributes:[...m.value,..._.value]})),(e=I.value)!=null&&e.success&&(m.value=[],_.value=[],o.value=I.value.data.items.map(c=>({id:c.id,item:c.item})))):(await E(P.create({worklist_id:t.worklist_id,letter_date:t.letter_date,recipient_address:t.recipient_address,recipient_identity_number:t.recipient_identity_number,recipient_name:t.recipient_name,recipient_position:t.recipient_position,status_id:t.status_id,title:t.title,items_attributes:o.value.map(c=>({item:c.item}))})),(N=I.value)!=null&&N.success&&G()),(v=I.value)!=null&&v.success&&s("onSuccess")}catch{}}function G(){var r;if(i.editMode){for(const e in t)t[e]=void 0;s("cancelEdit")}else(r=k.value)==null||r.resetFields();o.value=[],m.value=[],_.value=[],h.value=""}async function ve(){var r;try{await oe(P.formOptions()),(r=V.value)!=null&&r.success&&(C.value=V.value.data)}catch{}}function L(){var e;const r={id:`new-${o.value.length+1}`,item:j.item};o.value=[...o.value,r],m.value.push({_id:r.id,item:r.item}),(e=F.value)==null||e.resetFields()}async function be(){var r,e;try{await se(P.show((r=i.formData)==null?void 0:r.id)),(e=J.value)!=null&&e.success&&(o.value=J.value.data.items)}catch{}}async function ge(){var r,e;try{await ue(P.print((r=i.formData)==null?void 0:r.id)),(e=z.value)!=null&&e.success&&(x.value="data:application/pdf;base64,"+z.value.data.base64,_e())}catch{}}return ae(()=>i.formData,()=>{var r;i.formData&&((r=k.value)==null||r.clearValidate(),o.value=[],m.value=[],_.value=[],t.letter_date=i.formData.letter_date,t.recipient_address=i.formData.recipient_address,t.recipient_identity_number=i.formData.recipient_identity_number,t.recipient_name=i.formData.recipient_name,t.status_id=i.formData.status_id,t.worklist_id=i.formData.worklist.id,t.title=i.formData.title,t.recipient_position=i.formData.recipient_position,h.value=`${i.formData.worklist.worklist_number} - ${i.formData.worklist.title}`,setTimeout(()=>{be()},0))}),ie(()=>{ve()}),(r,e)=>{const N=Oe,v=Re,c=Te,we=He,he=Ce,ke=Ne,S=ee,W=Be,ye=Ue,X=qe;return D(),R("div",Je,[u("div",Ve,[u("div",ze,[Ge,d.editMode?(D(),K(N,{key:0,color:"orange"},{default:n(()=>[b("Mode Edit")]),_:1})):(D(),K(N,{key:1,color:"cyan"},{default:n(()=>[b("Mode Input")]),_:1}))])]),u("div",Le,[a(W,{ref_key:"formRef",ref:k,model:t,rules:M,"label-col":{style:{width:"220px"}},colon:!1,"label-align":"left",onFinish:e[9]||(e[9]=l=>p(H)(k.value,fe))},{default:n(()=>[u("div",We,[u("div",Xe,[a(c,{label:"No SPK"},{default:n(()=>{var l;return[a(v,{value:d.editMode?(l=d.formData)==null?void 0:l.letter_number:"",disabled:""},null,8,["value"])]}),_:1}),a(c,{label:"Projek",name:"worklist_id",ref:"worklist_id"},{default:n(()=>{var l;return[a(Se,{"column-defs":g,"grid-data":((l=C.value)==null?void 0:l.worklists)??[],loading:p(de),value:void 0,"value-display":h.value,onChange:e[0]||(e[0]=y=>{t.worklist_id=y.id,h.value=`${y.worklist_number} - ${y.title}`})},null,8,["grid-data","loading","value-display"])]}),_:1},512),a(c,{label:"Tgl SPK",name:"letter_date",ref:"letter_date"},{default:n(()=>[a(we,{value:t.letter_date?p(Pe)(t.letter_date):void 0,onChange:e[1]||(e[1]=(l,y)=>t.letter_date=y)},null,8,["value"])]),_:1},512),a(c,{label:"Judul",ref:"title",name:"title"},{default:n(()=>[a(v,{value:t.title,"onUpdate:value":e[2]||(e[2]=l=>t.title=l)},null,8,["value"])]),_:1},512),a(c,{label:"Nama Penerima",ref:"recipient_name",name:"recipient_name"},{default:n(()=>[a(v,{value:t.recipient_name,"onUpdate:value":e[3]||(e[3]=l=>t.recipient_name=l)},null,8,["value"])]),_:1},512),a(c,{label:"NIK Penerima",ref:"recipient_identity_number",name:"recipient_identity_number"},{default:n(()=>[a(v,{value:t.recipient_identity_number,"onUpdate:value":e[4]||(e[4]=l=>t.recipient_identity_number=l)},null,8,["value"])]),_:1},512),a(c,{label:"Alamat Penerima",ref:"recipient_address",name:"recipient_address"},{default:n(()=>[a(v,{value:t.recipient_address,"onUpdate:value":e[5]||(e[5]=l=>t.recipient_address=l)},null,8,["value"])]),_:1},512),a(c,{label:"Jabatan Penerima",ref:"recipient_position",name:"recipient_position"},{default:n(()=>[a(v,{value:t.recipient_position,"onUpdate:value":e[6]||(e[6]=l=>t.recipient_position=l)},null,8,["value"])]),_:1},512),a(c,{label:"Status",name:"status_id",ref:"status_id"},{default:n(()=>[a(ke,{value:t.status_id,"onUpdate:value":e[7]||(e[7]=l=>t.status_id=l)},{default:n(()=>{var l;return[(D(!0),R(Fe,null,je((l=C.value)==null?void 0:l.statuses,y=>(D(),K(he,{value:y.id},{default:n(()=>[b(q(y.title),1)]),_:2},1032,["value"]))),256))]}),_:1},8,["value"])]),_:1},512)]),u("div",Qe,[a(S,{class:"mb-3",type:"primary",onClick:p(me)},{default:n(()=>[b(" Tambah ")]),_:1},8,["onClick"]),a(te,{style:{height:"300px"},"row-data":o.value,"column-defs":w,loading:p(re),onRowClick:e[8]||(e[8]=()=>{})},null,8,["row-data","column-defs","loading"])]),u("div",Ye,[a(S,{type:"primary","html-type":"submit",loading:p(le)},{default:n(()=>[Ze,u("span",null,q(d.editMode?"Edit":"Simpan"),1)]),_:1},8,["loading"]),a(S,{class:"mx-3",onClick:G},{default:n(()=>[b(q(d.editMode?"Batal Edit":"Bersihkan"),1)]),_:1}),d.editMode?(D(),K(S,{key:0,type:"primary",loading:p(ce),onClick:ge},{default:n(()=>[et]),_:1},8,["loading"])):Ie("",!0)])])]),_:1},8,["model"])]),a(X,{visible:p(T),"onUpdate:visible":e[12]||(e[12]=l=>Z(T)?T.value=l:null),title:"Tambah Detail","cancel-text":"Tutup",onOk:e[13]||(e[13]=l=>p(H)(F.value,L))},{default:n(()=>[a(W,{ref_key:"formRefAddDet",ref:F,model:j,rules:ne,"label-col":{style:{width:"80px"}},colon:!1,"label-align":"left",onFinish:e[11]||(e[11]=l=>p(H)(F.value,L))},{default:n(()=>[a(c,{label:"Item",ref:"item",name:"item"},{default:n(()=>[a(ye,{value:j.item,"onUpdate:value":e[10]||(e[10]=l=>j.item=l)},null,8,["value"])]),_:1},512)]),_:1},8,["model"])]),_:1},8,["visible"]),a(X,{visible:p(B),"onUpdate:visible":e[14]||(e[14]=l=>Z(B)?B.value=l:null),title:"Cetak SPK",width:"80vw",centered:"","body-style":{height:"80vh"}},{footer:n(()=>[a(S,{key:"back",onClick:p(pe),type:"primary"},{default:n(()=>[b("Kembali")]),_:1},8,["onClick"])]),default:n(()=>[u("object",{data:x.value,width:"100%",height:"100%"},null,8,tt)]),_:1},8,["visible"])])}}}),it=A({__name:"DataTable",props:{idx:null},emits:["rowClick"],setup(d,{emit:s}){const i=d,g=O({value:[{field:"letter_number",headerName:"No SPK",flex:0,width:120,pinned:"left"},{field:"letter_date",headerName:"Tgl SPK",...U},{field:"title",headerName:"Judul",flex:0,width:200},{field:"worklist.worklist_number",headerName:"No Projek",flex:0,width:120},{field:"recipient_identity_number",headerName:"Penerima NIK",flex:0,width:140},{field:"recipient_name",headerName:"Penerima Nama",flex:0,width:120},{field:"recipient_position",headerName:"Penerima Jabatan",flex:0,width:150},{field:"recipient_address",headerName:"Penerima Alamat",flex:0,width:150},{field:"status_caption",headerName:"Status",flex:0,width:80},{field:"created_at",headerName:"Diinput Tgl",...U},{field:"updated_at",headerName:"Diupdate Tgl",...U},{field:"created_by_user_username",headerName:"Diinput Oleh",flex:0,width:120},{field:"updated_by_user_username",headerName:"Diupdate Oleh",flex:0,width:120}]}),w=O({value:null}),{run:h,response:x,loading:C}=$();async function o(){var _;try{await h(P.list()),(_=x.value)!=null&&_.success&&(w.value=x.value.data)}catch{}}function m(_){s("rowClick",_)}return ie(()=>{o()}),ae(()=>i.idx,()=>{o()}),(_,k)=>(D(),R("div",null,[a(te,{"row-data":w.value,"column-defs":g.value,loading:p(C),onRowClick:m},null,8,["row-data","column-defs","loading"])]))}}),nt=u("span",null,[u("i",{class:"fe fe-edit-2 me-2"}),b(" Input ")],-1),lt=u("span",null,[u("i",{class:"fe fe-search me-2"}),b(" Browse ")],-1),st=u("i",{class:"fe fe-refresh-cw me-2"},null,-1),qt=A({__name:"index",setup(d){const s=f("1"),i=f(),g=f(!1),w=f(1);function h(o){s.value="1",i.value={...o},g.value=!0}function x(){g.value=!1}function C(o){w.value+=1,o!==void 0&&(g.value=o)}return(o,m)=>{const _=Ee,k=ee,t=Ae;return D(),R("div",null,[a(t,{class:"input-browse-tab",activeKey:s.value,"onUpdate:activeKey":m[1]||(m[1]=M=>s.value=M),animated:""},Ke({default:n(()=>[a(_,{key:"1"},{tab:n(()=>[nt]),default:n(()=>[a(at,{"form-data":i.value,"edit-mode":g.value,onCancelEdit:x,onOnSuccess:C},null,8,["form-data","edit-mode"])]),_:1}),a(_,{key:"2"},{tab:n(()=>[lt]),default:n(()=>[a(it,{idx:w.value,onRowClick:h},null,8,["idx"])]),_:1})]),_:2},[s.value==="2"?{name:"rightExtra",fn:n(()=>[a(k,{size:"small",class:"mt-3",onClick:m[0]||(m[0]=M=>w.value+=1)},{default:n(()=>[st,b(" Refresh Data ")]),_:1})]),key:"0"}:void 0]),1032,["activeKey"])])}}});export{qt as default};
