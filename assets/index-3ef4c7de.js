var Ne=Object.defineProperty;var Ce=(p,n,l)=>n in p?Ne(p,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):p[n]=l;var ie=(p,n,l)=>(Ce(p,typeof n!="symbol"?n+"":n,l),l);import{B as ne}from"./index-0bb8ea7a.js";import{_ as de}from"./AgGrid.vuevuetypescriptsetuptruelang-7e3c6181.js";import{u as Pe}from"./modal-8c6b86e3.js";import{r as S,o as U,t as $e,a as I}from"./index-a5a9580b.js";import"./index-88df4a80.js";import{_ as qe}from"./index-01154693.js";/* empty css              *//* empty css              */import{b as re,I as Se,_ as Oe,F as Te}from"./Input-1a0f2199.js";import{H as Me,u as P}from"./HttpClient-ea8ece11.js";import{_ as V}from"./InputDropdown.vuevuetypescriptsetuptruelang-0cd387c5.js";import{_ as Be}from"./AgGridActionCell.vuevuetypescriptsetuptruelang-45fe2eee.js";import{P as Re}from"./ProductService-d7cf08de.js";import{d as Q,r as _,Q as K,w as se,e as ue,g as $,a7 as z,ac as c,j as G,k as o,a9 as D,b as i,u as m,aa as le,ae as He,Y as je,ak as Ee}from"./plugin-vueexport-helper-23a171d5.js";import{M as oe}from"./Modal-6ee96ca6.js";import{_ as Ie}from"./index-34514a8f.js";import{D as Ke}from"./dayjs-cc6ceebc.js";import{T as Ae,_ as Ue}from"./TabPane-5937dbd3.js";import"./DownOutlined-4b2aeb27.js";import"./pickAttrs-349b6a5f.js";import"./useMemo-18bb8ebc.js";class q{static list(){return this.HttpClient.axiosInstance.get("/purchase_invoices")}static show(n){return this.HttpClient.axiosInstance.get(`/purchase_invoices/${n}`)}static create(n){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"Faktur Beli berhasil ditambah"}).axiosInstance.post("/purchase_invoices",n)}static update(n,l){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"Faktur Beli berhasil diupdate"}).axiosInstance.put(`/purchase_invoices/${n}`,l)}static upload(n,l){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"File Faktur Beli berhasil diupload"}).axiosInstance.put(`/purchase_invoices/${n}/upload`,l)}static formOptions(){return this.HttpClient.axiosInstance.get("/purchase_invoices/form_options")}}ie(q,"HttpClient",new Me);const Ve={class:"card card-custom card-dense"},Ge={class:"card-header"},Qe={class:"card-title w-100 d-flex justify-content-between"},ze=c("h4",{class:"card-label"},"Form Faktur Beli",-1),Je={class:"card-body"},Ye={class:"row"},Le={class:"col-lg-6"},We={class:"col-lg-12"},Xe={class:"col-lg-6 mt-3"},Ze=c("i",{class:"fe fe-save me-2"},null,-1),ea=c("span",null,"Rp",-1),aa=Q({__name:"Form",props:{formData:null,editMode:{type:Boolean}},emits:["cancelEdit","onSuccess"],setup(p,{emit:n}){const l=p,k=[{headerName:"Kode Supplier",field:"code"},{headerName:"Nama Supplier",field:"name"}],w=[{headerName:"No PO",field:"purchase_order_number"}],O=[{field:"code",headerName:"Kode Produk"},{field:"name",headerName:"Nama Produk"},{field:"category_caption",headerName:"Kategori"},{field:"unit.name",headerName:"Satuan"}],N=[{field:"product.code",headerName:"Kode Produk"},{field:"product.name",headerName:"Nama Produk"},{field:"qty",headerName:"Qty",filter:"agNumberColumnFilter",type:"numericColumn",valueFormatter:a=>$e(a.value)},{field:"price",headerName:"Harga",filter:"agNumberColumnFilter",type:"numericColumn",valueFormatter:a=>S(a.value)},{headerName:"Subtotal",filter:"agNumberColumnFilter",type:"numericColumn",valueGetter:a=>a.data.qty*a.data.price,valueFormatter:a=>S(a.value)},{headerName:"Aksi",filter:!1,floatingFilter:!1,sortable:!1,resizable:!1,suppressMovable:!0,pinned:"right",width:75,flex:0,cellRenderer:Be,cellRendererParams:a=>({onDelete:()=>{g.value=g.value.filter(e=>e.id!==a.data.id),typeof a.data.id=="number"?M.value.push({id:a.data.id,_destroy:1}):F.value=F.value.filter(e=>e._id!==a.data.id)}})}],C=_([]),f=_(""),v=_(""),d=_(""),y=_(""),T=_(),x=_(),r=K({items_attributes:[]}),ce={supplier_id:[{required:!0,message:"Supplier wajib dipilih",trigger:"change"}],purchase_order_id:[{required:!0,message:"PO wajib dipilih",trigger:"change"}],invoice_date:[{required:!0,message:"Tgl faktur wajib diisi",trigger:"change"}],due_date:[{required:!0,message:"Tgl jto faktur wajib diisi",trigger:"change"}],tax_percent:[{required:!0,message:"PPn faktur wajib diisi",trigger:"change"}]},R=_(),u=K({}),pe={product_id:[{required:!0,message:"Produk wajib dipilih",trigger:"change"}],qty:[{required:!0,message:"Qty wajib diisi",trigger:"change"}],price:[{required:!0,message:"Harga wajib diisi",trigger:"change"}]},g=_([]),F=_([]),M=_([]),{run:J,loading:me,response:B}=P(),{run:_e,loading:fe,response:Y}=P(),{run:ve,loading:L,response:W}=P(),{run:ge,loading:he,response:X}=P(),{run:oa,loading:be,response:na}=P(),{visible:A,open:ye,close:da}=Pe();async function ke(){var a,e,h,H;try{l.editMode?(await J(q.update((a=l.formData)==null?void 0:a.id,{invoice_number:r.invoice_number,due_date:r.due_date,invoice_date:r.invoice_date,purchase_order_id:r.purchase_order_id,supplier_id:r.supplier_id,tax_percent:r.tax_percent,items_attributes:[...F.value,...M.value]})),(e=B.value)!=null&&e.success&&(y.value=B.value.data.total_price,F.value=[],M.value=[],g.value=B.value.data.items.map(s=>({id:s.id,price:parseFloat(s.price),qty:parseFloat(s.qty),product:s.product})))):(await J(q.create({invoice_number:r.invoice_number,due_date:r.due_date,invoice_date:r.invoice_date,purchase_order_id:r.purchase_order_id,supplier_id:r.supplier_id,tax_percent:r.tax_percent,items_attributes:g.value.map(s=>({product_id:s.product.id,qty:s.qty,price:s.price}))})),(h=B.value)!=null&&h.success&&Z()),(H=B.value)!=null&&H.success&&n("onSuccess")}catch{}}async function we(){}function Z(){var a;if(l.editMode){for(const e in r)r[e]=void 0;n("cancelEdit")}else(a=x.value)==null||a.resetFields();g.value=[],F.value=[],M.value=[],f.value="",v.value="",y.value=""}function De(){oe.confirm({title:"Konfirmasi Hapus Faktur",content:"Apakah kamu sudah yakin ingin menghapus data [Edit Here]",cancelText:"Batal",onOk:we})}function ee(){var e;const a={id:`new-${g.value.length+1}`,qty:u.qty,price:u.price,product:{code:u.product_code,name:u.product_name,id:u.product_id}};g.value=[...g.value,a],F.value.push({_id:a.id,product_id:u.product_id,qty:u.qty,price:u.price}),(e=R.value)==null||e.resetFields(),d.value=""}async function xe(){var a,e;try{await _e(q.show((a=l.formData)==null?void 0:a.id)),(e=Y.value)!=null&&e.success&&(g.value=Y.value.data.items.map(h=>({id:h.id,price:parseFloat(h.price),qty:parseFloat(h.qty),product:h.product})))}catch{}}return se(()=>l.formData,()=>{var a;l.formData&&((a=x.value)==null||a.clearValidate(),g.value=[],F.value=[],M.value=[],r.invoice_number=l.formData.invoice_number,r.due_date=l.formData.due_date,r.invoice_date=l.formData.invoice_date,r.purchase_order_id=l.formData.purchase_order.id,r.supplier_id=l.formData.supplier.id,r.tax_percent=parseFloat(l.formData.tax_percent),f.value=`${l.formData.supplier.code} - ${l.formData.supplier.name}`,v.value=l.formData.purchase_order.purchase_order_number??"",y.value=l.formData.total_price,xe())}),ue(async()=>{try{(async()=>{var a;await ve(q.formOptions()),(a=W.value)!=null&&a.success&&(T.value=W.value.data)})(),(async()=>{var a;await ge(Re.list()),(a=X.value)!=null&&a.success&&(C.value=X.value.data)})()}catch{}}),(a,e)=>{const h=Ie,H=Se,s=Oe,ae=Ke,j=qe,E=ne,te=Te,Fe=oe;return $(),z("div",Ve,[c("div",Ge,[c("div",Qe,[ze,p.editMode?($(),G(h,{key:0,color:"orange"},{default:o(()=>[D("Mode Edit")]),_:1})):($(),G(h,{key:1,color:"cyan"},{default:o(()=>[D("Mode Input")]),_:1}))])]),c("div",Je,[i(te,{ref_key:"formRef",ref:x,model:r,rules:ce,"label-col":{style:{width:"220px"}},colon:!1,"label-align":"left",onFinish:e[7]||(e[7]=t=>m(U)(x.value,ke))},{default:o(()=>[c("div",Ye,[c("div",Le,[i(s,{label:"No Faktur"},{default:o(()=>[i(H,{value:r.invoice_number,"onUpdate:value":e[0]||(e[0]=t=>r.invoice_number=t)},null,8,["value"])]),_:1}),i(s,{label:"Supplier",name:"supplier_id",ref:"supplier_id"},{default:o(()=>{var t;return[i(V,{"column-defs":k,"grid-data":((t=T.value)==null?void 0:t.suppliers)??[],loading:m(L),value:void 0,"value-display":f.value,onChange:e[1]||(e[1]=b=>{r.supplier_id=b.id,f.value=`${b.code} - ${b.name}`})},null,8,["grid-data","loading","value-display"])]}),_:1},512),i(s,{label:"No PO",name:"purchase_order_id",ref:"purchase_order_id"},{default:o(()=>{var t;return[i(V,{"column-defs":w,"grid-data":((t=T.value)==null?void 0:t.purchase_order_id)??[],loading:m(L),value:void 0,"value-display":v.value,onChange:e[2]||(e[2]=b=>{r.purchase_order_id=b.id,v.value=`${b.purchase_order_number}`})},null,8,["grid-data","loading","value-display"])]}),_:1},512),i(s,{label:"Tgl Faktur",name:"invoice_date",ref:"invoice_date"},{default:o(()=>[i(ae,{value:r.invoice_date?m(re)(r.invoice_date):void 0,onChange:e[3]||(e[3]=(t,b)=>r.invoice_date=b)},null,8,["value"])]),_:1},512),i(s,{label:"Tgl JTO Faktur",name:"due_date",ref:"due_date"},{default:o(()=>[i(ae,{value:r.due_date?m(re)(r.due_date):void 0,onChange:e[4]||(e[4]=(t,b)=>r.due_date=b)},null,8,["value"])]),_:1},512),i(s,{label:"PPn %",name:"tax_percent",ref:"tax_percent"},{default:o(()=>[i(j,{value:r.tax_percent,"onUpdate:value":e[5]||(e[5]=t=>r.tax_percent=t),min:0},null,8,["value"])]),_:1},512),i(s,{label:"Total Faktur"},{default:o(()=>[i(j,{value:y.value?m(S)(y.value):"",disabled:""},null,8,["value"])]),_:1})]),c("div",We,[i(E,{class:"mb-3",type:"primary",onClick:m(ye)},{default:o(()=>[D(" Tambah ")]),_:1},8,["onClick"]),i(de,{style:{height:"300px"},"row-data":g.value,"column-defs":N,loading:m(fe),onRowClick:e[6]||(e[6]=()=>{})},null,8,["row-data","column-defs","loading"])]),c("div",Xe,[i(E,{type:"primary","html-type":"submit",loading:m(me)},{default:o(()=>[Ze,c("span",null,le(p.editMode?"Edit":"Simpan"),1)]),_:1},8,["loading"]),i(E,{class:"mx-3",onClick:Z},{default:o(()=>[D(le(p.editMode?"Batal Edit":"Bersihkan"),1)]),_:1}),p.editMode?($(),G(E,{key:0,danger:"",type:"primary",onClick:De,loading:m(be)},{default:o(()=>[D(" Hapus ")]),_:1},8,["loading"])):He("",!0)])])]),_:1},8,["model"])]),i(Fe,{visible:m(A),"onUpdate:visible":e[12]||(e[12]=t=>je(A)?A.value=t:null),title:"Tambah Detail","cancel-text":"Tutup",onOk:e[13]||(e[13]=t=>m(U)(R.value,ee))},{default:o(()=>[i(te,{ref_key:"formRefAddDet",ref:R,model:u,rules:pe,"label-col":{style:{width:"220px"}},colon:!1,"label-align":"left",onFinish:e[11]||(e[11]=t=>m(U)(R.value,ee))},{default:o(()=>[i(s,{label:"Produk",name:"product_id",ref:"product_id"},{default:o(()=>[i(V,{"column-defs":O,"grid-data":C.value??[],loading:m(he),value:void 0,"value-display":d.value,onChange:e[8]||(e[8]=t=>{u.product_id=t.id,u.product_code=t.code,u.product_name=t.name,d.value=`${t.code} - ${t.name}`})},null,8,["grid-data","loading","value-display"])]),_:1},512),i(s,{label:"Qty",name:"qty",ref:"qty"},{default:o(()=>[i(j,{value:u.qty,"onUpdate:value":e[9]||(e[9]=t=>u.qty=t),min:0,formatter:t=>`${t}`.replace(/\B(?=(\d{3})+(?!\d))/g,"."),parser:t=>t.replace(/\$\s?|(\.*)/g,"")},null,8,["value","formatter","parser"])]),_:1},512),i(s,{label:"Harga",name:"price",ref:"price"},{default:o(()=>[i(j,{value:u.price,"onUpdate:value":e[10]||(e[10]=t=>u.price=t),min:0,formatter:t=>`${t}`.replace(/\B(?=(\d{3})+(?!\d))/g,"."),parser:t=>t.replace(/\$\s?|(\.*)/g,"")},{addonBefore:o(()=>[ea]),_:1},8,["value","formatter","parser"])]),_:1},512)]),_:1},8,["model"])]),_:1},8,["visible"])])}}}),ta=Q({__name:"DataTable",props:{idx:null},emits:["rowClick"],setup(p,{emit:n}){const l=p,k=K({value:[{field:"invoice_number",headerName:"No. Faktur",width:120,flex:0,pinned:"left"},{field:"purchase_order.purchase_order_number",headerName:"No. PO",width:120,flex:0,pinned:"left"},{field:"supplier.name",headerName:"Supplier",width:120,flex:0},{field:"invoice_date",headerName:"Tgl Faktur",...I},{field:"due_date",headerName:"Tgl Jto",...I},{field:"subtotal",headerName:"Subtotal",filter:"agNumberColumnFilter",type:"numericColumn",width:100,flex:0,valueFormatter:d=>S(d.value)},{field:"tax_percent",headerName:"PPn %",filter:"agNumberColumnFilter",type:"numericColumn",width:80,flex:0,valueGetter:d=>parseFloat(d.data.tax_percent)},{field:"tax_nominal",headerName:"PPn Nilai",filter:"agNumberColumnFilter",type:"numericColumn",width:100,flex:0,valueFormatter:d=>S(d.value)},{field:"total_price",headerName:"Grand Total",filter:"agNumberColumnFilter",type:"numericColumn",width:120,flex:0,valueFormatter:d=>S(d.value)},{field:"created_at",headerName:"Diinput Tgl",...I},{field:"updated_at",headerName:"Diupdate Tgl",...I},{field:"created_by_user_username",headerName:"Diinput Oleh",flex:0,width:120},{field:"updated_by_user_username",headerName:"Diupdate Oleh",flex:0,width:120}]}),w=K({value:null}),{run:O,response:N,loading:C}=P();async function f(){var d;try{await O(q.list()),(d=N.value)!=null&&d.success&&(w.value=N.value.data)}catch{}}function v(d){n("rowClick",d)}return ue(()=>{f()}),se(()=>l.idx,()=>{f()}),(d,y)=>($(),z("div",null,[i(de,{"row-data":w.value,"column-defs":k.value,loading:m(C),onRowClick:v},null,8,["row-data","column-defs","loading"])]))}}),ia=c("span",null,[c("i",{class:"fe fe-edit-2 me-2"}),D(" Input ")],-1),ra=c("span",null,[c("i",{class:"fe fe-search me-2"}),D(" Browse ")],-1),la=c("i",{class:"fe fe-refresh-cw me-2"},null,-1),Sa=Q({__name:"index",setup(p){const n=_("1"),l=_(),k=_(!1),w=_(1);function O(f){n.value="1",l.value={...f},k.value=!0}function N(){k.value=!1}function C(f){w.value+=1,f!==void 0&&(k.value=f)}return(f,v)=>{const d=Ue,y=ne,T=Ae;return $(),z("div",null,[i(T,{class:"input-browse-tab",activeKey:n.value,"onUpdate:activeKey":v[1]||(v[1]=x=>n.value=x),animated:""},Ee({default:o(()=>[i(d,{key:"1"},{tab:o(()=>[ia]),default:o(()=>[i(aa,{"form-data":l.value,"edit-mode":k.value,onCancelEdit:N,onOnSuccess:C},null,8,["form-data","edit-mode"])]),_:1}),i(d,{key:"2"},{tab:o(()=>[ra]),default:o(()=>[i(ta,{idx:w.value,onRowClick:O},null,8,["idx"])]),_:1})]),_:2},[n.value==="2"?{name:"rightExtra",fn:o(()=>[i(y,{size:"small",class:"mt-3",onClick:v[0]||(v[0]=x=>w.value+=1)},{default:o(()=>[la,D(" Refresh Data ")]),_:1})]),key:"0"}:void 0]),1032,["activeKey"])])}}});export{Sa as default};
