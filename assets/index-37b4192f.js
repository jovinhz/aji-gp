var Be=Object.defineProperty;var Ie=(c,d,l)=>d in c?Be(c,d,{enumerable:!0,configurable:!0,writable:!0,value:l}):c[d]=l;var le=(c,d,l)=>(Ie(c,typeof d!="symbol"?d+"":d,l),l);import{B as _e}from"./index-0bb8ea7a.js";import{_ as fe}from"./AgGrid.vuevuetypescriptsetuptruelang-7e3c6181.js";import{u as oe}from"./modal-8c6b86e3.js";import{r as M,o as G,t as Ke,a as Q}from"./index-a5a9580b.js";import"./index-88df4a80.js";import{_ as Ee}from"./index-01154693.js";import{_ as Ae,S as Ve}from"./index-a0c069f5.js";/* empty css              *//* empty css              */import{b as Ge,I as Qe,_ as ze,F as Je}from"./Input-1a0f2199.js";import{H as Le,u as F}from"./HttpClient-ea8ece11.js";import{_ as de}from"./InputDropdown.vuevuetypescriptsetuptruelang-0cd387c5.js";import{_ as Ye}from"./AgGridActionCell.vuevuetypescriptsetuptruelang-45fe2eee.js";import{P as We}from"./ProductService-d7cf08de.js";import{d as z,r as f,Q as E,w as ve,e as ge,g as k,a7 as U,ac as m,j as T,k as n,a9 as y,b as r,u as p,F as se,ab as ue,aa as K,ae as ce,Y as me,ak as Xe}from"./plugin-vueexport-helper-23a171d5.js";import{M as pe}from"./Modal-6ee96ca6.js";import{_ as Ze}from"./index-34514a8f.js";import{D as ea}from"./dayjs-cc6ceebc.js";import{_ as aa}from"./TextArea-c9a675dc.js";import{T as ta,_ as ra}from"./TabPane-5937dbd3.js";import"./DownOutlined-4b2aeb27.js";import"./pickAttrs-349b6a5f.js";import"./useMemo-18bb8ebc.js";import"./SearchOutlined-731e9f20.js";class q{static list(d,l){return this.HttpClient.axiosInstance.get("/purchase_orders",{params:{start_date:d,end_date:l}})}static show(d){return this.HttpClient.axiosInstance.get(`/purchase_orders/${d}`)}static create(d){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"PO berhasil dibuat"}).axiosInstance.post("/purchase_orders",d)}static update(d,l){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"PO berhasil diupdate"}).axiosInstance.put(`/purchase_orders/${d}`,l)}static print(d){return this.HttpClient.axiosInstance.get(`/purchase_orders/${d}/print`)}static formOptions(){return this.HttpClient.axiosInstance.get("/purchase_orders/form_options")}}le(q,"HttpClient",new Le);const na={class:"card card-custom card-dense"},ia={class:"card-header"},la={class:"card-title w-100 d-flex justify-content-between"},oa=m("h4",{class:"card-label"},"Form Purchase Order",-1),da={class:"card-body"},sa={class:"row"},ua={class:"col-lg-6"},ca=m("span",null,"Hari",-1),ma={class:"col-lg-12"},pa={class:"col-lg-6 mt-3"},_a=m("i",{class:"fe fe-save me-2"},null,-1),fa=m("span",null,"Rp",-1),va=["data"],ga=z({__name:"Form",props:{formData:null,editMode:{type:Boolean}},emits:["cancelEdit","onSuccess"],setup(c,{emit:d}){const l=c,D=[{headerName:"Kode Supplier",field:"code"},{headerName:"Nama Supplier",field:"name"}],x=[{headerName:"Kode Produk",field:"product_code"},{headerName:"Nama Produk",field:"product_name"},{headerName:"Qty",field:"qty",filter:"agNumberColumnFilter",type:"numericColumn",valueFormatter:i=>Ke(i.value)},{headerName:"Harga",field:"price",filter:"agNumberColumnFilter",type:"numericColumn",valueFormatter:i=>M(i.value)},{headerName:"Subtotal",filter:"agNumberColumnFilter",type:"numericColumn",valueGetter:i=>i.data.qty*i.data.price,valueFormatter:i=>M(i.value)},{headerName:"Catatan",field:"note"},{headerName:"Aksi",filter:!1,floatingFilter:!1,sortable:!1,resizable:!1,suppressMovable:!0,pinned:"right",width:75,flex:0,cellRenderer:Ye,cellRendererParams:i=>({onDelete:()=>{h.value=h.value.filter(a=>a.id!==i.data.id),typeof i.data.id=="number"?j.value.push({id:i.data.id,_destroy:1}):P.value=P.value.filter(a=>a._id!==i.data.id)}})}],H=[{field:"code",headerName:"Kode Produk"},{field:"name",headerName:"Nama Produk"},{field:"category_caption",headerName:"Kategori"},{field:"unit.name",headerName:"Satuan"}],C=f(),N=f(""),v=f(""),g=f(""),u=f([]),$=f(""),S=f(),e=E({}),ye={supplier_id:[{required:!0,message:"Kode satuan wajib diisi",trigger:"change"}],date:[{required:!0,message:"Tanggal wajib diisi",trigger:"change"}],status_id:[{required:!0,message:"Status wajib dipilih",trigger:"change"}],tax_percentage:[{required:!0,message:"Persen PPn wajib diisi",trigger:"change"}],for_attention:[{required:!0,message:"Nama PIC wajib diisi",trigger:"change"}],payment_method_id:[{required:!0,message:"Metode pembayaran wajib dipilih",trigger:"change"}],delivery_via:[{required:!0,message:"Delivery via wajib diisi",trigger:"change"}],payment_term_in_days:[{required:!0,message:"Pembayaran jatuh tempo wajib diisi",trigger:"change"}],tnc_price:[{required:!0,message:"T&C harga wajib diisi",trigger:"change"}],tnc_franco:[{required:!0,message:"T&C franco wajib diisi",trigger:"change"}],remark:[{required:!0,message:"Remark wajib diisi",trigger:"change"}]},B=f(),s=E({}),he={product_id:[{required:!0,message:"Produk wajib dipilih",trigger:"change"}],qty:[{required:!0,message:"Qty wajib diisi",trigger:"change"}],price:[{required:!0,message:"Harga wajib diisi",trigger:"change"}]},h=f([]),P=f([]),j=f([]),{run:J,loading:be,response:R}=F(),{run:ke,loading:we,response:L}=F(),{run:Ce,loading:De,response:Y}=F(),{run:wa,loading:xe,response:Ca}=F(),{run:Ne,loading:Pe,response:W}=F(),{run:Fe,loading:qe,response:X}=F(),{visible:A,open:$e,close:Da}=oe(),{visible:V,open:Se,close:Oe}=oe();async function Te(){var i,a,_,w;try{l.editMode?(await J(q.update((i=l.formData)==null?void 0:i.id,{date:e.date,delivery_via:e.delivery_via,for_attention:e.delivery_via,note:e.note,payment_method_id:e.payment_method_id,payment_term_in_days:e.payment_term_in_days,remark:e.remark,status_id:e.status_id,supplier_id:e.supplier_id,tax_percentage:e.tax_percentage,tnc_franco:e.tnc_franco,tnc_price:e.tnc_price,items_attributes:[...P.value,...j.value]})),(a=R.value)!=null&&a.success&&(g.value=R.value.data.total_price,P.value=[],j.value=[],h.value=R.value.data.items.map(o=>({id:o.id,price:parseFloat(o.price),qty:parseFloat(o.qty),note:o.note,product_id:o.product.id,product_code:o.product.code,product_name:o.product.name})))):(await J(q.create({date:e.date,delivery_via:e.delivery_via,for_attention:e.delivery_via,note:e.note,payment_method_id:e.payment_method_id,payment_term_in_days:e.payment_term_in_days,remark:e.remark,status_id:e.status_id,supplier_id:e.supplier_id,tax_percentage:e.tax_percentage,tnc_franco:e.tnc_franco,tnc_price:e.tnc_price,warehouse_id:1,items_attributes:h.value.map(o=>({product_id:o.product_id,price:o.price,qty:o.qty,note:o.note}))})),(_=R.value)!=null&&_.success&&Z()),(w=R.value)!=null&&w.success&&d("onSuccess")}catch{}}async function Me(){}function Z(){var i;if(l.editMode){for(const a in e)e[a]=void 0;d("cancelEdit")}else(i=S.value)==null||i.resetFields();h.value=[],P.value=[],j.value=[],N.value="",g.value=""}function He(){pe.confirm({title:"Konfirmasi Hapus PO",content:"Apakah kamu sudah yakin ingin menghapus data [Edit Here]",cancelText:"Batal",onOk:Me})}async function je(){var i,a;try{await ke(q.show((i=l.formData)==null?void 0:i.id)),(a=L.value)!=null&&a.success&&(h.value=L.value.data.items.map(_=>({id:_.id,product_id:_.product.id,product_code:_.product.code,product_name:_.product.name,qty:parseFloat(_.qty),price:parseFloat(_.price),note:_.note})))}catch{}}function ee(){var a;const i={id:`new-${h.value.length+1}`,qty:s.qty,price:s.price,product_id:s.product_id,product_code:s.product_code,product_name:s.product_name,note:s.note};h.value=[...h.value,i],P.value.push({_id:i.id,product_id:s.product_id,qty:s.qty,price:s.price,note:s.note}),(a=B.value)==null||a.resetFields(),v.value=""}async function Re(){var i,a;try{await Fe(q.print((i=l.formData)==null?void 0:i.id)),(a=X.value)!=null&&a.success&&($.value="data:application/pdf;base64,"+X.value.data.base64,Se())}catch{}}return ve(()=>l.formData,()=>{var i;l.formData&&((i=S.value)==null||i.clearValidate(),h.value=[],P.value=[],j.value=[],e.supplier_id=l.formData.supplier.id,e.status_id=l.formData.status_id,e.date=l.formData.date,e.delivery_via=l.formData.delivery_via,e.for_attention=l.formData.for_attention,e.note=l.formData.note,e.payment_method_id=l.formData.payment_method_id,e.payment_term_in_days=l.formData.payment_term_in_days,e.remark=l.formData.remark,e.tax_percentage=parseFloat(l.formData.tax_percentage),e.tnc_franco=l.formData.tnc_franco,e.tnc_price=l.formData.tnc_price,N.value=`${l.formData.supplier.code} - ${l.formData.supplier.name}`,g.value=l.formData.total_price,je())}),ge(()=>{try{(async()=>{var i;await Ce(q.formOptions()),(i=Y.value)!=null&&i.success&&(C.value=Y.value.data)})(),(async()=>{var i;await Ne(We.list()),(i=W.value)!=null&&i.success&&(u.value=W.value.data)})()}catch{}}),(i,a)=>{const _=Ze,w=Qe,o=ze,Ue=ea,ae=Ve,te=Ae,I=Ee,re=aa,O=_e,ne=Je,ie=pe;return k(),U("div",na,[m("div",ia,[m("div",la,[oa,c.editMode?(k(),T(_,{key:0,color:"orange"},{default:n(()=>[y("Mode Edit")]),_:1})):(k(),T(_,{key:1,color:"cyan"},{default:n(()=>[y("Mode Input")]),_:1}))])]),m("div",da,[r(ne,{ref_key:"formRef",ref:S,model:e,rules:ye,"label-col":{style:{width:"220px"}},colon:!1,"label-align":"left",onFinish:a[13]||(a[13]=t=>p(G)(S.value,Te))},{default:n(()=>[m("div",sa,[m("div",ua,[r(o,{label:"No PO"},{default:n(()=>{var t;return[r(w,{value:c.editMode?(t=c.formData)==null?void 0:t.purchase_order_number:"",disabled:""},null,8,["value"])]}),_:1}),r(o,{label:"Supplier",name:"supplier_id",ref:"supplier_id"},{default:n(()=>{var t;return[r(de,{"column-defs":D,"grid-data":((t=C.value)==null?void 0:t.suppliers)??[],loading:p(De),value:void 0,"value-display":N.value,onChange:a[0]||(a[0]=b=>{e.supplier_id=b.id,N.value=`${b.code} - ${b.name}`})},null,8,["grid-data","loading","value-display"])]}),_:1},512),r(o,{label:"Untuk PIC",name:"for_attention",ref:"for_attention"},{default:n(()=>[r(w,{value:e.for_attention,"onUpdate:value":a[1]||(a[1]=t=>e.for_attention=t)},null,8,["value"])]),_:1},512),r(o,{label:"Tgl PO",name:"date",ref:"date"},{default:n(()=>[r(Ue,{value:e.date?p(Ge)(e.date):void 0,onChange:a[2]||(a[2]=(t,b)=>e.date=b)},null,8,["value"])]),_:1},512),r(o,{label:"Metode Pembayaran",name:"payment_method_id",ref:"payment_method_id"},{default:n(()=>[r(te,{value:e.payment_method_id,"onUpdate:value":a[3]||(a[3]=t=>e.payment_method_id=t)},{default:n(()=>{var t;return[(k(!0),U(se,null,ue((t=C.value)==null?void 0:t.payment_methods,b=>(k(),T(ae,{value:b.id},{default:n(()=>[y(K(b.title),1)]),_:2},1032,["value"]))),256))]}),_:1},8,["value"])]),_:1},512),r(o,{label:"Pembayaran Jatuh Tempo",name:"payment_term_in_days",ref:"payment_term_in_days"},{default:n(()=>[r(I,{value:e.payment_term_in_days,"onUpdate:value":a[4]||(a[4]=t=>e.payment_term_in_days=t),min:"0"},{addonAfter:n(()=>[ca]),_:1},8,["value"])]),_:1},512),r(o,{label:"Status",name:"status_id",ref:"status_id"},{default:n(()=>[r(te,{value:e.status_id,"onUpdate:value":a[5]||(a[5]=t=>e.status_id=t)},{default:n(()=>{var t;return[(k(!0),U(se,null,ue((t=C.value)==null?void 0:t.statuses,b=>(k(),T(ae,{value:b.id},{default:n(()=>[y(K(b.title),1)]),_:2},1032,["value"]))),256))]}),_:1},8,["value"])]),_:1},512),r(o,{label:"PPn %",name:"tax_percentage",ref:"tax_percentage"},{default:n(()=>[r(I,{value:e.tax_percentage,"onUpdate:value":a[6]||(a[6]=t=>e.tax_percentage=t),min:0},null,8,["value"])]),_:1},512),r(o,{label:"T&C Franco",name:"tnc_franco",ref:"tnc_franco"},{default:n(()=>[r(w,{value:e.tnc_franco,"onUpdate:value":a[7]||(a[7]=t=>e.tnc_franco=t)},null,8,["value"])]),_:1},512),r(o,{label:"T&C Harga",name:"tnc_price",ref:"tnc_price"},{default:n(()=>[r(w,{value:e.tnc_price,"onUpdate:value":a[8]||(a[8]=t=>e.tnc_price=t)},null,8,["value"])]),_:1},512),r(o,{label:"Remark",name:"remark",ref:"remark"},{default:n(()=>[r(w,{value:e.remark,"onUpdate:value":a[9]||(a[9]=t=>e.remark=t)},null,8,["value"])]),_:1},512),r(o,{label:"Delivery Via",name:"delivery_via",ref:"delivery_via"},{default:n(()=>[r(w,{value:e.delivery_via,"onUpdate:value":a[10]||(a[10]=t=>e.delivery_via=t)},null,8,["value"])]),_:1},512),r(o,{label:"Keterangan",name:"note",ref:"note"},{default:n(()=>[r(re,{value:e.note,"onUpdate:value":a[11]||(a[11]=t=>e.note=t)},null,8,["value"])]),_:1},512),r(o,{label:"Total Harga"},{default:n(()=>[r(w,{value:g.value?p(M)(g.value):"",disabled:""},null,8,["value"])]),_:1})]),m("div",ma,[r(O,{class:"mb-3",type:"primary",onClick:p($e)},{default:n(()=>[y(" Tambah ")]),_:1},8,["onClick"]),r(fe,{style:{height:"300px"},"row-data":h.value,"column-defs":x,loading:p(we),onRowClick:a[12]||(a[12]=()=>{})},null,8,["row-data","column-defs","loading"])]),m("div",pa,[r(O,{type:"primary","html-type":"submit",loading:p(be)},{default:n(()=>[_a,m("span",null,K(c.editMode?"Edit":"Simpan"),1)]),_:1},8,["loading"]),r(O,{class:"mx-3",onClick:Z},{default:n(()=>[y(K(c.editMode?"Batal Edit":"Bersihkan"),1)]),_:1}),c.editMode?(k(),T(O,{key:0,class:"me-3",danger:"",type:"primary",loading:p(xe),onClick:He},{default:n(()=>[y(" Hapus ")]),_:1},8,["loading"])):ce("",!0),c.editMode?(k(),T(O,{key:1,type:"primary",loading:p(qe),onClick:Re},{default:n(()=>[y(" Cetak ")]),_:1},8,["loading"])):ce("",!0)])])]),_:1},8,["model"])]),r(ie,{visible:p(A),"onUpdate:visible":a[19]||(a[19]=t=>me(A)?A.value=t:null),title:"Tambah Detail","cancel-text":"Tutup",onOk:a[20]||(a[20]=t=>p(G)(B.value,ee))},{default:n(()=>[r(ne,{ref_key:"formRefAddDet",ref:B,model:s,rules:he,"label-col":{style:{width:"220px"}},colon:!1,"label-align":"left",onFinish:a[18]||(a[18]=t=>p(G)(B.value,ee))},{default:n(()=>[r(o,{label:"Produk",name:"product_id",ref:"product_id"},{default:n(()=>[r(de,{"column-defs":H,"grid-data":u.value??[],loading:p(Pe),value:void 0,"value-display":v.value,onChange:a[14]||(a[14]=t=>{s.product_id=t.id,s.product_code=t.code,s.product_name=t.name,v.value=`${t.code} - ${t.name}`})},null,8,["grid-data","loading","value-display"])]),_:1},512),r(o,{label:"Qty",name:"qty",ref:"qty"},{default:n(()=>[r(I,{value:s.qty,"onUpdate:value":a[15]||(a[15]=t=>s.qty=t),min:0,formatter:t=>`${t}`.replace(/\B(?=(\d{3})+(?!\d))/g,"."),parser:t=>t.replace(/\$\s?|(\.*)/g,"")},null,8,["value","formatter","parser"])]),_:1},512),r(o,{label:"Harga",name:"price",ref:"price"},{default:n(()=>[r(I,{value:s.price,"onUpdate:value":a[16]||(a[16]=t=>s.price=t),min:0,formatter:t=>`${t}`.replace(/\B(?=(\d{3})+(?!\d))/g,"."),parser:t=>t.replace(/\$\s?|(\.*)/g,"")},{addonBefore:n(()=>[fa]),_:1},8,["value","formatter","parser"])]),_:1},512),r(o,{label:"Catatan",name:"note",ref:"note"},{default:n(()=>[r(re,{value:s.note,"onUpdate:value":a[17]||(a[17]=t=>s.note=t)},null,8,["value"])]),_:1},512)]),_:1},8,["model"])]),_:1},8,["visible"]),r(ie,{visible:p(V),"onUpdate:visible":a[21]||(a[21]=t=>me(V)?V.value=t:null),title:"Cetak PO",width:"80vw",centered:"","body-style":{height:"80vh"}},{footer:n(()=>[r(O,{key:"back",onClick:p(Oe),type:"primary"},{default:n(()=>[y("Kembali")]),_:1},8,["onClick"])]),default:n(()=>[m("object",{data:$.value,width:"100%",height:"100%"},null,8,va)]),_:1},8,["visible"])])}}}),ya=z({__name:"DataTable",props:{idx:null},emits:["rowClick"],setup(c,{emit:d}){const l=c,D=E({value:[{field:"purchase_order_number",headerName:"No. PO",width:120,flex:0,pinned:"left"},{field:"supplier.name",headerName:"Supplier",width:120,flex:0,pinned:"left"},{field:"for_attention",headerName:"Utk PIC",width:120,flex:0},{field:"date",headerName:"Tgl PO",...Q},{field:"status_caption",headerName:"Status",width:120,flex:0},{field:"subtotal",headerName:"Subtotal",width:100,flex:0,valueFormatter:u=>M(u.value)},{field:"tax_percentage",headerName:"PPn (%)",width:90,flex:0,filter:"agNumberColumnFilter",type:"numericColumn",valueGetter:u=>parseFloat(u.data.tax_percentage)},{field:"tax_nominal",headerName:"PPn Nilai",filter:"agNumberColumnFilter",type:"numericColumn",width:100,flex:0,valueFormatter:u=>M(u.value)},{field:"total_price",headerName:"Grand Total",filter:"agNumberColumnFilter",type:"numericColumn",width:120,flex:0,valueFormatter:u=>M(u.value)},{field:"payment_method_caption",headerName:"Metode Pembayaran",width:100,flex:0},{field:"payment_term_in_days",headerName:"JTO (Hari)",width:100,flex:0,filter:"agNumberColumnFilter",type:"numericColumn"},{field:"tnc_franco",headerName:"T&C Franco",width:100,flex:0},{field:"tnc_price",headerName:"T&C Harga",width:120,flex:0},{field:"remark",headerName:"Remark",width:100,flex:0},{field:"delivery_via",headerName:"Delivery Via",width:100,flex:0},{field:"note",headerName:"Catatan",width:100,flex:0},{field:"created_at",headerName:"Diinput Tgl",...Q},{field:"updated_at",headerName:"Diupdate Tgl",...Q},{field:"created_by_user_username",headerName:"Diinput Oleh",flex:0,width:120},{field:"updated_by_user_username",headerName:"Diupdate Oleh",flex:0,width:120}]}),x=E({value:null}),{run:H,response:C,loading:N}=F();async function v(){var u;try{await H(q.list()),(u=C.value)!=null&&u.success&&(x.value=C.value.data)}catch{}}function g(u){d("rowClick",u)}return ge(()=>{v()}),ve(()=>l.idx,()=>{v()}),(u,$)=>(k(),U("div",null,[r(fe,{"row-data":x.value,"column-defs":D.value,loading:p(N),onRowClick:g},null,8,["row-data","column-defs","loading"])]))}}),ha=m("span",null,[m("i",{class:"fe fe-edit-2 me-2"}),y(" Input ")],-1),ba=m("span",null,[m("i",{class:"fe fe-search me-2"}),y(" Browse ")],-1),ka=m("i",{class:"fe fe-refresh-cw me-2"},null,-1),Ya=z({__name:"index",setup(c){const d=f("1"),l=f(),D=f(!1),x=f(1);function H(v){d.value="1",l.value={...v},D.value=!0}function C(){D.value=!1}function N(v){x.value+=1,v!==void 0&&(D.value=v)}return(v,g)=>{const u=ra,$=_e,S=ta;return k(),U("div",null,[r(S,{class:"input-browse-tab",activeKey:d.value,"onUpdate:activeKey":g[1]||(g[1]=e=>d.value=e),animated:""},Xe({default:n(()=>[r(u,{key:"1"},{tab:n(()=>[ha]),default:n(()=>[r(ga,{"form-data":l.value,"edit-mode":D.value,onCancelEdit:C,onOnSuccess:N},null,8,["form-data","edit-mode"])]),_:1}),r(u,{key:"2"},{tab:n(()=>[ba]),default:n(()=>[r(ya,{idx:x.value,onRowClick:H},null,8,["idx"])]),_:1})]),_:2},[d.value==="2"?{name:"rightExtra",fn:n(()=>[r($,{size:"small",class:"mt-3",onClick:g[0]||(g[0]=e=>x.value+=1)},{default:n(()=>[ka,y(" Refresh Data ")]),_:1})]),key:"0"}:void 0]),1032,["activeKey"])])}}});export{Ya as default};
