var je=Object.defineProperty;var Se=(d,i,n)=>i in d?je(d,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):d[i]=n;var J=(d,i,n)=>(Se(d,typeof i!="symbol"?i+"":i,n),n);import{B as oe}from"./index-c2b9e26d.js";import{_ as le}from"./AgGrid.vuevuetypescriptsetuptruelang-57924cd0.js";import{H as $e,u as x,o as X,a as S}from"./HttpClient-05f26028.js";import{_ as Ue}from"./index-81b2037c.js";/* empty css              */import{u as Z,W as j}from"./modal-5687005b.js";import{b as Re,I as Be,Y as He,F as Ee}from"./index-d35a0029.js";import{_ as Ie,S as Ke}from"./index-2ff3d0ef.js";import{d as I,r as b,Q as $,w as ie,e as re,g as p,a7 as N,ac as m,j as M,k as a,a9 as _,b as t,u as c,F as ee,ab as te,ae,aa as U,Y as se,ak as Pe}from"./plugin-vueexport-helper-23a171d5.js";import{M as ne}from"./Modal-3e6de3d8.js";import{_ as Ve,T as qe,a as Ge}from"./index-69e0b682.js";import{D as Le}from"./dayjs-974ed3f2.js";import{_ as We}from"./TextArea-9d658de9.js";import"./SearchOutlined-c93a7c7c.js";class R{static list(i){return this.HttpClient.axiosInstance.get(`/workers/${i}/worker_debt_histories`)}static create(i,n){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"Transaksi berhasil ditambah"}).axiosInstance.post(`/workers/${i}/worker_debt_histories`,n)}static update(i,n){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"Transaksi berhasil diupdate"}).axiosInstance.put(`/workers/${i}`,n)}static formOptions(){return this.HttpClient.axiosInstance.get("/workers/current/worker_debt_histories/form_options")}}J(R,"HttpClient",new $e);const Ye={class:"card card-custom card-dense"},ze={class:"card-header"},Ae={class:"card-title w-100 d-flex justify-content-between"},Qe=m("h4",{class:"card-label"},"Form Pekerja",-1),Je={class:"card-body"},Xe={class:"row"},Ze={class:"col-lg-6"},et={key:0,class:"d-flex align-items-baseline flex-column flex-md-row mb-5"},tt=m("i",{class:"fe fe-save me-2"},null,-1),at=I({__name:"Form",props:{formData:null,editMode:{type:Boolean}},emits:["cancelEdit","onSuccess"],setup(d,{emit:i}){const n=d,g=[{field:"debt_date",headerName:"Tgl Transaksi",...S},{field:"type_caption",headerName:"Tipe Transaksi"},{field:"formatted_value",headerName:"Nominal",type:"numericColumn",filter:"agNumberColumnFilter",filterValueGetter:l=>parseFloat(l.data.value)},{field:"description",headerName:"Deskripsi"},{field:"created_at",headerName:"Diinput Tgl",...S},{field:"updated_at",headerName:"Diupdate Tgl",...S},{field:"created_by_user_username",headerName:"Diinput Oleh",flex:0,width:120},{field:"updated_by_user_username",headerName:"Diupdate Oleh",flex:0,width:120}],v=b(""),C=b(),D=b(),k=b(),s=$({status_id:1}),h={code:[{required:!0,message:"Kode pekerja wajib diisi",trigger:"change"}],name:[{required:!0,message:"Nama pekerja wajib diisi",trigger:"change"}]},u=b(),r=$({}),B={debt_date:[{required:!0,message:"Tanggal transaksi wajib diisi",trigger:"change"}],value:[{required:!0,message:"Nominal wajib diisi",trigger:"change"}],type_id:[{required:!0,message:"Tipe transaksi wajib dipilih",trigger:"change"}]},{run:T,loading:de,response:K}=x(),{run:ue,loading:ce,response:P}=x(),{run:me,loading:fe,response:V}=x(),{run:pe,loading:it,response:q}=x(),{run:_e,loading:ve,response:be}=x(),{visible:H,open:ge,close:rt}=Z(),{visible:E,open:ke,close:he}=Z(),G=$({value:null}),{run:dt,loading:ye,response:ut}=x();async function De(){var l,e,f;try{n.editMode?await T(j.update((l=n.formData)==null?void 0:l.id,{name:s.name,status_id:s.status_id})):(await T(j.create({code:s.code.toUpperCase(),name:s.name,status_id:s.status_id})),(e=K.value)!=null&&e.success&&L()),(f=K.value)!=null&&f.success&&i("onSuccess")}catch{}}async function we(){var l,e;try{await _e(R.create((l=n.formData)==null?void 0:l.id,{debt_date:r.debt_date,type_id:r.type_id,value:r.value,description:r.description})),(e=be.value)!=null&&e.success&&(W(),Ce(),he(),(async()=>{var w;const f=await j.show((w=n.formData)==null?void 0:w.id);f.success&&(v.value=f.data.formatted_total_debt)})())}catch{}}async function xe(){}function L(){var l;if(n.editMode){for(const e in s)s[e]=void 0;s.status_id=1,i("cancelEdit")}else(l=k.value)==null||l.resetFields()}function Ce(){var l;for(const e in s)r[e]=void 0;(l=u.value)==null||l.resetFields()}function Ne(){ne.confirm({title:"Konfirmasi Hapus Pekerja",content:"Apakah kamu sudah yakin ingin menghapus data [Edit Here]",cancelText:"Batal",onOk:xe})}async function W(){var l,e;try{await me(R.list((l=n.formData)==null?void 0:l.id)),(e=V.value)!=null&&e.success&&(G.value=V.value.data)}catch{}}function Te(l,e){r.debt_date=e}return ie(()=>n.formData,()=>{var l;n.formData&&((l=k.value)==null||l.clearValidate(),s.code=n.formData.code,s.name=n.formData.name,s.status_id=n.formData.status_id,v.value=n.formData.formatted_total_debt)}),re(async()=>{var l,e;try{await ue(j.formOptions()),(l=P.value)!=null&&l.success&&(C.value=P.value.data),await pe(R.formOptions()),(e=q.value)!=null&&e.success&&(D.value=q.value.data)}catch{}}),(l,e)=>{const f=Ve,w=Be,y=He,Y=Ke,z=Ie,O=oe,A=Ee,Q=ne,Oe=Le,Fe=Ue,Me=We;return p(),N("div",Ye,[m("div",ze,[m("div",Ae,[Qe,d.editMode?(p(),M(f,{key:0,color:"orange"},{default:a(()=>[_("Mode Edit")]),_:1})):(p(),M(f,{key:1,color:"cyan"},{default:a(()=>[_("Mode Input")]),_:1}))])]),m("div",Je,[t(A,{ref_key:"formRef",ref:k,model:s,rules:h,"label-col":{style:{width:"220px"}},colon:!1,"label-align":"left",onFinish:e[4]||(e[4]=o=>c(X)(k.value,De))},{default:a(()=>[m("div",Xe,[m("div",Ze,[t(y,{label:"Kode Pekerja",name:"code",ref:"code"},{default:a(()=>[t(w,{value:s.code,"onUpdate:value":e[0]||(e[0]=o=>s.code=o),valueModifiers:{trim:!0},style:{"text-transform":"uppercase"},disabled:d.editMode},null,8,["value","disabled"])]),_:1},512),t(y,{label:"Nama Pekerja",name:"name",ref:"name"},{default:a(()=>[t(w,{value:s.name,"onUpdate:value":e[1]||(e[1]=o=>s.name=o)},null,8,["value"])]),_:1},512),t(y,{label:"Status",name:"status_id",ref:"status_id"},{default:a(()=>[t(z,{value:s.status_id,"onUpdate:value":e[2]||(e[2]=o=>s.status_id=o),loading:c(ce)},{default:a(()=>{var o;return[(p(!0),N(ee,null,te((o=C.value)==null?void 0:o.statuses,F=>(p(),M(Y,{value:F.id},{default:a(()=>[_(U(F.title),1)]),_:2},1032,["value"]))),256))]}),_:1},8,["value","loading"])]),_:1},512),d.editMode?(p(),N("div",et,[t(y,{label:"Total Utang",class:"mb-0"},{default:a(()=>[t(w,{disabled:"",value:v.value},null,8,["value"])]),_:1}),t(O,{class:"mt-3 ms-md-3 mt-md-0",onClick:e[3]||(e[3]=()=>{W(),c(ge)()})},{default:a(()=>[_(" Lihat Riwayat ")]),_:1})])):ae("",!0),t(O,{type:"primary","html-type":"submit",loading:c(de)},{default:a(()=>[tt,m("span",null,U(d.editMode?"Edit":"Simpan"),1)]),_:1},8,["loading"]),t(O,{class:"mx-3",onClick:L},{default:a(()=>[_(U(d.editMode?"Batal Edit":"Bersihkan"),1)]),_:1}),d.editMode?(p(),M(O,{key:1,danger:"",type:"primary",onClick:Ne,loading:c(ye)},{default:a(()=>[_(" Hapus ")]),_:1},8,["loading"])):ae("",!0)])])]),_:1},8,["model"])]),t(Q,{visible:c(H),"onUpdate:visible":e[5]||(e[5]=o=>se(H)?H.value=o:null),title:"Riwayat Utang",width:"70vw","cancel-text":"Tutup","ok-button-props":{style:{display:"none"}}},{default:a(()=>[t(O,{type:"primary",class:"mb-3",onClick:c(ke)},{default:a(()=>[_("Input Transaksi")]),_:1},8,["onClick"]),t(le,{"row-data":G.value,"column-defs":g,loading:c(fe),"ok-button-props":{disabled:!0}},null,8,["row-data","loading"])]),_:1},8,["visible"]),t(Q,{visible:c(E),"onUpdate:visible":e[9]||(e[9]=o=>se(E)?E.value=o:null),title:"Input Transaksi Utang",onOk:e[10]||(e[10]=o=>c(X)(u.value,we)),"confirm-loading":c(ve)},{default:a(()=>[t(A,{ref_key:"formRefDebt",ref:u,model:r,rules:B,"label-col":{style:{width:"120px"}},colon:!1,"label-align":"left"},{default:a(()=>[t(y,{label:"Tgl Transaksi",name:"debt_date",ref:"debt_date"},{default:a(()=>[t(Oe,{value:r.debt_date?c(Re)(r.debt_date):void 0,onChange:Te},null,8,["value"])]),_:1},512),t(y,{label:"Tipe Transaksi",name:"type_id",ref:"type_id"},{default:a(()=>[t(z,{value:r.type_id,"onUpdate:value":e[6]||(e[6]=o=>r.type_id=o)},{default:a(()=>{var o;return[(p(!0),N(ee,null,te((o=D.value)==null?void 0:o.types,F=>(p(),M(Y,{value:F.id},{default:a(()=>[_(U(F.title),1)]),_:2},1032,["value"]))),256))]}),_:1},8,["value"])]),_:1},512),t(y,{label:"Nominal",name:"value",ref:"value"},{default:a(()=>[t(Fe,{value:r.value,"onUpdate:value":e[7]||(e[7]=o=>r.value=o),min:0,formatter:o=>`${o}`.replace(/\B(?=(\d{3})+(?!\d))/g,"."),parser:o=>o.replace(/\$\s?|(\.*)/g,"")},null,8,["value","formatter","parser"])]),_:1},512),t(y,{label:"Deskripsi",name:"description",ref:"description"},{default:a(()=>[t(Me,{value:r.description,"onUpdate:value":e[8]||(e[8]=o=>r.description=o)},null,8,["value"])]),_:1},512)]),_:1},8,["model"])]),_:1},8,["visible","confirm-loading"])])}}}),st=I({__name:"DataTable",props:{idx:null},emits:["rowClick"],setup(d,{emit:i}){const n=d,g=$({value:[{field:"code",headerName:"Kode Pekerja",pinned:"left",flex:.3},{field:"name",headerName:"Nama Pekerja",flex:.3,pinned:"left"},{field:"status_caption",headerName:"Status",width:100,flex:0},{field:"formatted_total_debt",headerName:"Total Utang",type:"numericColumn",filter:"agNumberColumnFilter",filterValueGetter:u=>parseFloat(u.data.total_debt)},{field:"created_at",headerName:"Diinput Tgl",...S},{field:"updated_at",headerName:"Diupdate Tgl",...S},{field:"created_by_user_username",headerName:"Diinput Oleh",flex:0,width:120},{field:"updated_by_user_username",headerName:"Diupdate Oleh",flex:0,width:120}]}),v=$({value:null}),{run:C,response:D,loading:k}=x();async function s(){var u;try{await C(j.list()),(u=D.value)!=null&&u.success&&(v.value=D.value.data)}catch{}}function h(u){i("rowClick",u)}return re(()=>{s()}),ie(()=>n.idx,()=>{s()}),(u,r)=>(p(),N("div",null,[t(le,{"row-data":v.value,"column-defs":g.value,loading:c(k),onRowClick:h},null,8,["row-data","column-defs","loading"])]))}}),nt=m("span",null,[m("i",{class:"fe fe-edit-2 me-2"}),_(" Input ")],-1),ot=m("span",null,[m("i",{class:"fe fe-search me-2"}),_(" Browse ")],-1),lt=m("i",{class:"fe fe-refresh-cw me-2"},null,-1),Nt=I({__name:"index",setup(d){const i=b("1"),n=b(),g=b(!1),v=b(1);function C(s){i.value="1",n.value={...s},g.value=!0}function D(){g.value=!1}function k(s){v.value+=1,s!==void 0&&(g.value=s)}return(s,h)=>{const u=Ge,r=oe,B=qe;return p(),N("div",null,[t(B,{class:"input-browse-tab",activeKey:i.value,"onUpdate:activeKey":h[1]||(h[1]=T=>i.value=T),animated:""},Pe({default:a(()=>[t(u,{key:"1"},{tab:a(()=>[nt]),default:a(()=>[t(at,{"form-data":n.value,"edit-mode":g.value,onCancelEdit:D,onOnSuccess:k},null,8,["form-data","edit-mode"])]),_:1}),t(u,{key:"2"},{tab:a(()=>[ot]),default:a(()=>[t(st,{idx:v.value,onRowClick:C},null,8,["idx"])]),_:1})]),_:2},[i.value==="2"?{name:"rightExtra",fn:a(()=>[t(r,{size:"small",class:"mt-3",onClick:h[0]||(h[0]=T=>v.value+=1)},{default:a(()=>[lt,_(" Refresh Data ")]),_:1})]),key:"0"}:void 0]),1032,["activeKey"])])}}});export{Nt as default};
