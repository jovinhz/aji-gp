var De=Object.defineProperty;var ke=(_,u,n)=>u in _?De(_,u,{enumerable:!0,configurable:!0,writable:!0,value:n}):_[u]=n;var ae=(_,u,n)=>(ke(_,typeof u!="symbol"?u+"":u,n),n);import{B as ie}from"./index-00a8ffd2.js";/* empty css              */import{u as xe}from"./modal-e4c7fed2.js";import{_ as qe}from"./index-e9d8f074.js";/* empty css              */import"./index-97222043.js";/* empty css              *//* empty css              *//* empty css              */import{_ as Ne}from"./InputDropdown.vue_vue_type_script_setup_true_lang-55961ea3.js";import{S as Ce,_ as $e}from"./index-0523e8d4.js";import{a as Te}from"./dayjs.min-2389bdff.js";import{H as Fe,u as E}from"./HttpClient-64290c27.js";import{o as A,t as Se,a as V}from"./index-f9e6a35e.js";import{_ as oe}from"./AgGrid.vue_vue_type_script_setup_true_lang-d3dbb188.js";import{_ as Me}from"./AgGridActionCell.vue_vue_type_script_setup_true_lang-cd281192.js";import{d as z,r as m,O as j,w as le,a as de,e as F,a7 as H,ac as f,f as G,g as s,a9 as T,c as l,F as Oe,ab as Re,aa as Q,u as b,X as Pe,ak as Be}from"./_plugin-vue_export-helper-50c92bea.js";import{_ as Ie}from"./index-f9be8515.js";import{I as Ee}from"./Input-97482d20.js";import{_ as je,F as He}from"./Form-2caee2e0.js";import{D as Ke}from"./dayjs-3e6b4e4c.js";import{_ as Ue}from"./TextArea-afcadf10.js";import{M as Ae}from"./Modal-5bd2bcee.js";import{T as Ve,_ as Ge}from"./TabPane-053c7c75.js";import"./DownOutlined-dca0ecad.js";import"./pickAttrs-44b65975.js";import"./useMemo-6199d1b3.js";import"./useRefs-9f478e5b.js";import"./CheckOutlined-e3d2d87e.js";import"./SearchOutlined-123fd7b0.js";import"./_flatRest-6ef3b5aa.js";import"./isSymbol-5a6ec0b4.js";import"./debounce-52dc8683.js";class S{static list(){return this.HttpClient.axiosInstance.get("/warehouse_stock_incomes")}static create(u){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"Penerimaan Gudang berhasil ditambah"}).axiosInstance.post("/warehouse_stock_incomes",u)}static show(u){return this.HttpClient.axiosInstance.get(`/warehouse_stock_incomes/${u}`)}static update(u,n){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"Penerimaan Gudang berhasil diupdate"}).axiosInstance.put(`/warehouse_stock_incomes/${u}`,n)}static formOptions(){return this.HttpClient.axiosInstance.get("/warehouse_stock_incomes/form_options")}}ae(S,"HttpClient",new Fe);const Qe={class:"card card-custom card-dense"},ze={class:"card-header"},Le={class:"card-title w-100 d-flex justify-content-between"},Xe=f("h4",{class:"card-label"},"Form Penerimaan Gudang",-1),Je={class:"card-body"},We={class:"row"},Ye={class:"col-lg-6"},Ze={class:"col-lg-12"},et={class:"col-lg-6 mt-3"},tt=f("i",{class:"fe fe-save me-2"},null,-1),at=z({__name:"Form",props:{formData:null,editMode:{type:Boolean}},emits:["cancelEdit","onSuccess"],setup(_,{emit:u}){const n=_,x=[{field:"code",headerName:"Kode Supplier"},{field:"name",headerName:"Nama Supplier"}],q=[{field:"product_code",headerName:"Kode Produk"},{field:"product_name",headerName:"Nama Produk"},{field:"qty",headerName:"Qty",filter:"agNumberColumnFilter",type:"numericColumn",valueFormatter:a=>Se(a.value)},{headerName:"Aksi",filter:!1,floatingFilter:!1,sortable:!1,resizable:!1,suppressMovable:!0,pinned:"right",width:75,flex:0,cellRenderer:Me,cellRendererParams:a=>({onDelete:()=>{c.value=c.value.filter(e=>e.id!==a.data.id),typeof a.data.id=="number"?(C.value.push({id:a.data.id,_destroy:1}),$.value=$.value.filter(e=>e.id!==a.data.id)):w.value=w.value.filter(e=>e._id!==a.data.id)}})}],M=[{field:"code",headerName:"Kode Produk"},{field:"name",headerName:"Nama Produk"}],k=m(),N=m(""),v=m(""),g=m(!1),y=m(),c=m([]),w=m([]),C=m([]),$=m([]),P=m(),r=j({}),re={supplier_id:[{required:!0,message:"Supplier wajib dipilih",trigger:"change"}],receive_date:[{required:!0,message:"Tanggal transaksi wajib diisi",trigger:"change"}],receive_type_id:[{required:!0,message:"Tipe terima wajib dipilih",trigger:"change"}],delivery_vehicle_number:[{required:!0,message:"No plat wajib diisi",trigger:"change"}]},O=m(),i=j({}),ne={product_id:[{required:!0,message:"Produk wajib dipilih",trigger:"change"}],qty:[{required:!0,message:"Qty wajib diisi",trigger:"change"}]},{run:L,loading:se,response:B}=E(),{run:ue,loading:X,response:J}=E(),{run:ce,loading:pe,response:W}=E(),{visible:K,open:Y,close:_e}=xe();async function me(){var a,e,t,p;try{n.editMode?(await L(S.update((a=n.formData)==null?void 0:a.id,{delivery_vehicle_number:r.delivery_vehicle_number,receive_date:r.receive_date,receive_type_id:r.receive_type_id,supplier_id:r.supplier_id,note:r.note,items_attributes:[...w.value,...$.value,...C.value]})),(e=B.value)!=null&&e.success&&(w.value=[],$.value=[],C.value=[],c.value=B.value.data.items.map(o=>({id:o.id,product_code:o.product.code,product_id:o.product.id,product_name:o.product.name,qty:parseInt(o.qty,10)})))):(await L(S.create({warehouse_id:1,supplier_id:r.supplier_id,delivery_vehicle_number:r.delivery_vehicle_number,note:r.note,receive_date:r.receive_date,receive_type_id:r.receive_type_id,items_attributes:c.value.map(o=>({product_id:o.product_id,qty:o.qty}))})),(t=B.value)!=null&&t.success&&Z()),(p=B.value)!=null&&p.success&&u("onSuccess")}catch{}}function Z(){var a;if(n.editMode){for(const e in r)r[e]=void 0;u("cancelEdit")}else(a=P.value)==null||a.resetFields();N.value="",c.value=[],w.value=[],C.value=[],$.value=[]}async function fe(){var a;try{await ce(S.formOptions()),(a=W.value)!=null&&a.success&&(k.value=W.value.data)}catch{}}async function ve(){var a,e;try{await ue(S.show((a=n.formData)==null?void 0:a.id)),(e=J.value)!=null&&e.success&&(c.value=J.value.data.items.map(t=>({id:t.id,product_code:t.product.code,product_id:t.product.id,product_name:t.product.name,qty:parseInt(t.qty,10)})))}catch{}}function ee(){var a,e;if(g.value){if(typeof((a=y.value)==null?void 0:a.id)=="string"){const t=w.value.find(o=>{var D;return o._id===((D=y.value)==null?void 0:D.id)}),p=c.value.find(o=>{var D;return o.id===((D=y.value)==null?void 0:D.id)});t&&(t.product_id=i.product_id,t.qty=i.qty),p&&(p.product_id=i.product_id,p.qty=i.qty,p.product_code=i.product_code,p.product_name=i.product_name,c.value=[...c.value])}else{const t=c.value.find(p=>{var o;return p.id===((o=y.value)==null?void 0:o.id)});if(t){t.product_id=i.product_id,t.product_code=i.product_code,t.product_name=i.product_name,t.qty=i.qty;const p=$.value.find(o=>o.id===t.id);p?(p.id=t.id,p.product_id=t.product_id,p.qty=t.qty):$.value.push({id:t.id,product_id:t.product_id,qty:t.qty}),c.value=[...c.value]}}_e()}else{const t={id:`new-${c.value.length+1}`,qty:i.qty,product_id:i.product_id,product_code:i.product_code,product_name:i.product_name};c.value=[...c.value,t],w.value.push({_id:t.id,product_id:i.product_id,qty:i.qty}),(e=O.value)==null||e.resetFields(),v.value=""}}function ye(a){var e;g.value=!0,y.value=a,i.product_id=a.product_id,i.product_code=a.product_code,i.product_name=a.product_name,i.qty=a.qty,v.value=`${a.product_code} - ${a.product_name}`,(e=O.value)==null||e.clearValidate(),Y()}return le(()=>n.formData,()=>{var a,e,t,p,o,D,I,R;n.formData&&((a=P.value)==null||a.clearValidate(),c.value=[],w.value=[],C.value=[],$.value=[],r.supplier_id=(e=n.formData)==null?void 0:e.supplier.id,r.delivery_vehicle_number=(t=n.formData)==null?void 0:t.delivery_vehicle_number,r.note=(p=n.formData)==null?void 0:p.note,r.receive_date=(o=n.formData)==null?void 0:o.receive_date,r.receive_type_id=(D=n.formData)==null?void 0:D.receive_type_id,N.value=`${(I=n.formData)==null?void 0:I.supplier.code} - ${(R=n.formData)==null?void 0:R.supplier.name}`,setTimeout(()=>{ve()},0))}),de(()=>{fe()}),(a,e)=>{const t=Ie,p=Ee,o=je,D=Ce,I=$e,R=Ne,he=Ke,ge=Ue,U=ie,te=He,be=qe,we=Ae;return F(),H("div",Qe,[f("div",ze,[f("div",Le,[Xe,_.editMode?(F(),G(t,{key:0,color:"orange"},{default:s(()=>[T("Mode Edit")]),_:1})):(F(),G(t,{key:1,color:"cyan"},{default:s(()=>[T("Mode Input")]),_:1}))])]),f("div",Je,[l(te,{ref_key:"formRef",ref:P,model:r,rules:re,"label-col":{style:{width:"220px"}},colon:!1,"label-align":"left",onFinish:e[6]||(e[6]=d=>b(A)(P.value,me))},{default:s(()=>[f("div",We,[f("div",Ye,[l(o,{label:"No. Tran"},{default:s(()=>{var d;return[l(p,{value:_.editMode?(d=_.formData)==null?void 0:d.transaction_number:"",disabled:""},null,8,["value"])]}),_:1}),l(o,{label:"Tipe Terima",name:"receive_type_id",ref:"receive_type_id"},{default:s(()=>[l(I,{value:r.receive_type_id,"onUpdate:value":e[0]||(e[0]=d=>r.receive_type_id=d)},{default:s(()=>{var d;return[(F(!0),H(Oe,null,Re((d=k.value)==null?void 0:d.receive_types,h=>(F(),G(D,{value:h.id},{default:s(()=>[T(Q(h.title),1)]),_:2},1032,["value"]))),256))]}),_:1},8,["value"])]),_:1},512),l(o,{label:"Supplier",name:"supplier_id",ref:"supplier_id"},{default:s(()=>{var d;return[l(R,{"column-defs":x,"grid-data":((d=k.value)==null?void 0:d.suppliers)??[],loading:b(pe),value:void 0,"value-display":N.value,onChange:e[1]||(e[1]=h=>{r.supplier_id=h.id,N.value=`${h.code} - ${h.name}`})},null,8,["grid-data","loading","value-display"])]}),_:1},512),l(o,{label:"Tgl Transaksi",name:"receive_date",ref:"receive_date"},{default:s(()=>[l(he,{value:r.receive_date?b(Te)(r.receive_date):void 0,onChange:e[2]||(e[2]=(d,h)=>r.receive_date=h)},null,8,["value"])]),_:1},512),l(o,{label:"No Plat",ref:"delivery_vehicle_number",name:"delivery_vehicle_number"},{default:s(()=>[l(p,{value:r.delivery_vehicle_number,"onUpdate:value":e[3]||(e[3]=d=>r.delivery_vehicle_number=d),style:{"text-transform":"uppercase"}},null,8,["value"])]),_:1},512),l(o,{label:"Catatan",ref:"note",name:"note"},{default:s(()=>[l(ge,{value:r.note,"onUpdate:value":e[4]||(e[4]=d=>r.note=d)},null,8,["value"])]),_:1},512)]),f("div",Ze,[l(U,{class:"mb-3",type:"primary",onClick:e[5]||(e[5]=()=>{g.value=!1,i.product_code=void 0,i.product_id=void 0,i.product_name=void 0,i.qty=void 0,v.value="",b(Y)()})},{default:s(()=>[T(" Tambah ")]),_:1}),l(oe,{style:{height:"300px"},"row-data":c.value,"column-defs":q,loading:b(X),onRowClick:ye},null,8,["row-data","column-defs","loading"])]),f("div",et,[l(U,{type:"primary","html-type":"submit",loading:b(se)},{default:s(()=>[tt,f("span",null,Q(_.editMode?"Edit":"Simpan"),1)]),_:1},8,["loading"]),l(U,{class:"mx-3",onClick:Z},{default:s(()=>[T(Q(_.editMode?"Batal Edit":"Bersihkan"),1)]),_:1})])])]),_:1},8,["model"])]),l(we,{visible:b(K),"onUpdate:visible":e[10]||(e[10]=d=>Pe(K)?K.value=d:null),title:g.value?"Update Detail":"Tambah Detail","cancel-text":"Tutup",onOk:e[11]||(e[11]=d=>b(A)(O.value,ee))},{default:s(()=>[l(te,{ref_key:"formRefAddDet",ref:O,model:i,rules:ne,"label-col":{style:{width:"80px"}},colon:!1,"label-align":"left",onFinish:e[9]||(e[9]=d=>b(A)(O.value,ee))},{default:s(()=>[l(o,{label:"Produk",name:"product_id",ref:"product_id"},{default:s(()=>{var d;return[l(R,{"column-defs":M,"grid-data":((d=k.value)==null?void 0:d.products)??[],loading:b(X),value:void 0,"value-display":v.value,onChange:e[7]||(e[7]=h=>{i.product_id=h.id,i.product_code=h.code,i.product_name=h.name,v.value=`${h.code} - ${h.name}`})},null,8,["grid-data","loading","value-display"])]}),_:1},512),l(o,{label:"Qty",name:"qty",ref:"qty"},{default:s(()=>[l(be,{value:i.qty,"onUpdate:value":e[8]||(e[8]=d=>i.qty=d),min:0,formatter:d=>`${d}`.replace(/\B(?=(\d{3})+(?!\d))/g,"."),parser:d=>d.replace(/\$\s?|(\.*)/g,"")},null,8,["value","formatter","parser"])]),_:1},512)]),_:1},8,["model"])]),_:1},8,["visible","title"])])}}}),it=z({__name:"DataTable",props:{idx:null},emits:["rowClick"],setup(_,{emit:u}){const n=_,x=j({value:[{field:"transaction_number",headerName:"No. Tran",pinned:"left",flex:0,width:130},{field:"receive_type_caption",headerName:"Tipe Terima",flex:0,width:170},{field:"receive_date",headerName:"Tgl Tran",...V},{field:"supplier.code",headerName:"Kode Supplier",flex:0,width:150},{field:"supplier.name",headerName:"Nama Supplier",flex:0,width:150},{field:"delivery_vehicle_number",headerName:"No Plat",flex:0,width:150},{field:"note",headerName:"Catatan",flex:0,width:150},{field:"created_at",headerName:"Diinput Tgl",...V},{field:"updated_at",headerName:"Diupdate Tgl",...V},{field:"created_by_user_username",headerName:"Diinput Oleh",flex:0,width:120},{field:"updated_by_user_username",headerName:"Diupdate Oleh",flex:0,width:120}]}),q=j({value:null}),{run:M,response:k,loading:N}=E();async function v(){var y;try{await M(S.list()),(y=k.value)!=null&&y.success&&(q.value=k.value.data)}catch{}}function g(y){u("rowClick",y)}return de(()=>{v()}),le(()=>n.idx,()=>{v()}),(y,c)=>(F(),H("div",null,[l(oe,{"row-data":q.value,"column-defs":x.value,loading:b(N),onRowClick:g},null,8,["row-data","column-defs","loading"])]))}}),ot=f("span",null,[f("i",{class:"fe fe-edit-2 me-2"}),T(" Input ")],-1),lt=f("span",null,[f("i",{class:"fe fe-search me-2"}),T(" Browse ")],-1),dt=f("i",{class:"fe fe-refresh-cw me-2"},null,-1),Kt=z({__name:"index",setup(_){const u=m("1"),n=m(),x=m(!1),q=m(1);function M(v){u.value="1",n.value={...v},x.value=!0}function k(){x.value=!1}function N(v){q.value+=1,v!==void 0&&(x.value=v)}return(v,g)=>{const y=Ge,c=ie,w=Ve;return F(),H("div",null,[l(w,{class:"input-browse-tab",activeKey:u.value,"onUpdate:activeKey":g[1]||(g[1]=C=>u.value=C),animated:""},Be({default:s(()=>[l(y,{key:"1"},{tab:s(()=>[ot]),default:s(()=>[l(at,{"form-data":n.value,"edit-mode":x.value,onCancelEdit:k,onOnSuccess:N},null,8,["form-data","edit-mode"])]),_:1}),l(y,{key:"2"},{tab:s(()=>[lt]),default:s(()=>[l(it,{idx:q.value,onRowClick:M},null,8,["idx"])]),_:1})]),_:2},[u.value==="2"?{name:"rightExtra",fn:s(()=>[l(c,{size:"small",class:"mt-3",onClick:g[0]||(g[0]=C=>q.value+=1)},{default:s(()=>[dt,T(" Refresh Data ")]),_:1})]),key:"0"}:void 0]),1032,["activeKey"])])}}});export{Kt as default};
