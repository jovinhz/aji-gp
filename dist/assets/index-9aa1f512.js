var je=Object.defineProperty;var Ie=(_,s,l)=>s in _?je(_,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):_[s]=l;var ce=(_,s,l)=>(Ie(_,typeof s!="symbol"?s+"":s,l),l);import{B as he}from"./index-153eefc2.js";import{_ as ge}from"./AgGrid.vuevuetypescriptsetuptruelang-ab13ecb9.js";import{_ as Ee}from"./UploadImage-10f49cd8.js";import{u as me}from"./modal-e8545dd0.js";import{r as M,o as H,t as Ge,a as z}from"./index-8f77c718.js";import"./index-516ff1a6.js";import{_ as Ke}from"./index-1776abb9.js";/* empty css              *//* empty css              */import{a as pe,I as Ve,_ as Qe,F as ze}from"./Input-bda0940e.js";import{H as Je,u as O}from"./HttpClient-7fc79ba3.js";import{_ as ee}from"./InputDropdown.vuevuetypescriptsetuptruelang-59e1ec1d.js";import{_ as Le}from"./AgGridActionCell.vuevuetypescriptsetuptruelang-e542f767.js";import{P as Xe}from"./ProductService-e484d2cd.js";import{d as ae,r as m,O as j,w as be,a as ye,e as F,a7 as T,ac as p,f as _e,g as r,a9 as x,c as t,u as d,ae as We,aa as fe,X as ve,ak as Ye}from"./plugin-vueexport-helper-0ef99882.js";import{_ as Ze}from"./index-0437c30a.js";import{D as ea}from"./dayjs-ec520615.js";import{a as aa}from"./index-7cd2b3cb.js";import{M as ta}from"./Modal-79dc3d32.js";import{T as la,_ as oa}from"./TabPane-9c8435b0.js";import"./DownOutlined-80526c88.js";import"./useMemo-49158cc8.js";import"./EyeOutlined-308ec9ea.js";import"./pickAttrs-596f35c3.js";import"./CheckOutlined-94b1a800.js";import"./index-17b77924.js";class ${static list(){return this.HttpClient.axiosInstance.get("/purchase_invoices")}static show(s){return this.HttpClient.axiosInstance.get(`/purchase_invoices/${s}`)}static create(s){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"Faktur Beli berhasil ditambah"}).axiosInstance.post("/purchase_invoices",s)}static update(s,l){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"Faktur Beli berhasil diupdate"}).axiosInstance.put(`/purchase_invoices/${s}`,l)}static upload(s,l){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"File Faktur Beli berhasil diupload"}).axiosInstance.put(`/purchase_invoices/${s}/upload`,l)}static formOptions(){return this.HttpClient.axiosInstance.get("/purchase_invoices/form_options")}}ce($,"HttpClient",new Je);const ra={class:"card card-custom card-dense"},ia={class:"card-header"},na={class:"card-title w-100 d-flex justify-content-between"},sa=p("h4",{class:"card-label"},"Form Faktur Beli",-1),ua={class:"card-body"},da={class:"row"},ca={class:"col-lg-6"},ma={key:0,class:"col-lg-6 text-center"},pa=p("p",null,"Gambar Faktur",-1),_a={key:0},fa={key:1},va=p("p",{class:"text-muted"},"Belum ada gambar",-1),ha=[va],ga={class:"col-lg-12"},ba={class:"col-lg-6 mt-3"},ya=p("i",{class:"fe fe-save me-2"},null,-1),ka=p("span",null,"Rp",-1),wa=ae({__name:"Form",props:{formData:null,editMode:{type:Boolean}},emits:["cancelEdit","onSuccess"],setup(_,{emit:s}){const l=_,w=[{headerName:"Kode Supplier",field:"code"},{headerName:"Nama Supplier",field:"name"}],D=[{headerName:"No PO",field:"purchase_order_number"}],R=[{field:"code",headerName:"Kode Produk"},{field:"name",headerName:"Nama Produk"},{field:"category_caption",headerName:"Kategori"},{field:"unit.name",headerName:"Satuan"}],P=[{field:"product.code",headerName:"Kode Produk"},{field:"product.name",headerName:"Nama Produk"},{field:"qty",headerName:"Qty",filter:"agNumberColumnFilter",type:"numericColumn",valueFormatter:a=>Ge(a.value)},{field:"price",headerName:"Harga",filter:"agNumberColumnFilter",type:"numericColumn",valueFormatter:a=>M(a.value)},{headerName:"Subtotal",filter:"agNumberColumnFilter",type:"numericColumn",valueGetter:a=>a.data.qty*a.data.price,valueFormatter:a=>M(a.value)},{headerName:"Aksi",filter:!1,floatingFilter:!1,sortable:!1,resizable:!1,suppressMovable:!0,pinned:"right",width:75,flex:0,cellRenderer:Le,cellRendererParams:a=>({onDelete:()=>{g.value=g.value.filter(e=>e.id!==a.data.id),typeof a.data.id=="number"?A.value.push({id:a.data.id,_destroy:1}):N.value=N.value.filter(e=>e._id!==a.data.id)}})}],q=m([]),v=m(""),h=m(""),n=m(""),k=m(""),C=m(""),S=m(""),J=m(),I=m(),o=j({items_attributes:[]}),ke={supplier_id:[{required:!0,message:"Supplier wajib dipilih",trigger:"change"}],purchase_order_id:[{required:!0,message:"PO wajib dipilih",trigger:"change"}],invoice_date:[{required:!0,message:"Tgl faktur wajib diisi",trigger:"change"}],due_date:[{required:!0,message:"Tgl jto faktur wajib diisi",trigger:"change"}],tax_percent:[{required:!0,message:"PPn faktur wajib diisi",trigger:"change"}]},E=m(),f=j({}),we={product_id:[{required:!0,message:"Produk wajib dipilih",trigger:"change"}],qty:[{required:!0,message:"Qty wajib diisi",trigger:"change"}],price:[{required:!0,message:"Harga wajib diisi",trigger:"change"}]},G=m(),B=j({}),De={},g=m([]),N=m([]),A=m([]),{run:te,loading:Fe,response:U}=O(),{run:xe,loading:Ce,response:L}=O(),{run:Ne,loading:le,response:oe}=O(),{run:$e,loading:Pe,response:re}=O(),{run:qe,loading:Se,response:X}=O(),{visible:W,open:Oe,close:Na}=me(),{visible:Y,open:Te,close:Me}=me();async function Re(){var a,e,c,K;try{l.editMode?(await te($.update((a=l.formData)==null?void 0:a.id,{invoice_number:o.invoice_number,due_date:o.due_date,invoice_date:o.invoice_date,purchase_order_id:o.purchase_order_id,supplier_id:o.supplier_id,tax_percent:o.tax_percent,items_attributes:[...N.value,...A.value]})),(e=U.value)!=null&&e.success&&(k.value=U.value.data.total_price,N.value=[],A.value=[],g.value=U.value.data.items.map(u=>({id:u.id,price:parseFloat(u.price),qty:parseFloat(u.qty),product:u.product})))):(await te($.create({invoice_number:o.invoice_number,due_date:o.due_date,invoice_date:o.invoice_date,purchase_order_id:o.purchase_order_id,supplier_id:o.supplier_id,tax_percent:o.tax_percent,items_attributes:g.value.map(u=>({product_id:u.product.id,qty:u.qty,price:u.price}))})),(c=U.value)!=null&&c.success&&ie()),(K=U.value)!=null&&K.success&&s("onSuccess")}catch{}}function ie(){var a;if(l.editMode){for(const e in o)o[e]=void 0;s("cancelEdit")}else(a=I.value)==null||a.resetFields();g.value=[],N.value=[],A.value=[],v.value="",h.value="",k.value=""}function ne(){var e;const a={id:`new-${g.value.length+1}`,qty:f.qty,price:f.price,product:{code:f.product_code,name:f.product_name,id:f.product_id}};g.value=[...g.value,a],N.value.push({_id:a.id,product_id:f.product_id,qty:f.qty,price:f.price}),(e=E.value)==null||e.resetFields(),n.value=""}async function Be(){var a,e;try{await xe($.show((a=l.formData)==null?void 0:a.id)),(e=L.value)!=null&&e.success&&(g.value=L.value.data.items.map(c=>({id:c.id,price:parseFloat(c.price),qty:parseFloat(c.qty),product:c.product})),C.value=L.value.data.attachment_url)}catch{}}function Ae(a,e){var c;C.value=a,B.attachment=e,(c=G.value)==null||c.validateFields("attachment")}async function se(){var a,e;if(B.attachment)try{const c=new FormData;c.set("attachment",B.attachment),await qe($.upload((a=l.formData)==null?void 0:a.id,c)),(e=X.value)!=null&&e.success&&(Me(),B.attachment=null,C.value=X.value.data.attachment_url,S.value=X.value.data.attachment_url)}catch{}}return be(()=>l.formData,()=>{var a;l.formData&&((a=I.value)==null||a.clearValidate(),g.value=[],N.value=[],A.value=[],o.invoice_number=l.formData.invoice_number,o.due_date=l.formData.due_date,o.invoice_date=l.formData.invoice_date,o.purchase_order_id=l.formData.purchase_order.id,o.supplier_id=l.formData.supplier.id,o.tax_percent=parseFloat(l.formData.tax_percent),v.value=`${l.formData.supplier.code} - ${l.formData.supplier.name}`,h.value=l.formData.purchase_order.purchase_order_number??"",k.value=l.formData.total_price,S.value=l.formData.attachment_url,setTimeout(()=>{Be()},0))}),ye(async()=>{try{(async()=>{var a;await Ne($.formOptions()),(a=oe.value)!=null&&a.success&&(J.value=oe.value.data)})(),(async()=>{var a;await $e(Xe.list()),(a=re.value)!=null&&a.success&&(q.value=re.value.data)})()}catch{}}),(a,e)=>{const c=Ze,K=Ve,u=Qe,ue=ea,V=Ke,Ue=aa,Q=he,Z=ze,de=ta,He=Ee;return F(),T("div",ra,[p("div",ia,[p("div",na,[sa,_.editMode?(F(),_e(c,{key:0,color:"orange"},{default:r(()=>[x("Mode Edit")]),_:1})):(F(),_e(c,{key:1,color:"cyan"},{default:r(()=>[x("Mode Input")]),_:1}))])]),p("div",ua,[t(Z,{ref_key:"formRef",ref:I,model:o,rules:ke,"label-col":{style:{width:"220px"}},colon:!1,"label-align":"left",onFinish:e[7]||(e[7]=i=>d(H)(I.value,Re))},{default:r(()=>{var i;return[p("div",da,[p("div",ca,[t(u,{label:"No Faktur"},{default:r(()=>[t(K,{value:o.invoice_number,"onUpdate:value":e[0]||(e[0]=b=>o.invoice_number=b)},null,8,["value"])]),_:1}),t(u,{label:"Supplier",name:"supplier_id",ref:"supplier_id"},{default:r(()=>{var b;return[t(ee,{"column-defs":w,"grid-data":((b=J.value)==null?void 0:b.suppliers)??[],loading:d(le),value:void 0,"value-display":v.value,onChange:e[1]||(e[1]=y=>{o.supplier_id=y.id,v.value=`${y.code} - ${y.name}`})},null,8,["grid-data","loading","value-display"])]}),_:1},512),t(u,{label:"No PO",name:"purchase_order_id",ref:"purchase_order_id"},{default:r(()=>{var b;return[t(ee,{"column-defs":D,"grid-data":((b=J.value)==null?void 0:b.purchase_order_id)??[],loading:d(le),value:void 0,"value-display":h.value,onChange:e[2]||(e[2]=y=>{o.purchase_order_id=y.id,h.value=`${y.purchase_order_number}`})},null,8,["grid-data","loading","value-display"])]}),_:1},512),t(u,{label:"Tgl Faktur",name:"invoice_date",ref:"invoice_date"},{default:r(()=>[t(ue,{value:o.invoice_date?d(pe)(o.invoice_date):void 0,onChange:e[3]||(e[3]=(b,y)=>o.invoice_date=y)},null,8,["value"])]),_:1},512),t(u,{label:"Tgl JTO Faktur",name:"due_date",ref:"due_date"},{default:r(()=>[t(ue,{value:o.due_date?d(pe)(o.due_date):void 0,onChange:e[4]||(e[4]=(b,y)=>o.due_date=y)},null,8,["value"])]),_:1},512),t(u,{label:"PPn %",name:"tax_percent",ref:"tax_percent"},{default:r(()=>[t(V,{value:o.tax_percent,"onUpdate:value":e[5]||(e[5]=b=>o.tax_percent=b),min:0},null,8,["value"])]),_:1},512),t(u,{label:"Total Faktur"},{default:r(()=>[t(V,{value:k.value?d(M)(k.value):"",disabled:""},null,8,["value"])]),_:1})]),_.editMode?(F(),T("div",ma,[pa,(i=_.formData)!=null&&i.attachment_url?(F(),T("div",_a,[t(Ue,{src:C.value,width:200},null,8,["src"])])):(F(),T("div",fa,ha)),t(Q,{class:"mt-3",type:"primary","html-type":"button",onClick:d(Te)},{default:r(()=>[x(" Upload ")]),_:1},8,["onClick"])])):We("",!0),p("div",ga,[t(Q,{class:"mb-3",type:"primary",onClick:d(Oe)},{default:r(()=>[x(" Tambah ")]),_:1},8,["onClick"]),t(ge,{style:{height:"300px"},"row-data":g.value,"column-defs":P,loading:d(Ce),onRowClick:e[6]||(e[6]=()=>{})},null,8,["row-data","column-defs","loading"])]),p("div",ba,[t(Q,{type:"primary","html-type":"submit",loading:d(Fe)},{default:r(()=>[ya,p("span",null,fe(_.editMode?"Edit":"Simpan"),1)]),_:1},8,["loading"]),t(Q,{class:"mx-3",onClick:ie},{default:r(()=>[x(fe(_.editMode?"Batal Edit":"Bersihkan"),1)]),_:1})])])]}),_:1},8,["model"])]),t(de,{visible:d(W),"onUpdate:visible":e[12]||(e[12]=i=>ve(W)?W.value=i:null),title:"Tambah Detail","cancel-text":"Tutup",onOk:e[13]||(e[13]=i=>d(H)(E.value,ne))},{default:r(()=>[t(Z,{ref_key:"formRefAddDet",ref:E,model:f,rules:we,"label-col":{style:{width:"110px"}},colon:!1,"label-align":"left",onFinish:e[11]||(e[11]=i=>d(H)(E.value,ne))},{default:r(()=>[t(u,{label:"Produk",name:"product_id",ref:"product_id"},{default:r(()=>[t(ee,{"column-defs":R,"grid-data":q.value??[],loading:d(Pe),value:void 0,"value-display":n.value,onChange:e[8]||(e[8]=i=>{f.product_id=i.id,f.product_code=i.code,f.product_name=i.name,n.value=`${i.code} - ${i.name}`})},null,8,["grid-data","loading","value-display"])]),_:1},512),t(u,{label:"Qty",name:"qty",ref:"qty"},{default:r(()=>[t(V,{value:f.qty,"onUpdate:value":e[9]||(e[9]=i=>f.qty=i),min:0,formatter:i=>`${i}`.replace(/\B(?=(\d{3})+(?!\d))/g,"."),parser:i=>i.replace(/\$\s?|(\.*)/g,"")},null,8,["value","formatter","parser"])]),_:1},512),t(u,{label:"Harga",name:"price",ref:"price"},{default:r(()=>[t(V,{value:f.price,"onUpdate:value":e[10]||(e[10]=i=>f.price=i),min:0,formatter:i=>`${i}`.replace(/\B(?=(\d{3})+(?!\d))/g,"."),parser:i=>i.replace(/\$\s?|(\.*)/g,"")},{addonBefore:r(()=>[ka]),_:1},8,["value","formatter","parser"])]),_:1},512)]),_:1},8,["model"])]),_:1},8,["visible"]),t(de,{visible:d(Y),"onUpdate:visible":e[15]||(e[15]=i=>ve(Y)?Y.value=i:null),title:"Upload Gambar","cancel-text":"Tutup",onOk:e[16]||(e[16]=i=>d(H)(G.value,se)),onConfirmLoading:d(Se)},{default:r(()=>[t(Z,{ref_key:"formRefAttachment",ref:G,model:B,rules:De,"label-col":{style:{width:"110px"}},colon:!1,"label-align":"left",layout:"vertical",onFinish:e[14]||(e[14]=i=>d(H)(G.value,se))},{default:r(()=>[t(u,{label:"Attachment",ref_key:"attachment",ref:S,name:"attachment"},{default:r(()=>[t(He,{"img-url":C.value,onChange:Ae},null,8,["img-url"])]),_:1},512)]),_:1},8,["model"])]),_:1},8,["visible","onConfirmLoading"])])}}}),Da=ae({__name:"DataTable",props:{idx:null},emits:["rowClick"],setup(_,{emit:s}){const l=_,w=j({value:[{field:"invoice_number",headerName:"No. Faktur",width:120,flex:0,pinned:"left"},{field:"purchase_order.purchase_order_number",headerName:"No. PO",width:120,flex:0,pinned:"left"},{field:"supplier.name",headerName:"Supplier",width:120,flex:0},{field:"invoice_date",headerName:"Tgl Faktur",...z},{field:"due_date",headerName:"Tgl Jto",...z},{field:"subtotal",headerName:"Subtotal",filter:"agNumberColumnFilter",type:"numericColumn",width:100,flex:0,valueGetter:n=>parseFloat(n.data.subtotal),valueFormatter:n=>M(n.value)},{field:"tax_percent",headerName:"PPn %",filter:"agNumberColumnFilter",type:"numericColumn",width:80,flex:0,valueGetter:n=>parseFloat(n.data.tax_percent)},{field:"tax_nominal",headerName:"PPn Nilai",filter:"agNumberColumnFilter",type:"numericColumn",width:100,flex:0,valueGetter:n=>parseFloat(n.data.tax_nominal),valueFormatter:n=>M(n.value)},{field:"total_price",headerName:"Grand Total",filter:"agNumberColumnFilter",type:"numericColumn",width:120,flex:0,valueGetter:n=>parseFloat(n.data.total_price),valueFormatter:n=>M(n.value)},{field:"created_at",headerName:"Diinput Tgl",...z},{field:"updated_at",headerName:"Diupdate Tgl",...z},{field:"created_by_user_username",headerName:"Diinput Oleh",flex:0,width:120},{field:"updated_by_user_username",headerName:"Diupdate Oleh",flex:0,width:120}]}),D=j({value:null}),{run:R,response:P,loading:q}=O();async function v(){var n;try{await R($.list()),(n=P.value)!=null&&n.success&&(D.value=P.value.data)}catch{}}function h(n){s("rowClick",n)}return ye(()=>{v()}),be(()=>l.idx,()=>{v()}),(n,k)=>(F(),T("div",null,[t(ge,{"row-data":D.value,"column-defs":w.value,loading:d(q),onRowClick:h},null,8,["row-data","column-defs","loading"])]))}}),Fa=p("span",null,[p("i",{class:"fe fe-edit-2 me-2"}),x(" Input ")],-1),xa=p("span",null,[p("i",{class:"fe fe-search me-2"}),x(" Browse ")],-1),Ca=p("i",{class:"fe fe-refresh-cw me-2"},null,-1),at=ae({__name:"index",setup(_){const s=m("1"),l=m(),w=m(!1),D=m(1);function R(v){s.value="1",l.value={...v},w.value=!0}function P(){w.value=!1}function q(v){D.value+=1,v!==void 0&&(w.value=v)}return(v,h)=>{const n=oa,k=he,C=la;return F(),T("div",null,[t(C,{class:"input-browse-tab",activeKey:s.value,"onUpdate:activeKey":h[1]||(h[1]=S=>s.value=S),animated:""},Ye({default:r(()=>[t(n,{key:"1"},{tab:r(()=>[Fa]),default:r(()=>[t(wa,{"form-data":l.value,"edit-mode":w.value,onCancelEdit:P,onOnSuccess:q},null,8,["form-data","edit-mode"])]),_:1}),t(n,{key:"2"},{tab:r(()=>[xa]),default:r(()=>[t(Da,{idx:D.value,onRowClick:R},null,8,["idx"])]),_:1})]),_:2},[s.value==="2"?{name:"rightExtra",fn:r(()=>[t(k,{size:"small",class:"mt-3",onClick:h[0]||(h[0]=S=>D.value+=1)},{default:r(()=>[Ca,x(" Refresh Data ")]),_:1})]),key:"0"}:void 0]),1032,["activeKey"])])}}});export{at as default};
