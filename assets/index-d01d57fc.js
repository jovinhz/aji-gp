var De=Object.defineProperty;var qe=(_,r,u)=>r in _?De(_,r,{enumerable:!0,configurable:!0,writable:!0,value:u}):_[r]=u;var oe=(_,r,u)=>(qe(_,typeof r!="symbol"?r+"":r,u),u);import{B as le}from"./index-90b0ce28.js";/* empty css              */import{u as Ce}from"./modal-5831ef41.js";import{_ as Ne}from"./index-316a232c.js";import{_ as xe}from"./InputDropdown.vuevuetypescriptsetuptruelang-42ddf6af.js";/* empty css              */import"./index-f73f074f.js";/* empty css              *//* empty css              *//* empty css              */import{a as $e}from"./dayjs.min-527378d9.js";import{H as Fe,u as I}from"./HttpClient-1b2eaec7.js";import{o as A,t as ae,a as V}from"./index-b46cc542.js";import{_ as de}from"./AgGrid.vuevuetypescriptsetuptruelang-ab623fe9.js";import{_ as Pe}from"./AgGridActionCell.vuevuetypescriptsetuptruelang-5d8fda9d.js";import{_ as Te,a as Me}from"./index-816263a7.js";import{d as G,r as p,O as E,w as re,a as se,e as P,a7 as Q,ac as m,f as B,g as n,a9 as q,c as l,u as b,aa as ie,X as Re,ak as Oe}from"./plugin-vueexport-helper-50c92bea.js";import{_ as Se}from"./index-adc802a8.js";import{I as je}from"./Input-0690b7a8.js";import{_ as Be,F as Ie}from"./Form-bf91ef97.js";import{D as Ee}from"./dayjs-c4d578da.js";import{_ as He}from"./TextArea-dc2b2442.js";import{M as Ke}from"./Modal-7e7fe8a9.js";import{T as Ue,_ as Ae}from"./TabPane-e550f0d2.js";import"./DownOutlined-038c92c2.js";import"./_flatRest-fbf250a7.js";import"./isSymbol-86c3dd79.js";import"./debounce-11220fe5.js";import"./useRefs-c0f8034e.js";import"./useMemo-b955d761.js";import"./pickAttrs-efa5632c.js";class T{static list(){return this.HttpClient.axiosInstance.get("/warehouse_stock_releases")}static create(r){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"Pengeluaran Gudang berhasil ditambah"}).axiosInstance.post("/warehouse_stock_releases",r)}static show(r){return this.HttpClient.axiosInstance.get(`/warehouse_stock_releases/${r}`)}static update(r,u){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"Pengeluaran Gudang berhasil diupdate"}).axiosInstance.put(`/warehouse_stock_releases/${r}`,u)}static formOptions(r){return this.HttpClient.axiosInstance.get("/warehouse_stock_releases/form_options",{params:{worklist_id:r}})}}oe(T,"HttpClient",new Fe);const Ve={class:"card card-custom card-dense"},Ge={class:"card-header"},Qe={class:"card-title w-100 d-flex justify-content-between"},We=m("h4",{class:"card-label"},"Form Pengeluaran Gudang",-1),ze={class:"card-body"},Xe={class:"row"},Je={class:"col-lg-6"},Le={class:"col-lg-12"},Ye={class:"col-lg-6 mt-3"},Ze=m("i",{class:"fe fe-save me-2"},null,-1),et=G({__name:"Form",props:{formData:null,editMode:{type:Boolean}},emits:["cancelEdit","onSuccess"],setup(_,{emit:r}){const u=_,C=[{field:"product_code",headerName:"Kode Produk"},{field:"product_name",headerName:"Nama Produk"},{field:"qty",headerName:"Qty",filter:"agNumberColumnFilter",type:"numericColumn",valueFormatter:a=>ae(a.value)},{field:"note",headerName:"Catatan"},{field:"worklist",headerName:"Projek"},{headerName:"Aksi",filter:!1,floatingFilter:!1,sortable:!1,resizable:!1,suppressMovable:!0,pinned:"right",width:75,flex:0,cellRenderer:Pe,cellRendererParams:a=>({onDelete:()=>{c.value=c.value.filter(t=>t.id!==a.data.id),typeof a.data.id=="number"?(F.value.push({id:a.data.id,_destroy:1}),$.value=$.value.filter(t=>t.id!==a.data.id)):D.value=D.value.filter(t=>t._id!==a.data.id)}})}],N=[{field:"code",headerName:"Kode Produk"},{field:"name",headerName:"Nama Produk"}],M=[{field:"product.code",headerName:"Kode Produk"},{field:"product.name",headerName:"Nama Produk"},{field:"worklist.worklist_number",headerName:"No Projek"},{field:"worklist.title",headerName:"Nama Projek"},{field:"qty_request",headerName:"Qty Req",filter:"agNumberColumnFilter",type:"numericColumn",valueFormatter:a=>ae(a.value)}],x=p(),y=p(""),w=p(!1),h=p(),f=p("1"),c=p([]),D=p([]),F=p([]),$=p([]),S=p(),v=E({}),ne={issue_date:[{required:!0,message:"Tanggal transaksi wajib diisi",trigger:"change"}]},R=p(),e=E({}),ue={product_id:[{required:!0,message:"Produk wajib dipilih",trigger:"change"}],qty:[{required:!0,message:"Qty wajib diisi",trigger:"change"}],worklist_product_id:[{required:!0,message:"Produk wajib dipilih",trigger:"change"}]},{run:W,loading:ce,response:j}=I(),{run:_e,loading:H,response:z}=I(),{run:pe,loading:lt,response:X}=I(),{visible:K,open:J,close:me}=Ce();async function fe(){var a,t,o,s;try{u.editMode?(await W(T.update((a=u.formData)==null?void 0:a.id,{warehouse_id:1,issue_date:v.issue_date,note:v.note,items_attributes:[...D.value,...$.value,...F.value]})),(t=j.value)!=null&&t.success&&(D.value=[],$.value=[],F.value=[],c.value=j.value.data.items.map(i=>{var g,O;return{id:i.id,product_code:i.product.code,product_id:i.product.id,product_name:i.product.name,note:i.note,qty:parseInt(i.qty,10),worklist:(g=i.worklist_product)==null?void 0:g.worklist.worklist_number,worklist_product_id:(O=i.worklist_product)==null?void 0:O.id}}))):(await W(T.create({warehouse_id:1,issue_date:v.issue_date,note:v.note,items_attributes:c.value.map(i=>i.worklist_product_id?{worklist_product_id:i.worklist_product_id,qty:i.qty,note:i.note}:{product_id:i.product_id,qty:i.qty,note:i.note})})),(o=j.value)!=null&&o.success&&L()),(s=j.value)!=null&&s.success&&r("onSuccess")}catch{}}function L(){var a;if(u.editMode){for(const t in v)v[t]=void 0;r("cancelEdit")}else(a=S.value)==null||a.resetFields();c.value=[],D.value=[],F.value=[],$.value=[]}async function ve(){var a;try{await pe(T.formOptions()),(a=X.value)!=null&&a.success&&(x.value=X.value.data)}catch{}}async function ke(){var a,t;try{await _e(T.show((a=u.formData)==null?void 0:a.id)),(t=z.value)!=null&&t.success&&(c.value=z.value.data.items.map(o=>{var s,i,g;return{id:o.id,product_code:o.product.code,product_id:o.product.id,product_name:o.product.name,qty:parseInt(o.qty,10),note:o.note,worklist:(i=(s=o.worklist_product)==null?void 0:s.worklist)==null?void 0:i.worklist_number,worklist_product_id:(g=o.worklist_product)==null?void 0:g.id}}))}catch{}}function Y(){var a,t;if(w.value){if(typeof((a=h.value)==null?void 0:a.id)=="string"){const o=D.value.find(i=>{var g;return i._id===((g=h.value)==null?void 0:g.id)}),s=c.value.find(i=>{var g;return i.id===((g=h.value)==null?void 0:g.id)});o&&(o.qty=e.qty,o.note=e.note,o.product_id=e.product_id??null,o.worklist_product_id=e.worklist_product_id??null),s&&(s.worklist=e.worklist,s.product_id=e.product_id??null,s.worklist_product_id=e.worklist_product_id??null,s.qty=e.qty,s.product_code=e.product_code,s.product_name=e.product_name,s.note=e.note,c.value=[...c.value]),console.log("ad ",D.value)}else{const o=c.value.find(s=>{var i;return s.id===((i=h.value)==null?void 0:i.id)});if(o){o.product_code=e.product_code,o.product_name=e.product_name,o.qty=e.qty,o.note=e.note,o.worklist=e.worklist,o.worklist_product_id=e.worklist_product_id??null,o.product_id=e.product_id??null;const s=$.value.find(i=>i.id===o.id);s?(s.id=o.id,s.qty=o.qty,s.worklist=o.worklist,s.product_id=o.product_id,s.worklist_product_id=o.worklist_product_id):$.value.push({id:o.id,product_id:o.product_id,worklist_product_id:o.worklist_product_id,qty:o.qty,note:o.note}),console.log("ud ",$.value),c.value=[...c.value]}}me()}else{const o={id:`new-${c.value.length+1}`,qty:e.qty,product_id:e.product_id,product_code:e.product_code,product_name:e.product_name,note:e.note,worklist:e.worklist,worklist_product_id:e.worklist_product_id};c.value=[...c.value,o],D.value.push({_id:o.id,product_id:e.product_id,qty:e.qty,note:e.note,worklist_product_id:e.worklist_product_id}),(t=R.value)==null||t.resetFields(),y.value=""}}function we(a){var t;a.worklist_product_id?(f.value="2",e.worklist_product_id=a.worklist_product_id):f.value="1",w.value=!0,h.value=a,e.product_id=a.product_id,e.product_code=a.product_code,e.product_name=a.product_name,e.qty=a.qty,e.note=a.note,y.value=`${a.product_code} - ${a.product_name}`,(t=R.value)==null||t.clearValidate(),J()}function ge(){e.product_id=void 0,e.worklist_product_id=void 0,e.worklist=void 0,y.value=""}return re(()=>u.formData,()=>{var a;u.formData&&((a=S.value)==null||a.clearValidate(),v.issue_date=u.formData.issue_date,v.note=u.formData.note,setTimeout(()=>{ke()},0))}),se(()=>{ve()}),(a,t)=>{const o=Se,s=je,i=Be,g=Ee,O=He,U=le,Z=Ie,ee=Te,ye=Me,te=xe,he=Ne,be=Ke;return P(),Q("div",Ve,[m("div",Ge,[m("div",Qe,[We,_.editMode?(P(),B(o,{key:0,color:"orange"},{default:n(()=>[q("Mode Edit")]),_:1})):(P(),B(o,{key:1,color:"cyan"},{default:n(()=>[q("Mode Input")]),_:1}))])]),m("div",ze,[l(Z,{ref_key:"formRef",ref:S,model:v,rules:ne,"label-col":{style:{width:"220px"}},colon:!1,"label-align":"left",onFinish:t[3]||(t[3]=d=>b(A)(S.value,fe))},{default:n(()=>[m("div",Xe,[m("div",Je,[l(i,{label:"No. Tran"},{default:n(()=>{var d;return[l(s,{value:_.editMode?(d=_.formData)==null?void 0:d.transaction_number:"",disabled:""},null,8,["value"])]}),_:1}),l(i,{label:"Tgl Transaksi",name:"issue_date",ref:"issue_date"},{default:n(()=>[l(g,{value:v.issue_date?b($e)(v.issue_date):void 0,onChange:t[0]||(t[0]=(d,k)=>v.issue_date=k)},null,8,["value"])]),_:1},512),l(i,{label:"Catatan",ref:"note",name:"note"},{default:n(()=>[l(O,{value:v.note,"onUpdate:value":t[1]||(t[1]=d=>v.note=d)},null,8,["value"])]),_:1},512)]),m("div",Le,[l(U,{class:"mb-3",type:"primary",onClick:t[2]||(t[2]=()=>{w.value=!1,e.product_code=void 0,e.product_id=void 0,e.product_name=void 0,e.qty=void 0,e.note=void 0,y.value="",b(J)()})},{default:n(()=>[q(" Tambah ")]),_:1}),l(de,{style:{height:"300px"},"row-data":c.value,"column-defs":C,loading:b(H),onRowClick:we},null,8,["row-data","column-defs","loading"])]),m("div",Ye,[l(U,{type:"primary","html-type":"submit",loading:b(ce)},{default:n(()=>[Ze,m("span",null,ie(_.editMode?"Edit":"Simpan"),1)]),_:1},8,["loading"]),l(U,{class:"mx-3",onClick:L},{default:n(()=>[q(ie(_.editMode?"Batal Edit":"Bersihkan"),1)]),_:1})])])]),_:1},8,["model"])]),l(be,{visible:b(K),"onUpdate:visible":t[10]||(t[10]=d=>Re(K)?K.value=d:null),title:w.value?"Update Detail":"Tambah Detail","cancel-text":"Tutup",onOk:t[11]||(t[11]=d=>b(A)(R.value,Y))},{default:n(()=>[l(Z,{ref_key:"formRefAddDet",ref:R,model:e,rules:ue,"label-col":{style:{width:"80px"}},colon:!1,"label-align":"left",onFinish:t[9]||(t[9]=d=>b(A)(R.value,Y))},{default:n(()=>[l(ye,{value:f.value,"onUpdate:value":t[4]||(t[4]=d=>f.value=d),class:"mb-4",onChange:ge},{default:n(()=>[l(ee,{value:"1"},{default:n(()=>[q("Non Projek")]),_:1}),l(ee,{value:"2"},{default:n(()=>[q("Projek")]),_:1})]),_:1},8,["value"]),f.value==="1"?(P(),B(i,{key:0,label:"Produk",name:"product_id",ref:"product_id"},{default:n(()=>{var d;return[l(te,{"column-defs":N,"grid-data":((d=x.value)==null?void 0:d.products)??[],loading:b(H),value:void 0,"value-display":y.value,onChange:t[5]||(t[5]=k=>{e.product_id=k.id,e.product_code=k.code,e.product_name=k.name,y.value=`${k.code} - ${k.name}`})},null,8,["grid-data","loading","value-display"])]}),_:1},512)):(P(),B(i,{key:1,label:"Produk",name:"worklist_product_id",ref:"worklist_product_id"},{default:n(()=>{var d;return[l(te,{"column-defs":M,"grid-data":((d=x.value)==null?void 0:d.worklist_products)??[],loading:b(H),value:void 0,"value-display":y.value,onChange:t[6]||(t[6]=k=>{e.worklist_product_id=k.id,e.product_code=k.product.code,e.product_name=k.product.name,e.worklist=k.worklist.worklist_number,y.value=`${k.product.code} - ${k.product.name}`})},null,8,["grid-data","loading","value-display"])]}),_:1},512)),l(i,{label:"Qty",name:"qty",ref:"qty"},{default:n(()=>[l(he,{value:e.qty,"onUpdate:value":t[7]||(t[7]=d=>e.qty=d),min:0,formatter:d=>`${d}`.replace(/\B(?=(\d{3})+(?!\d))/g,"."),parser:d=>d.replace(/\$\s?|(\.*)/g,"")},null,8,["value","formatter","parser"])]),_:1},512),l(i,{label:"Catatan",ref:"note",name:"note"},{default:n(()=>[l(O,{value:e.note,"onUpdate:value":t[8]||(t[8]=d=>e.note=d)},null,8,["value"])]),_:1},512)]),_:1},8,["model"])]),_:1},8,["visible","title"])])}}}),tt=G({__name:"DataTable",props:{idx:null},emits:["rowClick"],setup(_,{emit:r}){const u=_,C=E({value:[{field:"transaction_number",headerName:"No. Tran",pinned:"left",minWidth:100},{field:"issue_date",headerName:"Tgl Tran",...V},{field:"note",headerName:"Catatan",minWidth:100},{field:"created_at",headerName:"Diinput Tgl",...V},{field:"updated_at",headerName:"Diupdate Tgl",...V},{field:"created_by_user_username",headerName:"Diinput Oleh",flex:0,width:120},{field:"updated_by_user_username",headerName:"Diupdate Oleh",flex:0,width:120}]}),N=E({value:null}),{run:M,response:x,loading:y}=I();async function w(){var f;try{await M(T.list()),(f=x.value)!=null&&f.success&&(N.value=x.value.data)}catch{}}function h(f){r("rowClick",f)}return se(()=>{w()}),re(()=>u.idx,()=>{w()}),(f,c)=>(P(),Q("div",null,[l(de,{"row-data":N.value,"column-defs":C.value,loading:b(y),onRowClick:h},null,8,["row-data","column-defs","loading"])]))}}),ot=m("span",null,[m("i",{class:"fe fe-edit-2 me-2"}),q(" Input ")],-1),at=m("span",null,[m("i",{class:"fe fe-search me-2"}),q(" Browse ")],-1),it=m("i",{class:"fe fe-refresh-cw me-2"},null,-1),It=G({__name:"index",setup(_){const r=p("1"),u=p(),C=p(!1),N=p(1);function M(w){r.value="1",u.value={...w},C.value=!0}function x(){C.value=!1}function y(w){N.value+=1,w!==void 0&&(C.value=w)}return(w,h)=>{const f=Ae,c=le,D=Ue;return P(),Q("div",null,[l(D,{class:"input-browse-tab",activeKey:r.value,"onUpdate:activeKey":h[1]||(h[1]=F=>r.value=F),animated:""},Oe({default:n(()=>[l(f,{key:"1"},{tab:n(()=>[ot]),default:n(()=>[l(et,{"form-data":u.value,"edit-mode":C.value,onCancelEdit:x,onOnSuccess:y},null,8,["form-data","edit-mode"])]),_:1}),l(f,{key:"2"},{tab:n(()=>[at]),default:n(()=>[l(tt,{idx:N.value,onRowClick:M},null,8,["idx"])]),_:1})]),_:2},[r.value==="2"?{name:"rightExtra",fn:n(()=>[l(c,{size:"small",class:"mt-3",onClick:h[0]||(h[0]=F=>N.value+=1)},{default:n(()=>[it,q(" Refresh Data ")]),_:1})]),key:"0"}:void 0]),1032,["activeKey"])])}}});export{It as default};
