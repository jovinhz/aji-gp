var Fe=Object.defineProperty;var Ne=(u,n,l)=>n in u?Fe(u,n,{enumerable:!0,configurable:!0,writable:!0,value:l}):u[n]=l;var te=(u,n,l)=>(Ne(u,typeof n!="symbol"?n+"":n,l),l);import{B as oe}from"./index-0bb8ea7a.js";import{_ as ne}from"./AgGrid.vuevuetypescriptsetuptruelang-7e3c6181.js";import{u as Ce}from"./modal-8c6b86e3.js";import{r as S,o as A,t as $e,a as E}from"./index-a69e05bf.js";import"./index-db653870.js";import{_ as Pe}from"./index-660196b9.js";/* empty css              *//* empty css              */import{b as ie,I as qe,_ as Se,F as Oe}from"./Input-6750102f.js";import{H as Me,u as $}from"./HttpClient-a8d470b1.js";import{_ as U}from"./InputDropdown.vuevuetypescriptsetuptruelang-94aa0dee.js";import{_ as Te}from"./AgGridActionCell.vuevuetypescriptsetuptruelang-45fe2eee.js";import{P as Be}from"./ProductService-a6787d37.js";import{d as G,r as _,Q as I,w as de,e as se,g as P,a7 as Q,ac as p,j as V,k as o,a9 as w,b as r,u as m,aa as re,ae as Re,Y as He,ak as je}from"./plugin-vueexport-helper-23a171d5.js";import{M as le}from"./Modal-5e5e8906.js";import{_ as Ee}from"./index-2b5a45ec.js";import{D as Ie}from"./dayjs-b4d9f951.js";import{T as Ke,_ as Ae}from"./TabPane-6246fdd8.js";import"./DownOutlined-4b2aeb27.js";import"./pickAttrs-349b6a5f.js";import"./useMemo-18bb8ebc.js";class q{static list(){return this.HttpClient.axiosInstance.get("/purchase_invoices")}static show(n){return this.HttpClient.axiosInstance.get(`/purchase_invoices/${n}`)}static create(n){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"Faktur Beli berhasil ditambah"}).axiosInstance.post("/purchase_invoices",n)}static update(n,l){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"Faktur Beli berhasil diupdate"}).axiosInstance.put(`/purchase_invoices/${n}`,l)}static upload(n,l){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"File Faktur Beli berhasil diupload"}).axiosInstance.put(`/purchase_invoices/${n}/upload`,l)}static formOptions(){return this.HttpClient.axiosInstance.get("/purchase_invoices/form_options")}}te(q,"HttpClient",new Me);const Ue={class:"card card-custom card-dense"},Ve={class:"card-header"},Ge={class:"card-title w-100 d-flex justify-content-between"},Qe=p("h4",{class:"card-label"},"Form Faktur Beli",-1),ze={class:"card-body"},Je={class:"row"},Ye={class:"col-lg-6"},Le={class:"col-lg-12"},We={class:"col-lg-6 mt-3"},Xe=p("i",{class:"fe fe-save me-2"},null,-1),Ze=p("span",null,"Rp",-1),ea=G({__name:"Form",props:{formData:null,editMode:{type:Boolean}},emits:["cancelEdit","onSuccess"],setup(u,{emit:n}){const l=u,y=[{headerName:"Kode Supplier",field:"code"},{headerName:"Nama Supplier",field:"name"}],k=[{headerName:"No PO",field:"purchase_order_number"}],O=[{field:"code",headerName:"Kode Produk"},{field:"name",headerName:"Nama Produk"},{field:"category_caption",headerName:"Kategori"},{field:"unit.name",headerName:"Satuan"}],F=[{field:"product.code",headerName:"Kode Produk"},{field:"product.name",headerName:"Nama Produk"},{field:"qty",headerName:"Qty",filter:"agNumberColumnFilter",type:"numericColumn",valueFormatter:i=>$e(i.value)},{field:"price",headerName:"Harga",filter:"agNumberColumnFilter",type:"numericColumn",valueFormatter:i=>S(i.value)},{headerName:"Subtotal",filter:"agNumberColumnFilter",type:"numericColumn",valueGetter:i=>i.data.qty*i.data.price,valueFormatter:i=>S(i.value)},{headerName:"Aksi",filter:!1,floatingFilter:!1,sortable:!1,resizable:!1,suppressMovable:!0,pinned:"right",width:75,flex:0,cellRenderer:Te,cellRendererParams:i=>({onDelete:()=>{g.value=g.value.filter(e=>e.id!==i.data.id),typeof i.data.id=="number"?M.value.push({id:i.data.id,_destroy:1}):x.value=x.value.filter(e=>e._id!==i.data.id)}})}],N=_([]),f=_(""),v=_(""),d=_(""),D=_(),C=_(),t=I({items_attributes:[]}),ue={supplier_id:[{required:!0,message:"Supplier wajib dipilih",trigger:"change"}],purchase_order_id:[{required:!0,message:"PO wajib dipilih",trigger:"change"}],invoice_date:[{required:!0,message:"Tgl faktur wajib diisi",trigger:"change"}],due_date:[{required:!0,message:"Tgl jto faktur wajib diisi",trigger:"change"}],tax_percent:[{required:!0,message:"PPn faktur wajib diisi",trigger:"change"}]},T=_(),c=I({}),ce={product_id:[{required:!0,message:"Produk wajib dipilih",trigger:"change"}],qty:[{required:!0,message:"Qty wajib diisi",trigger:"change"}],price:[{required:!0,message:"Harga wajib diisi",trigger:"change"}]},g=_([]),x=_([]),M=_([]),{run:z,loading:pe,response:B}=$(),{run:me,loading:_e,response:J}=$(),{run:fe,loading:Y,response:L}=$(),{run:ve,loading:ge,response:W}=$(),{run:la,loading:he,response:oa}=$(),{visible:K,open:be,close:na}=Ce();async function ye(){var i,e,h,R;try{l.editMode?(await z(q.update((i=l.formData)==null?void 0:i.id,{invoice_number:t.invoice_number,due_date:t.due_date,invoice_date:t.invoice_date,purchase_order_id:t.purchase_order_id,supplier_id:t.supplier_id,tax_percent:t.tax_percent,items_attributes:[...x.value,...M.value]})),(e=B.value)!=null&&e.success&&(x.value=[],M.value=[],g.value=B.value.data.items.map(s=>({id:s.id,price:parseFloat(s.price),qty:parseFloat(s.qty),product:s.product})))):(await z(q.create({invoice_number:t.invoice_number,due_date:t.due_date,invoice_date:t.invoice_date,purchase_order_id:t.purchase_order_id,supplier_id:t.supplier_id,tax_percent:t.tax_percent,items_attributes:g.value.map(s=>({product_id:s.product.id,qty:s.qty,price:s.price}))})),(h=B.value)!=null&&h.success&&X()),(R=B.value)!=null&&R.success&&n("onSuccess")}catch{}}async function ke(){}function X(){var i;if(l.editMode){for(const e in t)t[e]=void 0;n("cancelEdit")}else(i=C.value)==null||i.resetFields();g.value=[],x.value=[],M.value=[],f.value="",v.value=""}function we(){le.confirm({title:"Konfirmasi Hapus Faktur",content:"Apakah kamu sudah yakin ingin menghapus data [Edit Here]",cancelText:"Batal",onOk:ke})}function Z(){var e;const i={id:`new-${g.value.length+1}`,qty:c.qty,price:c.price,product:{code:c.product_code,name:c.product_name,id:c.product_id}};g.value=[...g.value,i],x.value.push({_id:i.id,product_id:c.product_id,qty:c.qty,price:c.price}),(e=T.value)==null||e.resetFields(),d.value=""}async function De(){var i,e;try{await me(q.show((i=l.formData)==null?void 0:i.id)),(e=J.value)!=null&&e.success&&(g.value=J.value.data.items.map(h=>({id:h.id,price:parseFloat(h.price),qty:parseFloat(h.qty),product:h.product})))}catch{}}return de(()=>l.formData,()=>{var i;l.formData&&((i=C.value)==null||i.clearValidate(),g.value=[],x.value=[],M.value=[],t.invoice_number=l.formData.invoice_number,t.due_date=l.formData.due_date,t.invoice_date=l.formData.invoice_date,t.purchase_order_id=l.formData.purchase_order.id,t.supplier_id=l.formData.supplier.id,t.tax_percent=parseFloat(l.formData.tax_percent),f.value=`${l.formData.supplier.code} - ${l.formData.supplier.name}`,v.value=l.formData.purchase_order.purchase_order_number??"",De())}),se(async()=>{try{(async()=>{var i;await fe(q.formOptions()),(i=L.value)!=null&&i.success&&(D.value=L.value.data)})(),(async()=>{var i;await ve(Be.list()),(i=W.value)!=null&&i.success&&(N.value=W.value.data)})()}catch{}}),(i,e)=>{const h=Ee,R=qe,s=Se,ee=Ie,H=Pe,j=oe,ae=Oe,xe=le;return P(),Q("div",Ue,[p("div",Ve,[p("div",Ge,[Qe,u.editMode?(P(),V(h,{key:0,color:"orange"},{default:o(()=>[w("Mode Edit")]),_:1})):(P(),V(h,{key:1,color:"cyan"},{default:o(()=>[w("Mode Input")]),_:1}))])]),p("div",ze,[r(ae,{ref_key:"formRef",ref:C,model:t,rules:ue,"label-col":{style:{width:"220px"}},colon:!1,"label-align":"left",onFinish:e[7]||(e[7]=a=>m(A)(C.value,ye))},{default:o(()=>[p("div",Je,[p("div",Ye,[r(s,{label:"No Faktur"},{default:o(()=>[r(R,{value:t.invoice_number,"onUpdate:value":e[0]||(e[0]=a=>t.invoice_number=a)},null,8,["value"])]),_:1}),r(s,{label:"Supplier",name:"supplier_id",ref:"supplier_id"},{default:o(()=>{var a;return[r(U,{"column-defs":y,"grid-data":((a=D.value)==null?void 0:a.suppliers)??[],loading:m(Y),value:void 0,"value-display":f.value,onChange:e[1]||(e[1]=b=>{t.supplier_id=b.id,f.value=`${b.code} - ${b.name}`})},null,8,["grid-data","loading","value-display"])]}),_:1},512),r(s,{label:"No PO",name:"purchase_order_id",ref:"purchase_order_id"},{default:o(()=>{var a;return[r(U,{"column-defs":k,"grid-data":((a=D.value)==null?void 0:a.purchase_order_id)??[],loading:m(Y),value:void 0,"value-display":v.value,onChange:e[2]||(e[2]=b=>{t.purchase_order_id=b.id,v.value=`${b.purchase_order_number}`})},null,8,["grid-data","loading","value-display"])]}),_:1},512),r(s,{label:"Tgl Faktur",name:"invoice_date",ref:"invoice_date"},{default:o(()=>[r(ee,{value:t.invoice_date?m(ie)(t.invoice_date):void 0,onChange:e[3]||(e[3]=(a,b)=>t.invoice_date=b)},null,8,["value"])]),_:1},512),r(s,{label:"Tgl JTO Faktur",name:"due_date",ref:"due_date"},{default:o(()=>[r(ee,{value:t.due_date?m(ie)(t.due_date):void 0,onChange:e[4]||(e[4]=(a,b)=>t.due_date=b)},null,8,["value"])]),_:1},512),r(s,{label:"PPn %",name:"tax_percent",ref:"tax_percent"},{default:o(()=>[r(H,{value:t.tax_percent,"onUpdate:value":e[5]||(e[5]=a=>t.tax_percent=a),min:0},null,8,["value"])]),_:1},512),r(s,{label:"Total Faktur"},{default:o(()=>{var a;return[r(H,{value:u.editMode?m(S)(((a=l.formData)==null?void 0:a.total_price)??""):"",disabled:""},null,8,["value"])]}),_:1})]),p("div",Le,[r(j,{class:"mb-3",type:"primary",onClick:m(be)},{default:o(()=>[w(" Tambah ")]),_:1},8,["onClick"]),r(ne,{style:{height:"300px"},"row-data":g.value,"column-defs":F,loading:m(_e),onRowClick:e[6]||(e[6]=()=>{})},null,8,["row-data","column-defs","loading"])]),p("div",We,[r(j,{type:"primary","html-type":"submit",loading:m(pe)},{default:o(()=>[Xe,p("span",null,re(u.editMode?"Edit":"Simpan"),1)]),_:1},8,["loading"]),r(j,{class:"mx-3",onClick:X},{default:o(()=>[w(re(u.editMode?"Batal Edit":"Bersihkan"),1)]),_:1}),u.editMode?(P(),V(j,{key:0,danger:"",type:"primary",onClick:we,loading:m(he)},{default:o(()=>[w(" Hapus ")]),_:1},8,["loading"])):Re("",!0)])])]),_:1},8,["model"])]),r(xe,{visible:m(K),"onUpdate:visible":e[12]||(e[12]=a=>He(K)?K.value=a:null),title:"Tambah Detail","cancel-text":"Tutup",onOk:e[13]||(e[13]=a=>m(A)(T.value,Z))},{default:o(()=>[r(ae,{ref_key:"formRefAddDet",ref:T,model:c,rules:ce,"label-col":{style:{width:"220px"}},colon:!1,"label-align":"left",onFinish:e[11]||(e[11]=a=>m(A)(T.value,Z))},{default:o(()=>[r(s,{label:"Produk",name:"product_id",ref:"product_id"},{default:o(()=>[r(U,{"column-defs":O,"grid-data":N.value??[],loading:m(ge),value:void 0,"value-display":d.value,onChange:e[8]||(e[8]=a=>{c.product_id=a.id,c.product_code=a.code,c.product_name=a.name,d.value=`${a.code} - ${a.name}`})},null,8,["grid-data","loading","value-display"])]),_:1},512),r(s,{label:"Qty",name:"qty",ref:"qty"},{default:o(()=>[r(H,{value:c.qty,"onUpdate:value":e[9]||(e[9]=a=>c.qty=a),min:0,formatter:a=>`${a}`.replace(/\B(?=(\d{3})+(?!\d))/g,"."),parser:a=>a.replace(/\$\s?|(\.*)/g,"")},null,8,["value","formatter","parser"])]),_:1},512),r(s,{label:"Harga",name:"price",ref:"price"},{default:o(()=>[r(H,{value:c.price,"onUpdate:value":e[10]||(e[10]=a=>c.price=a),min:0,formatter:a=>`${a}`.replace(/\B(?=(\d{3})+(?!\d))/g,"."),parser:a=>a.replace(/\$\s?|(\.*)/g,"")},{addonBefore:o(()=>[Ze]),_:1},8,["value","formatter","parser"])]),_:1},512)]),_:1},8,["model"])]),_:1},8,["visible"])])}}}),aa=G({__name:"DataTable",props:{idx:null},emits:["rowClick"],setup(u,{emit:n}){const l=u,y=I({value:[{field:"invoice_number",headerName:"No. Faktur",width:120,flex:0,pinned:"left"},{field:"purchase_order.purchase_order_number",headerName:"No. PO",width:120,flex:0,pinned:"left"},{field:"supplier.name",headerName:"Supplier",width:120,flex:0},{field:"invoice_date",headerName:"Tgl Faktur",...E},{field:"due_date",headerName:"Tgl Jto",...E},{field:"subtotal",headerName:"Subtotal",filter:"agNumberColumnFilter",type:"numericColumn",width:100,flex:0,valueFormatter:d=>S(d.value)},{field:"tax_percent",headerName:"PPn %",filter:"agNumberColumnFilter",type:"numericColumn",width:80,flex:0,valueGetter:d=>parseFloat(d.data.tax_percent)},{field:"tax_nominal",headerName:"PPn Nilai",filter:"agNumberColumnFilter",type:"numericColumn",width:100,flex:0,valueFormatter:d=>S(d.value)},{field:"total_price",headerName:"Grand Total",filter:"agNumberColumnFilter",type:"numericColumn",width:120,flex:0,valueFormatter:d=>S(d.value)},{field:"created_at",headerName:"Diinput Tgl",...E},{field:"updated_at",headerName:"Diupdate Tgl",...E},{field:"created_by_user_username",headerName:"Diinput Oleh",flex:0,width:120},{field:"updated_by_user_username",headerName:"Diupdate Oleh",flex:0,width:120}]}),k=I({value:null}),{run:O,response:F,loading:N}=$();async function f(){var d;try{await O(q.list()),(d=F.value)!=null&&d.success&&(k.value=F.value.data)}catch{}}function v(d){n("rowClick",d)}return se(()=>{f()}),de(()=>l.idx,()=>{f()}),(d,D)=>(P(),Q("div",null,[r(ne,{"row-data":k.value,"column-defs":y.value,loading:m(N),onRowClick:v},null,8,["row-data","column-defs","loading"])]))}}),ta=p("span",null,[p("i",{class:"fe fe-edit-2 me-2"}),w(" Input ")],-1),ia=p("span",null,[p("i",{class:"fe fe-search me-2"}),w(" Browse ")],-1),ra=p("i",{class:"fe fe-refresh-cw me-2"},null,-1),qa=G({__name:"index",setup(u){const n=_("1"),l=_(),y=_(!1),k=_(1);function O(f){n.value="1",l.value={...f},y.value=!0}function F(){y.value=!1}function N(f){k.value+=1,f!==void 0&&(y.value=f)}return(f,v)=>{const d=Ae,D=oe,C=Ke;return P(),Q("div",null,[r(C,{class:"input-browse-tab",activeKey:n.value,"onUpdate:activeKey":v[1]||(v[1]=t=>n.value=t),animated:""},je({default:o(()=>[r(d,{key:"1"},{tab:o(()=>[ta]),default:o(()=>[r(ea,{"form-data":l.value,"edit-mode":y.value,onCancelEdit:F,onOnSuccess:N},null,8,["form-data","edit-mode"])]),_:1}),r(d,{key:"2"},{tab:o(()=>[ia]),default:o(()=>[r(aa,{idx:k.value,onRowClick:O},null,8,["idx"])]),_:1})]),_:2},[n.value==="2"?{name:"rightExtra",fn:o(()=>[r(D,{size:"small",class:"mt-3",onClick:v[0]||(v[0]=t=>k.value+=1)},{default:o(()=>[ra,w(" Refresh Data ")]),_:1})]),key:"0"}:void 0]),1032,["activeKey"])])}}});export{qa as default};
