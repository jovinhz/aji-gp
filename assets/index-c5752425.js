var oe=Object.defineProperty;var ie=(l,o,t)=>o in l?oe(l,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):l[o]=t;var R=(l,o,t)=>(ie(l,typeof o!="symbol"?o+"":o,t),t);import{B as V}from"./index-0bb8ea7a.js";import{_ as se}from"./AgGrid.vuevuetypescriptsetuptruelang-7e3c6181.js";import{o as ne,a as q}from"./index-a69e05bf.js";import"./index-db653870.js";import{_ as le,S as re}from"./index-6aba2020.js";/* empty css              *//* empty css              */import{b as de,I as ue,_ as ce,F as me}from"./Input-6750102f.js";import{H as _e,u as O}from"./HttpClient-a8d470b1.js";import{_ as J}from"./InputDropdown.vuevuetypescriptsetuptruelang-94aa0dee.js";import{d as P,r as f,Q as H,w as A,e as G,g as h,a7 as F,ac as d,j as M,k as i,a9 as k,b as a,u as b,F as fe,ab as pe,aa as B,ae as ve,ak as ge}from"./plugin-vueexport-helper-23a171d5.js";import{M as he}from"./Modal-5e5e8906.js";import{_ as ke}from"./index-2b5a45ec.js";import{D as we}from"./dayjs-b4d9f951.js";import{_ as ye}from"./TextArea-fa00ec12.js";import{T as be,_ as De}from"./TabPane-6246fdd8.js";import"./pickAttrs-349b6a5f.js";import"./useMemo-18bb8ebc.js";import"./DownOutlined-4b2aeb27.js";import"./SearchOutlined-731e9f20.js";class D{static list(){return this.HttpClient.axiosInstance.get("/worklists")}static create(o){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"Projek berhasil ditambah"}).axiosInstance.post("/worklists",o)}static update(o,t){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"Projek berhasil diupdate"}).axiosInstance.put(`/worklists/${o}`,t)}static formOptions(o){return this.HttpClient.axiosInstance.get("/worklists/form_options",{params:{customer_id:o}})}}R(D,"HttpClient",new _e);const xe={class:"card card-custom card-dense"},Ce={class:"card-header"},Ne={class:"card-title w-100 d-flex justify-content-between"},je=d("h4",{class:"card-label"},"Form Projek",-1),$e={class:"card-body"},Me={class:"row"},Oe={class:"col-lg-6"},Fe=d("i",{class:"fe fe-save me-2"},null,-1),Se=P({__name:"Form",props:{formData:null,editMode:{type:Boolean}},emits:["cancelEdit","onSuccess"],setup(l,{emit:o}){const t=l,p=[{field:"code",headerName:"Kode Customer"},{field:"name",headerName:"Nama Customer"},{field:"customer_group.name",headerName:"Grup Customer"},{field:"address",headerName:"Alamat"},{field:"note",headerName:"Keterangan"}],v=[{field:"code",headerName:"Kode Unit"},{field:"name",headerName:"Nama Unit"}],g=f(""),m=f(""),w=f(),u=f(),c=f(),e=H({}),x={customer_id:[{required:!0,message:"Customer wajib dipilih",trigger:"change"}],customer_unit_id:[{required:!0,message:"Customer unit wajib dipilih",trigger:"change"}],worklist_date:[{required:!0,message:"Tanggal projek wajib diisi",trigger:"change"}],type_id:[{required:!0,message:"Tipe projek wajib dipilih",trigger:"change"}],title:[{required:!0,message:"Judul projek wajib diisi",trigger:"change"}]},{run:N,loading:j,response:E}=O(),{run:K,loading:z,response:$}=O(),{run:Ee,loading:L,response:Ke}=O();async function Q(){var r,s,C;try{t.editMode?await N(D.update((r=t.formData)==null?void 0:r.id,{customer_id:e.customer_id,customer_unit_id:e.customer_unit_id,title:e.title,type_id:e.type_id,worklist_date:e.worklist_date,note:e.note})):(await N(D.create({customer_id:e.customer_id,customer_unit_id:e.customer_unit_id,type_id:e.type_id,title:e.title,worklist_date:e.worklist_date,note:e.note})),(s=E.value)!=null&&s.success&&U()),(C=E.value)!=null&&C.success&&o("onSuccess")}catch{}}async function W(){}function U(){var r;if(t.editMode){for(const s in e)e[s]=void 0;o("cancelEdit")}else(r=c.value)==null||r.resetFields();m.value="",g.value=""}function X(){he.confirm({title:"Konfirmasi Hapus Projek",content:"Apakah kamu sudah yakin ingin menghapus data [Edit Here]",cancelText:"Batal",onOk:W})}async function I(){var r;try{await K(D.formOptions(e.customer_id)),(r=$.value)!=null&&r.success&&(u.value=$.value.data.customer_units)}catch{}}return A(()=>t.formData,()=>{var r;t.formData&&((r=c.value)==null||r.clearValidate(),e.customer_id=t.formData.customer.id,e.customer_unit_id=t.formData.customer_unit.id,e.title=t.formData.title,e.note=t.formData.note,e.type_id=t.formData.type_id,e.worklist_date=t.formData.worklist_date,m.value=`${t.formData.customer_unit.code} - ${t.formData.customer_unit.name}`,g.value=`${t.formData.customer.code} - ${t.formData.customer.name}`,I())}),G(async()=>{var r;try{await K(D.formOptions()),(r=$.value)!=null&&r.success&&(w.value=$.value.data)}catch{}}),(r,s)=>{const C=ke,S=ue,y=ce,Y=we,Z=re,ee=le,te=ye,T=V,ae=me;return h(),F("div",xe,[d("div",Ce,[d("div",Ne,[je,l.editMode?(h(),M(C,{key:0,color:"orange"},{default:i(()=>[k("Mode Edit")]),_:1})):(h(),M(C,{key:1,color:"cyan"},{default:i(()=>[k("Mode Input")]),_:1}))])]),d("div",$e,[a(ae,{ref_key:"formRef",ref:c,model:e,rules:x,"label-col":{style:{width:"220px"}},colon:!1,"label-align":"left",onFinish:s[6]||(s[6]=n=>b(ne)(c.value,Q))},{default:i(()=>[d("div",Me,[d("div",Oe,[a(y,{label:"No Projek"},{default:i(()=>{var n;return[a(S,{value:l.editMode?(n=t.formData)==null?void 0:n.worklist_number:"",disabled:""},null,8,["value"])]}),_:1}),a(y,{label:"Customer",name:"customer_id",ref:"customer_id"},{default:i(()=>{var n;return[a(J,{"column-defs":p,"grid-data":((n=w.value)==null?void 0:n.customers)??[],loading:b(z),value:void 0,"value-display":g.value,onChange:s[0]||(s[0]=_=>{_.id!==e.customer_id&&(e.customer_unit_id=void 0,m.value=""),e.customer_id=_.id,g.value=`${_.code} - ${_.name}`,I()})},null,8,["grid-data","loading","value-display"])]}),_:1},512),a(y,{label:"Unit",name:"customer_unit_id",ref:"customer_unit_id"},{default:i(()=>[a(J,{"column-defs":v,"grid-data":u.value??[],loading:u.value===null,value:void 0,"value-display":m.value,disabled:!e.customer_id,onChange:s[1]||(s[1]=n=>{e.customer_unit_id=n.id,m.value=`${n.code} - ${n.name}`})},null,8,["grid-data","loading","value-display","disabled"])]),_:1},512),a(y,{label:"Tgl Projek",name:"worklist_date",ref:"worklist_date"},{default:i(()=>[a(Y,{value:e.worklist_date?b(de)(e.worklist_date):void 0,onChange:s[2]||(s[2]=(n,_)=>e.worklist_date=_)},null,8,["value"])]),_:1},512),a(y,{label:"Judul",name:"title",ref:"title"},{default:i(()=>[a(S,{value:e.title,"onUpdate:value":s[3]||(s[3]=n=>e.title=n)},null,8,["value"])]),_:1},512),a(y,{label:"Jenis Projek",name:"type_id",ref:"type_id"},{default:i(()=>[a(ee,{value:e.type_id,"onUpdate:value":s[4]||(s[4]=n=>e.type_id=n)},{default:i(()=>{var n;return[(h(!0),F(fe,null,pe((n=w.value)==null?void 0:n.types,_=>(h(),M(Z,{value:_.id},{default:i(()=>[k(B(_.title),1)]),_:2},1032,["value"]))),256))]}),_:1},8,["value"])]),_:1},512),a(y,{label:"Keterangan",name:"note",ref:"note"},{default:i(()=>[a(te,{value:e.note,"onUpdate:value":s[5]||(s[5]=n=>e.note=n)},null,8,["value"])]),_:1},512),a(T,{type:"primary","html-type":"submit",loading:b(j)},{default:i(()=>[Fe,d("span",null,B(l.editMode?"Edit":"Simpan"),1)]),_:1},8,["loading"]),a(T,{class:"mx-3",onClick:U},{default:i(()=>[k(B(l.editMode?"Batal Edit":"Bersihkan"),1)]),_:1}),l.editMode?(h(),M(T,{key:0,danger:"",type:"primary",onClick:X,loading:b(L)},{default:i(()=>[k(" Hapus ")]),_:1},8,["loading"])):ve("",!0)])])]),_:1},8,["model"])])])}}}),Te=P({__name:"DataTable",props:{idx:null},emits:["rowClick"],setup(l,{emit:o}){const t=l,p=H({value:[{field:"worklist_number",headerName:"No Projek",width:120,flex:0,pinned:"left"},{field:"title",headerName:"Judul",width:150,flex:0,autoHeight:!0,wrapText:!0},{field:"worklist_date_caption",headerName:"Tgl Projek",width:150,flex:0},{field:"customer.name",headerName:"Customer",width:150,flex:0},{field:"customer_unit.name",headerName:"Customer Unit",width:150,flex:0},{field:"type_caption",headerName:"Jenis Projek",width:110,flex:0},{field:"status_caption",headerName:"Status",width:150,flex:0},{field:"note",headerName:"Keterangan",width:150,flex:0},{field:"created_at",headerName:"Diinput Tgl",...q},{field:"updated_at",headerName:"Diupdate Tgl",...q},{field:"created_by_user_username",headerName:"Diinput Oleh",flex:0,width:120},{field:"updated_by_user_username",headerName:"Diupdate Oleh",flex:0,width:120}]}),v=H({value:null}),{run:g,response:m,loading:w}=O();async function u(){var e;try{await g(D.list()),(e=m.value)!=null&&e.success&&(v.value=m.value.data)}catch{}}function c(e){o("rowClick",e)}return G(()=>{u()}),A(()=>t.idx,()=>{u()}),(e,x)=>(h(),F("div",null,[a(se,{"row-data":v.value,"column-defs":p.value,loading:b(w),onRowClick:c},null,8,["row-data","column-defs","loading"])]))}}),Be=d("span",null,[d("i",{class:"fe fe-edit-2 me-2"}),k(" Input ")],-1),He=d("span",null,[d("i",{class:"fe fe-search me-2"}),k(" Browse ")],-1),Pe=d("i",{class:"fe fe-refresh-cw me-2"},null,-1),nt=P({__name:"index",setup(l){const o=f("1"),t=f(),p=f(!1),v=f(1);function g(u){o.value="1",t.value={...u},p.value=!0}function m(){p.value=!1}function w(u){v.value+=1,u!==void 0&&(p.value=u)}return(u,c)=>{const e=De,x=V,N=be;return h(),F("div",null,[a(N,{class:"input-browse-tab",activeKey:o.value,"onUpdate:activeKey":c[1]||(c[1]=j=>o.value=j),animated:""},ge({default:i(()=>[a(e,{key:"1"},{tab:i(()=>[Be]),default:i(()=>[a(Se,{"form-data":t.value,"edit-mode":p.value,onCancelEdit:m,onOnSuccess:w},null,8,["form-data","edit-mode"])]),_:1}),a(e,{key:"2"},{tab:i(()=>[He]),default:i(()=>[a(Te,{idx:v.value,onRowClick:g},null,8,["idx"])]),_:1})]),_:2},[o.value==="2"?{name:"rightExtra",fn:i(()=>[a(x,{size:"small",class:"mt-3",onClick:c[0]||(c[0]=j=>v.value+=1)},{default:i(()=>[Pe,k(" Refresh Data ")]),_:1})]),key:"0"}:void 0]),1032,["activeKey"])])}}});export{nt as default};
