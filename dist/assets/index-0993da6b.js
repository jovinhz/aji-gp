var ke=Object.defineProperty;var be=(_,d,l)=>d in _?ke(_,d,{enumerable:!0,configurable:!0,writable:!0,value:l}):_[d]=l;var te=(_,d,l)=>(be(_,typeof d!="symbol"?d+"":d,l),l);import{B as ae}from"./index-ea116739.js";import{_ as ie}from"./AgGrid.vuevuetypescriptsetuptruelang-77b595bf.js";import{u as we}from"./modal-e8545dd0.js";import{o as V,t as xe,r as P,a as G}from"./index-e4830b65.js";import"./index-d6da99f3.js";import{_ as qe,S as Ce}from"./index-8f3059d4.js";import{_ as De}from"./index-5e1582ec.js";/* empty css              *//* empty css              */import{a as Ne,I as Fe,_ as Te,F as $e}from"./Input-faacc60f.js";import{H as Pe,u as U}from"./HttpClient-4d61e396.js";import{_ as j}from"./InputDropdown.vuevuetypescriptsetuptruelang-41229005.js";import{_ as He}from"./AgGridActionCell.vuevuetypescriptsetuptruelang-6f790c93.js";import{d as W,r as f,O as B,w as re,a as ne,e as F,a7 as I,ac as c,f as A,g as r,a9 as D,c as i,u as h,F as Se,ab as Me,aa as Q,X as Oe,ak as Re}from"./plugin-vueexport-helper-0ef99882.js";import{_ as Ue}from"./index-ad0e6402.js";import{D as Be}from"./dayjs-5828be59.js";import{_ as Ie}from"./TextArea-cd8e5869.js";import{M as Ke}from"./Modal-a79fac37.js";import{T as Ee,_ as Ve}from"./TabPane-76270f32.js";import"./pickAttrs-8b0a1b9e.js";import"./useMemo-49158cc8.js";import"./DownOutlined-45ad6b93.js";import"./SearchOutlined-c25cb455.js";class T{static list(){return this.HttpClient.axiosInstance.get("/price_quotations")}static show(d){return this.HttpClient.axiosInstance.get(`/price_quotations/${d}`)}static create(d){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"Penawaran Harga berhasil ditambah"}).axiosInstance.post("/price_quotations",d)}static update(d,l){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"Penawaran Harga berhasil diupdate"}).axiosInstance.put(`/price_quotations/${d}`,l)}static formOptions(d){return this.HttpClient.axiosInstance.get("/price_quotations/form_options",{params:{worklist_id:d}})}}te(T,"HttpClient",new Pe);const Ge={class:"card card-custom card-dense"},je={class:"card-header"},Ae={class:"card-title w-100 d-flex justify-content-between"},Qe=c("h4",{class:"card-label"},"Form Penawaran Harga",-1),We={class:"card-body"},ze={class:"row"},Je={class:"col-lg-6"},Le={class:"col-lg-12"},Xe={class:"col-lg-6 mt-3"},Ye=c("i",{class:"fe fe-save me-2"},null,-1),Ze=c("span",null,"Rp",-1),et=c("span",null,"Rp",-1),tt=W({__name:"Form",props:{formData:null,editMode:{type:Boolean}},emits:["cancelEdit","onSuccess"],setup(_,{emit:d}){const l=_,w=[{headerName:"No. Projek",field:"worklist_number"},{headerName:"Judul Projek",field:"title"}],k=[{headerName:"Nama",field:"name"}],$=[{field:"item_description",headerName:"Deskripsi"},{field:"specification",headerName:"Spesifikasi"},{field:"remarks",headerName:"Remark"},{field:"qty",headerName:"Qty",filter:"agNumberColumnFilter",type:"numericColumn",valueFormatter:o=>xe(o.value)},{field:"qty_unit",headerName:"Satuan"},{field:"ex_price",headerName:"Harga Tawar",filter:"agNumberColumnFilter",type:"numericColumn",valueFormatter:o=>P(o.value)},{field:"price",headerName:"Harga Final",filter:"agNumberColumnFilter",type:"numericColumn",valueFormatter:o=>P(o.value)},{headerName:"Aksi",filter:!1,floatingFilter:!1,sortable:!1,resizable:!1,suppressMovable:!0,pinned:"right",width:75,flex:0,cellRenderer:He,cellRendererParams:o=>({onDelete:()=>{m.value=m.value.filter(t=>t.id!==o.data.id),typeof o.data.id=="number"?q.value.push({id:o.data.id,_destroy:1}):b.value=b.value.filter(t=>t._id!==o.data.id)}})}],x=f(),N=f([]),v=f(""),y=f(""),u=f(""),m=f([]),b=f([]),q=f([]),H=f(),e=B({}),le={worklist_id:[{required:!0,message:"Worklist harus dipilih",trigger:"change"}],contact_person_id:[{required:!0,message:"Kontak harus dipilih",trigger:"change"}],contact_person_cc_id:[{required:!0,message:"Kontak CC harus dipilih",trigger:"change"}],price_quotation_date:[{required:!0,message:"Tgl PH harus diisi",trigger:"change"}],tax_percent:[{required:!0,message:"PPn harus diisi",trigger:"change"}],tnc_price:[{required:!0,message:"T&C Price harus diisi",trigger:"change"}],tnc_franco:[{required:!0,message:"T&C Franco harus diisi",trigger:"change"}],tnc_payment:[{required:!0,message:"T&C Payment harus diisi",trigger:"change"}],tnc_delivery:[{required:!0,message:"T&C Delivery harus diisi",trigger:"change"}],tnc_validity:[{required:!0,message:"T&C Validity harus diisi",trigger:"change"}],tnc_duration_of_manufacture:[{required:!0,message:"T&C Duration of Manufacture harus diisi",trigger:"change"}],status_id:[{required:!0,message:"Status harus dipilih",trigger:"change"}]},S=f(),s=B({}),oe={item_description:[{required:!0,message:"Deskripsi harus diisi",trigger:"change"}],specification:[{required:!0,message:"Spesifikasi harus diisi",trigger:"change"}],qty:[{required:!0,message:"Qty harus diisi",trigger:"change"}],qty_unit:[{required:!0,message:"Satuan harus diisi",trigger:"change"}],ex_price:[{required:!0,message:"Harga tawar harus diisi",trigger:"change"}]},{run:z,loading:se,response:M}=U(),{run:J,loading:ue,response:O}=U(),{run:de,loading:ce,response:L}=U(),{visible:K,open:_e,close:lt}=we();async function me(){var o,t,p,g;try{l.editMode?(await z(T.update((o=l.formData)==null?void 0:o.id,{contact_person_cc_id:e.contact_person_cc_id,contact_person_id:e.contact_person_id,price_quotation_date:e.price_quotation_date,status_id:e.status_id,tax_percent:e.tax_percent,tnc_delivery:e.tnc_delivery,tnc_duration_of_manufacture:e.tnc_duration_of_manufacture,tnc_franco:e.tnc_franco,tnc_payment:e.tnc_payment,tnc_price:e.tnc_price,tnc_validity:e.tnc_validity,worklist_id:e.worklist_id,items_attributes:[...b.value,...q.value]})),(t=M.value)!=null&&t.success&&(b.value=[],q.value=[],m.value=M.value.data.items.map(n=>({id:n.id,ex_price:n.ex_price,item_description:n.item_description,price:n.price,qty:parseInt(n.qty,10),qty_unit:n.qty_unit,remarks:n.remarks,specification:n.specification})))):(await z(T.create({contact_person_cc_id:e.contact_person_cc_id,contact_person_id:e.contact_person_id,price_quotation_date:e.price_quotation_date,status_id:e.status_id,tax_percent:e.tax_percent,tnc_delivery:e.tnc_delivery,tnc_duration_of_manufacture:e.tnc_duration_of_manufacture,tnc_franco:e.tnc_franco,tnc_payment:e.tnc_payment,tnc_price:e.tnc_price,tnc_validity:e.tnc_validity,worklist_id:e.worklist_id,items_attributes:m.value.map(n=>({ex_price:n.ex_price,item_description:n.item_description,price:n.price,qty:n.qty,qty_unit:n.qty_unit,remarks:n.remarks,specification:n.specification}))})),(p=M.value)!=null&&p.success&&Y()),(g=M.value)!=null&&g.success&&d("onSuccess")}catch{}}async function X(){var o;try{await J(T.formOptions(e.worklist_id)),(o=O.value)!=null&&o.success&&(N.value=O.value.data.contact_persons)}catch{}}function Y(){var o;if(l.editMode){for(const t in e)e[t]=void 0;d("cancelEdit")}else(o=H.value)==null||o.resetFields();m.value=[],b.value=[],q.value=[],u.value="",v.value="",y.value=""}function Z(){var t;const o={id:`new-${m.value.length+1}`,qty:s.qty,price:s.price,ex_price:s.ex_price,item_description:s.item_description,qty_unit:s.qty_unit,remarks:s.remarks,specification:s.specification};m.value=[...m.value,o],b.value.push({_id:o.id,qty:s.qty,price:s.price,ex_price:s.ex_price,item_description:s.item_description,qty_unit:s.qty_unit,remarks:s.remarks,specification:s.specification}),(t=S.value)==null||t.resetFields()}async function pe(){var o,t;try{await de(T.show((o=l.formData)==null?void 0:o.id)),(t=L.value)!=null&&t.success&&(m.value=L.value.data.items.map(p=>({id:p.id,ex_price:p.ex_price,item_description:p.item_description,price:p.price,qty:parseInt(p.qty,10),qty_unit:p.qty_unit,remarks:p.remarks,specification:p.specification})))}catch{}}return re(()=>l.formData,()=>{var o;l.formData&&((o=H.value)==null||o.clearValidate(),m.value=[],b.value=[],q.value=[],e.contact_person_cc_id=l.formData.contact_person_cc.id,e.contact_person_id=l.formData.contact_person.id,e.price_quotation_date=l.formData.price_quotation_date,e.status_id=l.formData.status_id,e.tax_percent=parseFloat(l.formData.tax_percent),e.tnc_delivery=l.formData.tnc_delivery,e.tnc_duration_of_manufacture=l.formData.tnc_duration_of_manufacture,e.tnc_franco=l.formData.tnc_franco,e.tnc_payment=l.formData.tnc_payment,e.tnc_price=l.formData.tnc_price,e.tnc_validity=l.formData.tnc_validity,e.worklist_id=l.formData.worklist.id,u.value=`${l.formData.worklist.worklist_number} - ${l.formData.worklist.title}`,v.value=`${l.formData.contact_person.name}`,y.value=`${l.formData.contact_person_cc.name}`,X(),pe())}),ne(()=>{try{(async()=>{var o;await J(T.formOptions()),(o=O.value)!=null&&o.success&&(x.value=O.value.data)})()}catch{}}),(o,t)=>{const p=Ue,g=Fe,n=Te,fe=Be,R=De,ve=Ce,ge=qe,E=ae,ee=$e,ye=Ie,he=Ke;return F(),I("div",Ge,[c("div",je,[c("div",Ae,[Qe,_.editMode?(F(),A(p,{key:0,color:"orange"},{default:r(()=>[D("Mode Edit")]),_:1})):(F(),A(p,{key:1,color:"cyan"},{default:r(()=>[D("Mode Input")]),_:1}))])]),c("div",We,[i(ee,{ref_key:"formRef",ref:H,model:e,rules:le,"label-col":{style:{width:"220px"}},colon:!1,"label-align":"left",onFinish:t[13]||(t[13]=a=>h(V)(H.value,me))},{default:r(()=>[c("div",ze,[c("div",Je,[i(n,{label:"No PH"},{default:r(()=>{var a;return[i(g,{value:_.editMode?(a=l.formData)==null?void 0:a.price_quotation_number:"",disabled:""},null,8,["value"])]}),_:1}),i(n,{label:"Worklist",name:"worklist_id",ref:"worklist_id"},{default:r(()=>{var a;return[i(j,{"column-defs":w,"grid-data":((a=x.value)==null?void 0:a.worklists)??[],loading:h(ue),value:void 0,"value-display":u.value,onChange:t[0]||(t[0]=C=>{e.worklist_id=C.id,u.value=`${C.worklist_number} - ${C.title}`,X()})},null,8,["grid-data","loading","value-display"])]}),_:1},512),i(n,{label:"Kontak",name:"contact_person_id",ref:"contact_person_id"},{default:r(()=>[i(j,{"column-defs":k,"grid-data":N.value,loading:!1,value:void 0,"value-display":v.value,onChange:t[1]||(t[1]=a=>{e.contact_person_id=a.id,v.value=`${a.name}`}),disabled:e.worklist_id===void 0},null,8,["grid-data","value-display","disabled"])]),_:1},512),i(n,{label:"Kontak CC",name:"contact_person_cc_id",ref:"contact_person_cc_id"},{default:r(()=>[i(j,{"column-defs":k,"grid-data":N.value,loading:!1,value:void 0,"value-display":y.value,onChange:t[2]||(t[2]=a=>{e.contact_person_cc_id=a.id,y.value=`${a.name}`}),disabled:e.worklist_id===void 0},null,8,["grid-data","value-display","disabled"])]),_:1},512),i(n,{label:"Tgl PH",name:"price_quotation_date",ref:"price_quotation_date"},{default:r(()=>[i(fe,{value:e.price_quotation_date?h(Ne)(e.price_quotation_date):void 0,onChange:t[3]||(t[3]=(a,C)=>e.price_quotation_date=C)},null,8,["value"])]),_:1},512),i(n,{label:"PPn %",name:"tax_percent",ref:"tax_percent"},{default:r(()=>[i(R,{value:e.tax_percent,"onUpdate:value":t[4]||(t[4]=a=>e.tax_percent=a),min:0},null,8,["value"])]),_:1},512),i(n,{label:"T&C Franco",name:"tnc_franco",ref:"tnc_franco"},{default:r(()=>[i(g,{value:e.tnc_franco,"onUpdate:value":t[5]||(t[5]=a=>e.tnc_franco=a)},null,8,["value"])]),_:1},512),i(n,{label:"T&C Harga",name:"tnc_price",ref:"tnc_price"},{default:r(()=>[i(g,{value:e.tnc_price,"onUpdate:value":t[6]||(t[6]=a=>e.tnc_price=a)},null,8,["value"])]),_:1},512),i(n,{label:"T&C Payment",name:"tnc_payment",ref:"tnc_payment"},{default:r(()=>[i(g,{value:e.tnc_payment,"onUpdate:value":t[7]||(t[7]=a=>e.tnc_payment=a)},null,8,["value"])]),_:1},512),i(n,{label:"T&C Delivery",name:"tnc_delivery",ref:"tnc_delivery"},{default:r(()=>[i(g,{value:e.tnc_delivery,"onUpdate:value":t[8]||(t[8]=a=>e.tnc_delivery=a)},null,8,["value"])]),_:1},512),i(n,{label:"T&C Validity",name:"tnc_validity",ref:"tnc_validity"},{default:r(()=>[i(g,{value:e.tnc_validity,"onUpdate:value":t[9]||(t[9]=a=>e.tnc_validity=a)},null,8,["value"])]),_:1},512),i(n,{label:"T&C Duration Of Manufacture",name:"tnc_duration_of_manufacture",ref:"tnc_duration_of_manufacture"},{default:r(()=>[i(g,{value:e.tnc_duration_of_manufacture,"onUpdate:value":t[10]||(t[10]=a=>e.tnc_duration_of_manufacture=a)},null,8,["value"])]),_:1},512),i(n,{label:"Status",name:"status_id",ref:"status_id"},{default:r(()=>[i(ge,{value:e.status_id,"onUpdate:value":t[11]||(t[11]=a=>e.status_id=a)},{default:r(()=>{var a;return[(F(!0),I(Se,null,Me((a=x.value)==null?void 0:a.statuses,C=>(F(),A(ve,{value:C.id},{default:r(()=>[D(Q(C.title),1)]),_:2},1032,["value"]))),256))]}),_:1},8,["value"])]),_:1},512)]),c("div",Le,[i(E,{class:"mb-3",type:"primary",onClick:h(_e)},{default:r(()=>[D(" Tambah ")]),_:1},8,["onClick"]),i(ie,{style:{height:"300px"},"row-data":m.value,"column-defs":$,loading:h(ce),onRowClick:t[12]||(t[12]=()=>{})},null,8,["row-data","column-defs","loading"])]),c("div",Xe,[i(E,{type:"primary","html-type":"submit",loading:h(se)},{default:r(()=>[Ye,c("span",null,Q(_.editMode?"Edit":"Simpan"),1)]),_:1},8,["loading"]),i(E,{class:"mx-3",onClick:Y},{default:r(()=>[D(Q(_.editMode?"Batal Edit":"Bersihkan"),1)]),_:1})])])]),_:1},8,["model"])]),i(he,{visible:h(K),"onUpdate:visible":t[22]||(t[22]=a=>Oe(K)?K.value=a:null),title:"Tambah Detail","cancel-text":"Tutup",onOk:t[23]||(t[23]=a=>h(V)(S.value,Z))},{default:r(()=>[i(ee,{ref_key:"formRefAddDet",ref:S,model:s,rules:oe,"label-col":{style:{width:"110px"}},colon:!1,"label-align":"left",onFinish:t[21]||(t[21]=a=>h(V)(S.value,Z))},{default:r(()=>[i(n,{label:"Deskripsi",name:"item_description",ref:"item_description"},{default:r(()=>[i(ye,{value:s.item_description,"onUpdate:value":t[14]||(t[14]=a=>s.item_description=a)},null,8,["value"])]),_:1},512),i(n,{label:"Spesifikasi",name:"specification",ref:"specification"},{default:r(()=>[i(g,{value:s.specification,"onUpdate:value":t[15]||(t[15]=a=>s.specification=a)},null,8,["value"])]),_:1},512),i(n,{label:"Qty",name:"qty",ref:"qty"},{default:r(()=>[i(R,{value:s.qty,"onUpdate:value":t[16]||(t[16]=a=>s.qty=a),min:0,formatter:a=>`${a}`.replace(/\B(?=(\d{3})+(?!\d))/g,"."),parser:a=>a.replace(/\$\s?|(\.*)/g,"")},null,8,["value","formatter","parser"])]),_:1},512),i(n,{label:"Satuan",name:"qty_unit",ref:"qty_unit"},{default:r(()=>[i(g,{value:s.qty_unit,"onUpdate:value":t[17]||(t[17]=a=>s.qty_unit=a)},null,8,["value"])]),_:1},512),i(n,{label:"Harga Tawar",name:"ex_price",ref:"ex_price"},{default:r(()=>[i(R,{style:{width:"100%"},value:s.ex_price,"onUpdate:value":t[18]||(t[18]=a=>s.ex_price=a),min:0,formatter:a=>`${a}`.replace(/\B(?=(\d{3})+(?!\d))/g,"."),parser:a=>a.replace(/\$\s?|(\.*)/g,"")},{addonBefore:r(()=>[Ze]),_:1},8,["value","formatter","parser"])]),_:1},512),i(n,{label:"Harga Final",name:"price",ref:"price"},{default:r(()=>[i(R,{style:{width:"100%"},value:s.price,"onUpdate:value":t[19]||(t[19]=a=>s.price=a),min:0,formatter:a=>`${a}`.replace(/\B(?=(\d{3})+(?!\d))/g,"."),parser:a=>a.replace(/\$\s?|(\.*)/g,"")},{addonBefore:r(()=>[et]),_:1},8,["value","formatter","parser"])]),_:1},512),i(n,{label:"Remarks",name:"remarks",ref:"remarks"},{default:r(()=>[i(g,{value:s.remarks,"onUpdate:value":t[20]||(t[20]=a=>s.remarks=a)},null,8,["value"])]),_:1},512)]),_:1},8,["model"])]),_:1},8,["visible"])])}}}),at=W({__name:"DataTable",props:{idx:null},emits:["rowClick"],setup(_,{emit:d}){const l=_,w=B({value:[{field:"price_quotation_number",headerName:"No. PH",pinned:"left",flex:0,width:130},{field:"price_quotation_date",headerName:"Tgl PH",...G},{field:"worklist.worklist_number",headerName:"No. Projek",flex:0,width:130},{field:"contact_person.name",headerName:"Kontak",flex:0,width:130},{field:"contact_person_cc.name",headerName:"Kontak CC",flex:0,width:130},{field:"price_quotation_number",headerName:"No. PH",flex:0,width:130},{field:"status_caption",headerName:"Status",flex:0,width:100},{field:"tax_percent",headerName:"PPn (%)",flex:0,width:90,filter:"agNumberColumnFilter",type:"numericColumn",valueGetter:u=>parseFloat(u.data.tax_percent)},{field:"subtotal",headerName:"Subtotal",flex:0,width:120,filter:"agNumberColumnFilter",type:"numericColumn",valueGetter:u=>parseFloat(u.data.subtotal),valueFormatter:u=>P(u.value)},{field:"total_tax",headerName:"PPn Nilai",flex:0,width:120,filter:"agNumberColumnFilter",type:"numericColumn",valueGetter:u=>parseFloat(u.data.total_tax),valueFormatter:u=>P(u.value)},{field:"grand_total",headerName:"Grand Total",flex:0,width:120,filter:"agNumberColumnFilter",type:"numericColumn",valueGetter:u=>parseFloat(u.data.grand_total),valueFormatter:u=>P(u.value)},{field:"tnc_delivery",headerName:"T&C Delivery",flex:0,width:120},{field:"tnc_duration_of_manufacture",headerName:"T&C Duration of Manufacture",flex:0,width:120},{field:"tnc_franco",headerName:"T&C Franco",flex:0,width:120},{field:"tnc_payment",headerName:"T&C Payment",flex:0,width:120},{field:"tnc_price",headerName:"T&C Harga",flex:0,width:120},{field:"tnc_validity",headerName:"T&C Validity",flex:0,width:120},{field:"created_at",headerName:"Diinput Tgl",...G},{field:"updated_at",headerName:"Diupdate Tgl",...G},{field:"created_by_user_username",headerName:"Diinput Oleh",flex:0,width:120},{field:"updated_by_user_username",headerName:"Diupdate Oleh",flex:0,width:120}]}),k=B({value:null}),{run:$,response:x,loading:N}=U();async function v(){var u;try{await $(T.list()),(u=x.value)!=null&&u.success&&(k.value=x.value.data)}catch{}}function y(u){d("rowClick",u)}return ne(()=>{v()}),re(()=>l.idx,()=>{v()}),(u,m)=>(F(),I("div",null,[i(ie,{"row-data":k.value,"column-defs":w.value,loading:h(N),onRowClick:y},null,8,["row-data","column-defs","loading"])]))}}),it=c("span",null,[c("i",{class:"fe fe-edit-2 me-2"}),D(" Input ")],-1),rt=c("span",null,[c("i",{class:"fe fe-search me-2"}),D(" Browse ")],-1),nt=c("i",{class:"fe fe-refresh-cw me-2"},null,-1),Pt=W({__name:"index",setup(_){const d=f("1"),l=f(),w=f(!1),k=f(1);function $(v){d.value="1",l.value={...v},w.value=!0}function x(){w.value=!1}function N(v){k.value+=1,v!==void 0&&(w.value=v)}return(v,y)=>{const u=Ve,m=ae,b=Ee;return F(),I("div",null,[i(b,{class:"input-browse-tab",activeKey:d.value,"onUpdate:activeKey":y[1]||(y[1]=q=>d.value=q),animated:""},Re({default:r(()=>[i(u,{key:"1"},{tab:r(()=>[it]),default:r(()=>[i(tt,{"form-data":l.value,"edit-mode":w.value,onCancelEdit:x,onOnSuccess:N},null,8,["form-data","edit-mode"])]),_:1}),i(u,{key:"2"},{tab:r(()=>[rt]),default:r(()=>[i(at,{idx:k.value,onRowClick:$},null,8,["idx"])]),_:1})]),_:2},[d.value==="2"?{name:"rightExtra",fn:r(()=>[i(m,{size:"small",class:"mt-3",onClick:y[0]||(y[0]=q=>k.value+=1)},{default:r(()=>[nt,D(" Refresh Data ")]),_:1})]),key:"0"}:void 0]),1032,["activeKey"])])}}});export{Pt as default};
