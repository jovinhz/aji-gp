var De=Object.defineProperty;var qe=(_,s,u)=>s in _?De(_,s,{enumerable:!0,configurable:!0,writable:!0,value:u}):_[s]=u;var oe=(_,s,u)=>(qe(_,typeof s!="symbol"?s+"":s,u),u);import{B as de}from"./index-153eefc2.js";import{_ as le}from"./AgGrid.vuevuetypescriptsetuptruelang-ab13ecb9.js";import{u as Ce}from"./modal-e8545dd0.js";import{_ as Ne}from"./index-1776abb9.js";import{_ as xe}from"./InputDropdown.vuevuetypescriptsetuptruelang-59e1ec1d.js";import{o as A,t as ae,a as V}from"./index-8f77c718.js";import"./index-516ff1a6.js";/* empty css              *//* empty css              */import{a as $e,I as Fe,_ as Pe,F as Te}from"./Input-bda0940e.js";import{H as Me,u as I}from"./HttpClient-7fc79ba3.js";import{_ as Re}from"./AgGridActionCell.vuevuetypescriptsetuptruelang-e542f767.js";import{_ as Oe,a as Se}from"./index-ecb6a2b5.js";import{d as G,r as p,O as E,w as se,a as re,e as P,a7 as Q,ac as m,f as B,g as n,a9 as q,c as d,u as b,aa as ie,X as je,ak as Be}from"./plugin-vueexport-helper-0ef99882.js";import{_ as Ie}from"./index-0437c30a.js";import{D as Ee}from"./dayjs-ec520615.js";import{_ as He}from"./TextArea-17c42df7.js";import{M as Ke}from"./Modal-79dc3d32.js";import{T as Ue,_ as Ae}from"./TabPane-9c8435b0.js";import"./DownOutlined-80526c88.js";import"./useMemo-49158cc8.js";import"./pickAttrs-596f35c3.js";class T{static list(){return this.HttpClient.axiosInstance.get("/warehouse_stock_releases")}static create(s){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"Pengeluaran Gudang berhasil ditambah"}).axiosInstance.post("/warehouse_stock_releases",s)}static show(s){return this.HttpClient.axiosInstance.get(`/warehouse_stock_releases/${s}`)}static update(s,u){return this.HttpClient.withOptions({showSuccessFeedback:!0,successFeedbackMessage:"Pengeluaran Gudang berhasil diupdate"}).axiosInstance.put(`/warehouse_stock_releases/${s}`,u)}static formOptions(s){return this.HttpClient.axiosInstance.get("/warehouse_stock_releases/form_options",{params:{worklist_id:s}})}}oe(T,"HttpClient",new Me);const Ve={class:"card card-custom card-dense"},Ge={class:"card-header"},Qe={class:"card-title w-100 d-flex justify-content-between"},We=m("h4",{class:"card-label"},"Form Pengeluaran Gudang",-1),ze={class:"card-body"},Xe={class:"row"},Je={class:"col-lg-6"},Le={class:"col-lg-12"},Ye={class:"col-lg-6 mt-3"},Ze=m("i",{class:"fe fe-save me-2"},null,-1),et=G({__name:"Form",props:{formData:null,editMode:{type:Boolean}},emits:["cancelEdit","onSuccess"],setup(_,{emit:s}){const u=_,C=[{field:"product_code",headerName:"Kode Produk"},{field:"product_name",headerName:"Nama Produk"},{field:"qty",headerName:"Qty",filter:"agNumberColumnFilter",type:"numericColumn",valueFormatter:a=>ae(a.value)},{field:"note",headerName:"Catatan"},{field:"worklist",headerName:"Projek"},{headerName:"Aksi",filter:!1,floatingFilter:!1,sortable:!1,resizable:!1,suppressMovable:!0,pinned:"right",width:75,flex:0,cellRenderer:Re,cellRendererParams:a=>({onDelete:()=>{c.value=c.value.filter(t=>t.id!==a.data.id),typeof a.data.id=="number"?(F.value.push({id:a.data.id,_destroy:1}),$.value=$.value.filter(t=>t.id!==a.data.id)):D.value=D.value.filter(t=>t._id!==a.data.id)}})}],N=[{field:"code",headerName:"Kode Produk"},{field:"name",headerName:"Nama Produk"}],M=[{field:"product.code",headerName:"Kode Produk"},{field:"product.name",headerName:"Nama Produk"},{field:"worklist.worklist_number",headerName:"No Projek"},{field:"worklist.title",headerName:"Nama Projek"},{field:"qty_request",headerName:"Qty Req",filter:"agNumberColumnFilter",type:"numericColumn",valueFormatter:a=>ae(a.value)}],x=p(),y=p(""),w=p(!1),h=p(),f=p("1"),c=p([]),D=p([]),F=p([]),$=p([]),S=p(),v=E({}),ne={issue_date:[{required:!0,message:"Tanggal transaksi wajib diisi",trigger:"change"}]},R=p(),e=E({}),ue={product_id:[{required:!0,message:"Produk wajib dipilih",trigger:"change"}],qty:[{required:!0,message:"Qty wajib diisi",trigger:"change"}],worklist_product_id:[{required:!0,message:"Produk wajib dipilih",trigger:"change"}]},{run:W,loading:ce,response:j}=I(),{run:_e,loading:H,response:z}=I(),{run:pe,loading:dt,response:X}=I(),{visible:K,open:J,close:me}=Ce();async function fe(){var a,t,o,r;try{u.editMode?(await W(T.update((a=u.formData)==null?void 0:a.id,{warehouse_id:1,issue_date:v.issue_date,note:v.note,items_attributes:[...D.value,...$.value,...F.value]})),(t=j.value)!=null&&t.success&&(D.value=[],$.value=[],F.value=[],c.value=j.value.data.items.map(i=>{var g,O;return{id:i.id,product_code:i.product.code,product_id:i.product.id,product_name:i.product.name,note:i.note,qty:parseInt(i.qty,10),worklist:(g=i.worklist_product)==null?void 0:g.worklist.worklist_number,worklist_product_id:(O=i.worklist_product)==null?void 0:O.id}}))):(await W(T.create({warehouse_id:1,issue_date:v.issue_date,note:v.note,items_attributes:c.value.map(i=>i.worklist_product_id?{worklist_product_id:i.worklist_product_id,qty:i.qty,note:i.note}:{product_id:i.product_id,qty:i.qty,note:i.note})})),(o=j.value)!=null&&o.success&&L()),(r=j.value)!=null&&r.success&&s("onSuccess")}catch{}}function L(){var a;if(u.editMode){for(const t in v)v[t]=void 0;s("cancelEdit")}else(a=S.value)==null||a.resetFields();c.value=[],D.value=[],F.value=[],$.value=[]}async function ve(){var a;try{await pe(T.formOptions()),(a=X.value)!=null&&a.success&&(x.value=X.value.data)}catch{}}async function ke(){var a,t;try{await _e(T.show((a=u.formData)==null?void 0:a.id)),(t=z.value)!=null&&t.success&&(c.value=z.value.data.items.map(o=>{var r,i,g;return{id:o.id,product_code:o.product.code,product_id:o.product.id,product_name:o.product.name,qty:parseInt(o.qty,10),note:o.note,worklist:(i=(r=o.worklist_product)==null?void 0:r.worklist)==null?void 0:i.worklist_number,worklist_product_id:(g=o.worklist_product)==null?void 0:g.id}}))}catch{}}function Y(){var a,t;if(w.value){if(typeof((a=h.value)==null?void 0:a.id)=="string"){const o=D.value.find(i=>{var g;return i._id===((g=h.value)==null?void 0:g.id)}),r=c.value.find(i=>{var g;return i.id===((g=h.value)==null?void 0:g.id)});o&&(o.product_id=e.product_id,o.qty=e.qty,o.note=e.note,o.worklist_product_id=e.worklist_product_id),r&&(r.product_id=e.product_id,r.worklist=e.worklist,r.worklist_product_id=e.worklist_product_id,r.qty=e.qty,r.product_code=e.product_code,r.product_name=e.product_name,r.note=e.note,c.value=[...c.value]),console.log("ad ",D.value)}else{const o=c.value.find(r=>{var i;return r.id===((i=h.value)==null?void 0:i.id)});if(o){o.product_id=e.product_id,o.product_code=e.product_code,o.product_name=e.product_name,o.qty=e.qty,o.note=e.note,o.worklist=e.worklist,o.worklist_product_id=e.worklist_product_id;const r=$.value.find(i=>i.id===o.id);r?(r.id=o.id,r.qty=o.qty,r.worklist=o.worklist,r.product_id=o.product_id,r.worklist_product_id=o.worklist_product_id):$.value.push({id:o.id,product_id:o.product_id,worklist_product_id:o.worklist_product_id,qty:o.qty,note:o.note}),console.log("ud ",$.value),c.value=[...c.value]}}me()}else{const o={id:`new-${c.value.length+1}`,qty:e.qty,product_id:e.product_id,product_code:e.product_code,product_name:e.product_name,note:e.note,worklist:e.worklist,worklist_product_id:e.worklist_product_id};c.value=[...c.value,o],D.value.push({_id:o.id,product_id:e.product_id,qty:e.qty,note:e.note,worklist_product_id:e.worklist_product_id}),(t=R.value)==null||t.resetFields(),y.value=""}}function we(a){var t;a.worklist_product_id?(f.value="2",e.worklist_product_id=a.worklist_product_id):f.value="1",w.value=!0,h.value=a,e.product_id=a.product_id,e.product_code=a.product_code,e.product_name=a.product_name,e.qty=a.qty,e.note=a.note,y.value=`${a.product_code} - ${a.product_name}`,(t=R.value)==null||t.clearValidate(),J()}function ge(){e.product_id=void 0,e.worklist_product_id=void 0,e.worklist=void 0,y.value=""}return se(()=>u.formData,()=>{var a;u.formData&&((a=S.value)==null||a.clearValidate(),v.issue_date=u.formData.issue_date,v.note=u.formData.note,setTimeout(()=>{ke()},0))}),re(()=>{ve()}),(a,t)=>{const o=Ie,r=Fe,i=Pe,g=Ee,O=He,U=de,Z=Te,ee=Oe,ye=Se,te=xe,he=Ne,be=Ke;return P(),Q("div",Ve,[m("div",Ge,[m("div",Qe,[We,_.editMode?(P(),B(o,{key:0,color:"orange"},{default:n(()=>[q("Mode Edit")]),_:1})):(P(),B(o,{key:1,color:"cyan"},{default:n(()=>[q("Mode Input")]),_:1}))])]),m("div",ze,[d(Z,{ref_key:"formRef",ref:S,model:v,rules:ne,"label-col":{style:{width:"220px"}},colon:!1,"label-align":"left",onFinish:t[3]||(t[3]=l=>b(A)(S.value,fe))},{default:n(()=>[m("div",Xe,[m("div",Je,[d(i,{label:"No. Tran"},{default:n(()=>{var l;return[d(r,{value:_.editMode?(l=_.formData)==null?void 0:l.transaction_number:"",disabled:""},null,8,["value"])]}),_:1}),d(i,{label:"Tgl Transaksi",name:"issue_date",ref:"issue_date"},{default:n(()=>[d(g,{value:v.issue_date?b($e)(v.issue_date):void 0,onChange:t[0]||(t[0]=(l,k)=>v.issue_date=k)},null,8,["value"])]),_:1},512),d(i,{label:"Catatan",ref:"note",name:"note"},{default:n(()=>[d(O,{value:v.note,"onUpdate:value":t[1]||(t[1]=l=>v.note=l)},null,8,["value"])]),_:1},512)]),m("div",Le,[d(U,{class:"mb-3",type:"primary",onClick:t[2]||(t[2]=()=>{w.value=!1,e.product_code=void 0,e.product_id=void 0,e.product_name=void 0,e.qty=void 0,e.note=void 0,y.value="",b(J)()})},{default:n(()=>[q(" Tambah ")]),_:1}),d(le,{style:{height:"300px"},"row-data":c.value,"column-defs":C,loading:b(H),onRowClick:we},null,8,["row-data","column-defs","loading"])]),m("div",Ye,[d(U,{type:"primary","html-type":"submit",loading:b(ce)},{default:n(()=>[Ze,m("span",null,ie(_.editMode?"Edit":"Simpan"),1)]),_:1},8,["loading"]),d(U,{class:"mx-3",onClick:L},{default:n(()=>[q(ie(_.editMode?"Batal Edit":"Bersihkan"),1)]),_:1})])])]),_:1},8,["model"])]),d(be,{visible:b(K),"onUpdate:visible":t[10]||(t[10]=l=>je(K)?K.value=l:null),title:w.value?"Update Detail":"Tambah Detail","cancel-text":"Tutup",onOk:t[11]||(t[11]=l=>b(A)(R.value,Y))},{default:n(()=>[d(Z,{ref_key:"formRefAddDet",ref:R,model:e,rules:ue,"label-col":{style:{width:"80px"}},colon:!1,"label-align":"left",onFinish:t[9]||(t[9]=l=>b(A)(R.value,Y))},{default:n(()=>[d(ye,{value:f.value,"onUpdate:value":t[4]||(t[4]=l=>f.value=l),class:"mb-4",onChange:ge},{default:n(()=>[d(ee,{value:"1"},{default:n(()=>[q("Non Projek")]),_:1}),d(ee,{value:"2"},{default:n(()=>[q("Projek")]),_:1})]),_:1},8,["value"]),f.value==="1"?(P(),B(i,{key:0,label:"Produk",name:"product_id",ref:"product_id"},{default:n(()=>{var l;return[d(te,{"column-defs":N,"grid-data":((l=x.value)==null?void 0:l.products)??[],loading:b(H),value:void 0,"value-display":y.value,onChange:t[5]||(t[5]=k=>{e.product_id=k.id,e.product_code=k.code,e.product_name=k.name,y.value=`${k.code} - ${k.name}`})},null,8,["grid-data","loading","value-display"])]}),_:1},512)):(P(),B(i,{key:1,label:"Produk",name:"worklist_product_id",ref:"worklist_product_id"},{default:n(()=>{var l;return[d(te,{"column-defs":M,"grid-data":((l=x.value)==null?void 0:l.worklist_products)??[],loading:b(H),value:void 0,"value-display":y.value,onChange:t[6]||(t[6]=k=>{e.worklist_product_id=k.id,e.product_code=k.product.code,e.product_name=k.product.name,e.worklist=k.worklist.worklist_number,y.value=`${k.product.code} - ${k.product.name}`})},null,8,["grid-data","loading","value-display"])]}),_:1},512)),d(i,{label:"Qty",name:"qty",ref:"qty"},{default:n(()=>[d(he,{value:e.qty,"onUpdate:value":t[7]||(t[7]=l=>e.qty=l),min:0,formatter:l=>`${l}`.replace(/\B(?=(\d{3})+(?!\d))/g,"."),parser:l=>l.replace(/\$\s?|(\.*)/g,"")},null,8,["value","formatter","parser"])]),_:1},512),d(i,{label:"Catatan",ref:"note",name:"note"},{default:n(()=>[d(O,{value:e.note,"onUpdate:value":t[8]||(t[8]=l=>e.note=l)},null,8,["value"])]),_:1},512)]),_:1},8,["model"])]),_:1},8,["visible","title"])])}}}),tt=G({__name:"DataTable",props:{idx:null},emits:["rowClick"],setup(_,{emit:s}){const u=_,C=E({value:[{field:"transaction_number",headerName:"No. Tran",pinned:"left",minWidth:100},{field:"issue_date",headerName:"Tgl Tran",...V},{field:"note",headerName:"Catatan",minWidth:100},{field:"created_at",headerName:"Diinput Tgl",...V},{field:"updated_at",headerName:"Diupdate Tgl",...V},{field:"created_by_user_username",headerName:"Diinput Oleh",flex:0,width:120},{field:"updated_by_user_username",headerName:"Diupdate Oleh",flex:0,width:120}]}),N=E({value:null}),{run:M,response:x,loading:y}=I();async function w(){var f;try{await M(T.list()),(f=x.value)!=null&&f.success&&(N.value=x.value.data)}catch{}}function h(f){s("rowClick",f)}return re(()=>{w()}),se(()=>u.idx,()=>{w()}),(f,c)=>(P(),Q("div",null,[d(le,{"row-data":N.value,"column-defs":C.value,loading:b(y),onRowClick:h},null,8,["row-data","column-defs","loading"])]))}}),ot=m("span",null,[m("i",{class:"fe fe-edit-2 me-2"}),q(" Input ")],-1),at=m("span",null,[m("i",{class:"fe fe-search me-2"}),q(" Browse ")],-1),it=m("i",{class:"fe fe-refresh-cw me-2"},null,-1),Ft=G({__name:"index",setup(_){const s=p("1"),u=p(),C=p(!1),N=p(1);function M(w){s.value="1",u.value={...w},C.value=!0}function x(){C.value=!1}function y(w){N.value+=1,w!==void 0&&(C.value=w)}return(w,h)=>{const f=Ae,c=de,D=Ue;return P(),Q("div",null,[d(D,{class:"input-browse-tab",activeKey:s.value,"onUpdate:activeKey":h[1]||(h[1]=F=>s.value=F),animated:""},Be({default:n(()=>[d(f,{key:"1"},{tab:n(()=>[ot]),default:n(()=>[d(et,{"form-data":u.value,"edit-mode":C.value,onCancelEdit:x,onOnSuccess:y},null,8,["form-data","edit-mode"])]),_:1}),d(f,{key:"2"},{tab:n(()=>[at]),default:n(()=>[d(tt,{idx:N.value,onRowClick:M},null,8,["idx"])]),_:1})]),_:2},[s.value==="2"?{name:"rightExtra",fn:n(()=>[d(c,{size:"small",class:"mt-3",onClick:h[0]||(h[0]=F=>N.value+=1)},{default:n(()=>[it,q(" Refresh Data ")]),_:1})]),key:"0"}:void 0]),1032,["activeKey"])])}}});export{Ft as default};
